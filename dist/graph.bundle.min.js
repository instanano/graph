window.GraphPlotter=window.GraphPlotter||{state:{hot:null,colEnabled:{},activeGroup:null,activeText:null,activeDiv:null,activeFo:null,activeTicks:null,tickLabelStyles:{x:{},y:{},a:{},b:{},c:{}},lastXScale:null,lastYScale:null,multiYScales:null,axisScales:null,overrideX:null,overrideMultiY:{},overrideXTicks:null,overrideYTicks:{},overrideTernary:{},overrideTernaryTicks:{},overrideScaleformatX:null,overrideScaleformatY:{},overrideCustomTicksX:null,overrideCustomTicksY:{},overrideCustomTicksTernary:{},minorTickOn:{},useCustomTicksOn:{},shapeMode:"none",drawing:!1,drawStart:null,tempShape:null,arrowCount:0},config:{},utils:{},ChartRegistry:null,parsers:{},ui:{refs:{}},axis:{},features:{},init:null,renderChart:null,getSeries:null,getSettings:null},function(t){"use strict";t.config.COLORS=["#FFFF00","#000000","#0000FF","#FF0000","#008000","#00FFFF","#FF00FF","#FFA500","#800080","#A52A2A"],t.config.DIM={W:600,H:300,MT:30,MB:60,ML:70,MR:80},t.config.SYMBOL_TYPES=[d3.symbolCircle,d3.symbolTriangle,d3.symbolSquare,d3.symbolDiamond,d3.symbolStar,d3.symbolCross],t.config.ratioPresets={"4:2.85":{linewidth:1.4,scalewidth:1.4,axisTitleFs:13,legendFs:13,scaleFs:12,xticks:6,yticks:5,multiygap:35},"16:9.15":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:11,xticks:6,yticks:5,multiygap:35},"2:1.05":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:11,xticks:6,yticks:5,multiygap:35},"3:1.2":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:10,xticks:7,yticks:3,multiygap:35},"4:1.35":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:10,xticks:7,yticks:2,multiygap:35}}}(window.GraphPlotter),function(t){"use strict";t.utils.clearActive=function(){const e=t.state;e.activeGroup&&(e.activeGroup.select(".outline").attr("visibility","hidden"),e.activeGroup=null),e.activeText&&(e.activeText.attr("contenteditable",!1).style("border",null),e.activeText=null),e.activeDiv&&(e.activeDiv.attr("contenteditable",!1).style("border",null).style("cursor","move"),e.activeDiv=null),e.activeTicks&&(e.activeTicks.attr("contenteditable",!1).style("outline",null).style("cursor","pointer"),e.activeTicks=null,document.getElementById("axis-label").textContent="Axis Settings: Select Axis",document.getElementById("scalemin").value="",document.getElementById("scalemax").value="",document.getElementById("customticks").value=""),e.activeFo=null,t.ui.refs.boldBtn&&t.ui.refs.boldBtn.classed("active",!1),t.ui.refs.italicBtn&&t.ui.refs.italicBtn.classed("active",!1),t.ui.refs.rmBtn&&t.ui.refs.rmBtn.classed("disabled",!0),window.getSelection().removeAllRanges(),["scalemin","scalemax","tickcount","scaleformat","customticks","useCustomTicks","showMinorTicks"].forEach(t=>{document.getElementById(t).disabled=!0})},t.utils.rgbToHex=function(t){return"#"+t.match(/\d+/g).map(t=>(+t).toString(16).padStart(2,"0")).join("")},t.utils.applyDrag=d3.drag().on("start",function(e){t.state.hot.deselectCell(),e.sourceEvent.preventDefault(),t.utils.clearActive();const a=d3.select(this).raise();if(a.classed("shape-group"))t.features.activateShape(a);else{const e="foreignObject"===a.node().tagName?a:a.select("foreignObject"),r=e.select("div");t.features.activateText(r,e),setTimeout(()=>{window.getSelection().selectAllChildren(r.node())},0)}}).on("drag",function(t){const e=d3.select(this),a=e.attr("transform")||"",r=a.match(/translate\(([^,]+),([^)]+)\)/)||[],s=+r[1]||0,i=+r[2]||0,n=(/rotate\(([^)]+)\)/.exec(a)||[])[0]||"";e.attr("transform",`translate(${s+t.dx},${i+t.dy})${n}`)}).on("end",function(){const t=d3.select(this);if(t.classed("user-text")||t.classed("axis-title")||t.classed("legend-group")){const e=t.select("foreignObject div");t.classed("legend-group")&&(this.dataset.savedTransform=t.attr("transform")),e.on("blur",()=>{e.attr("contenteditable",!1).style("cursor","move")})}}),t.utils.updateInspector=function(e){const a=e.node(),r=window.getComputedStyle(a),s=parseFloat(e.attr("stroke-width"))||parseInt(r.fontSize,10),i="DIV"===a.tagName?r.color:"none"!==r.stroke?r.stroke:r.fill;t.ui.refs.sizeCtrl.property("value",s),t.ui.refs.colorCtrl.property("value",t.utils.rgbToHex(i));const n=r.fontFamily.split(",")[0].replace(/['"]/g,"");t.ui.refs.fontCtrl.property("value",n);const o="700"===r.fontWeight||"bold"===r.fontWeight;t.ui.refs.boldBtn.classed("active",o);const l="italic"===r.fontStyle;t.ui.refs.italicBtn.classed("active",l),t.ui.refs.rmBtn.classed("disabled",!1)},t.utils.editableText=function(t,{x:e,y:a,text:r,rotation:s}){const i=t.append("foreignObject").attr("x",e).attr("y",a).attr("transform",s?`rotate(${s},${e},${a})`:null).attr("overflow","visible"),n=i.append("xhtml:div").attr("contenteditable",!1).style("display","inline-block").style("white-space","nowrap").style("padding","2px").style("cursor","move").style("font-size","12px").html(r),o=n.node().scrollWidth,l=n.node().scrollHeight;return i.attr("width",o+2).attr("height",l+2),n.on("input",()=>{const t=n.node().scrollWidth,e=n.node().scrollHeight;i.attr("width",t+2).attr("height",e+2)}).on("keydown",function(t){"Enter"===t.key&&(t.preventDefault(),this.blur())}).on("blur",()=>{d3.select(n.node()).style("cursor","move")}),{fo:i,div:n,pad:2}}}(window.GraphPlotter),function(t){"use strict";const e=new Map;t.ChartRegistry={register(t){if(!t.id||"function"!=typeof t.draw)throw new Error("Invalid chart registration");e.set(t.id,t)},get(t){const a=e.get(t);if(!a)throw new Error(`Unknown chart type: ${t}`);return a}}}(window.GraphPlotter),function(t){"use strict";function e(){const e=t.state.hot.getData(),a=document.querySelector('label[for="icon1"]');if(!a)return;const r=e[0].some((a,r)=>t.state.colEnabled[r]&&e.slice(3).every(t=>null==t[r]||""===t[r]||isNaN(+t[r]))),s=a.querySelector(".warning-badge");if(r){if(!s){const t=document.createElement("span");t.className="warning-badge",t.textContent="!",a.appendChild(t)}}else s&&s.remove()}t.initTable=function(){const a=document.getElementById("table");t.state.hot=new myTable(a,{data:[["X-axis","Y-axis"],["#FFFF00","#000000"],["Sample","Sample"],[10,223],[20,132],[30,532],[40,242],[50,300],[70,100],[100,250]],colHeaders:e=>(t.state.colEnabled[e]=!1!==t.state.colEnabled[e],`<input type="checkbox" data-col="${e}" ${t.state.colEnabled[e]?"checked":""}>`),rowHeaders:t=>["Axis","Color","Name"][t]||t-2,rowHeaderWidth:60,colWidths:70,contextMenu:!0,afterRemoveRow:()=>{t.axis.resetScales(!0),t.renderChart()},afterRemoveCol:()=>{t.axis.resetScales(!0),t.renderChart()},afterCreateCol:(e,a)=>{for(let r=e;r<e+a;r++)t.state.hot.setDataAtCell(0,r,"Y-axis"),t.state.hot.setDataAtCell(1,r,t.config.COLORS[r%t.config.COLORS.length]),t.state.hot.setDataAtCell(2,r,"Sample")},cells:(e,a)=>{const r={};0===e&&(r.type="dropdown",r.source=["X-axis","Y-axis","Z-axis","Y-error"],r.className="tabledropdown"),1===e&&(r.renderer=(e,a,r,s,i,n)=>{if(a.innerHTML="",!["X-axis","Z-axis"].includes(e.getDataAtCell(0,s))){const i=document.createElement("input");i.type="color",i.value=n||t.config.COLORS[s%t.config.COLORS.length],i.oninput=t=>e.setDataAtCell(r,s,t.target.value),a.appendChild(i)}}),2===e&&(r.renderer=(t,e,a,r,s,i)=>{e.innerHTML=["X-axis","Z-axis"].includes(t.getDataAtCell(0,r))?"":i||"Sample"});const s=r.renderer||myTable.renderers.TextRenderer;return r.renderer=function(e,a,r,i,n,o){s.apply(this,arguments),a.style.background=t.state.colEnabled[i]?"":"lightcoral"},r}}),t.state.hot.addHook("afterCreateCol",e),a.addEventListener("change",a=>{if(a.target.matches('input[type="checkbox"][data-col]')){const r=+a.target.dataset.col;t.state.colEnabled[r]=a.target.checked,t.state.hot.render(),t.axis.resetScales(!1),t.renderChart(),e()}})}}(window.GraphPlotter),function(t){"use strict";t.ChartRegistry.register({id:"line",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(t,e,a,r)=>{e.forEach((e,s)=>{const i=a.y2?a.y2[s]:a.y,n=d3.line().defined((t,a)=>Number.isFinite(e.x[a])&&Number.isFinite(e.y[a])).x((t,r)=>a.x(e.x[r])).y((t,a)=>i(e.y[a]));t.append("path").datum(e.y).attr("fill","none").attr("stroke",e.color).attr("stroke-width",r.linewidth).attr("d",n)})}}),t.ChartRegistry.register({id:"stacked",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(e,a,r,s)=>{const{H:i,MT:n,MB:o}=t.config.DIM,l=i-n-o,c=a.length+1,d=.1*l/c,u=(l-d*c)/a.length;a.forEach((t,a)=>{const i=d3.min(t.y),o=d3.max(t.y),l=n+d*(a+1)+u*a,c=l+u,p=d3.scaleLinear().domain([i,o]).range([c,l]),m=d3.line().defined((e,a)=>Number.isFinite(t.x[a])&&Number.isFinite(t.y[a])).x((e,a)=>r.x(t.x[a])).y((e,a)=>p(t.y[a]));e.append("path").datum(t.y).attr("fill","none").attr("stroke",t.color).attr("stroke-width",s.linewidth).attr("d",m)})}})}(window.GraphPlotter),function(t){"use strict";t.ChartRegistry.register({id:"scatter",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(e,a,r,s)=>{t.ui.drawErrorBars(e,a,r,s),a.forEach((a,i)=>{const n=r.y2?r.y2[i]:r.y,o=d3.symbol().type(t.config.SYMBOL_TYPES[i%t.config.SYMBOL_TYPES.length]).size(Math.PI*Math.pow(s.symbolsize,2));e.selectAll().data(a.x).enter().append("path").attr("d",o).attr("transform",(t,e)=>`translate(${r.x(t)},${n(a.y[e])})`).attr("fill",a.color)})}}),t.ChartRegistry.register({id:"scatterline",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(e,a,r,s)=>{t.ChartRegistry.get("line").draw(e,a,r,s),t.ChartRegistry.get("scatter").draw(e,a,r,s)}})}(window.GraphPlotter),function(t){"use strict";t.ChartRegistry.register({id:"bar",dimensions:["x","y"],scaleBuilders:{x:d3.scaleBand,y:d3.scaleLinear},bandPadding:.1,draw:(e,a,r,s)=>{const i=r.x.bandwidth()/a.length;a.forEach((t,a)=>{e.selectAll().data(t.y).enter().append("rect").attr("x",(e,s)=>r.x(t.rawX[s])+a*i).attr("y",t=>r.y(t)).attr("width",i).attr("height",t=>r.y.range()[0]-r.y(t)).attr("fill",t.color)}),t.ui.drawErrorBars(e,a,r,s)}}),t.ChartRegistry.register({id:"histogram",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},bandPadding:.1,draw:(e,a,r,s)=>{const i=r.x.domain(),[n,o]=i,l=(o-n)/s.bins,c=d3.range(n,o,l);let d=0;const u=a.map(t=>{const e=t.y.filter(t=>Number.isFinite(t)&&t>=n&&t<=o),a=d3.histogram().domain([n,o]).thresholds(c)(e);return d=Math.max(d,d3.max(a,t=>t.length)),a});a.forEach((i,n)=>{const o=u[n],l=d3.scaleBand().domain(o.map(t=>t.x0)).range([t.config.DIM.ML,t.config.DIM.W-t.config.DIM.MR]).padding(t.ChartRegistry.get(s.type).bandPadding),c=l.bandwidth();e.selectAll("rect.hist-bin-"+n).data(o).enter().append("rect").attr("class","hist-bin-"+n).attr("x",t=>l(t.x0)).attr("width",c).attr("y",t=>r.y(t.length)).attr("height",e=>t.config.DIM.H-t.config.DIM.MB-r.y(e.length)).attr("fill",i.color).attr("fill-opacity",.5+.5/a.length)})}})}(window.GraphPlotter),function(){"use strict";window.GraphPlotter.ChartRegistry.register({id:"area",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(t,e,a,r)=>{e.forEach((e,s)=>{const i=a.y2?a.y2[s]:a.y,n=d3.area().defined((t,a)=>Number.isFinite(e.x[a])&&Number.isFinite(e.y[a])).x((t,r)=>a.x(e.x[r])).y0(()=>i.range()[0]).y1((t,a)=>i(e.y[a]));t.append("path").datum(e.y).attr("fill",e.color).attr("fill-opacity",r.opacity).attr("stroke",e.color).attr("stroke-width",0).attr("d",n)})}})}(),function(t){"use strict";function e(e,a,r,s={}){t.axis.drawTernaryAxis(e,r);const i=t.config.DIM,n=i.W-i.ML-i.MR,o=i.H-i.MT-i.MB,l=Math.min(n,2*o/Math.sqrt(3)),c=l*Math.sqrt(3)/2,d=i.ML+(n-l)/2,u=i.MT+(o-c)/2+c,p=d+l,m=u,h=d+l/2,f=u-c,y=t.state.overrideTernary?.a||[0,100],g=t.state.overrideTernary?.b||[0,100],v=t.state.overrideTernary?.c||[0,100],x=(t,e)=>(t-e[0])/(e[1]-e[0]);a.forEach((a,i)=>{const n=a.rawX.map((t,e)=>{const r=x(t,y),s=x(a.y[e],g),i=x(a.z[e],v),n=r+s+i;if(!n)return null;return{x:(r*p+s*h+i*d)/n,y:(r*m+s*f+i*u)/n,i:e}}).filter(Boolean);if(s.area&&e.append("polygon").attr("points",n.map(t=>`${t.x},${t.y}`).join(" ")).attr("fill",a.color).attr("fill-opacity",r.opacity||1),s.line){const t=d3.line().x(t=>t.x).y(t=>t.y);e.append("path").datum(n).attr("fill","none").attr("stroke",a.color).attr("stroke-width",r.linewidth).attr("d",t)}if(s.symbol){const s=d3.symbol().type(t.config.SYMBOL_TYPES[i%t.config.SYMBOL_TYPES.length]).size(Math.PI*r.symbolsize**2);n.forEach(t=>e.append("path").attr("d",s).attr("transform",`translate(${t.x},${t.y})`).attr("fill",a.color))}})}t.ChartRegistry.register({id:"ternary",dimensions:["x","y","z"],draw:(a,r,s,i)=>{t.axis.drawTernaryGridLines(a,i),e(a,r,i,{symbol:!0})}}),t.ChartRegistry.register({id:"ternaryline",dimensions:["x","y","z"],draw:(a,r,s,i)=>{t.axis.drawTernaryGridLines(a,i),e(a,r,i,{symbol:!0,line:!0})}}),t.ChartRegistry.register({id:"ternaryarea",dimensions:["x","y","z"],draw:(a,r,s,i)=>{t.axis.drawTernaryGridLines(a,i),e(a,r,i,{area:!0})}})}(window.GraphPlotter),function(t){"use strict";t.axis.prepareChartContext=function(){const e=t.getSettings(),a=t.getSeries(),[r,s]=e.ratio.split(":").map(Number);t.config.DIM.H=Math.round(t.config.DIM.W*s/r),t.config.DIM.MR=80+(1===e.multiyaxis&&a.length>1?(a.length-2)*e.multiygap:0);const i=t.axis.getTitles(e.mode),{xScale:n,yScale:o}=t.axis.makeScales(e,a);return t.state.lastXScale=n,t.state.lastYScale=o,{s:e,series:a,xScale:n,yScale:o,W:t.config.DIM.W,H:t.config.DIM.H,MT:t.config.DIM.MT,MB:t.config.DIM.MB,ML:t.config.DIM.ML,MR:t.config.DIM.MR,titles:i}},t.axis.makeScales=function(e,a){const r=t.config.DIM;if("histogram"===e.type){const s=a.flatMap(t=>t.y).filter(t=>Number.isFinite(t)),[i,n]=d3.extent(s),o=(n-i)/e.bins,l=d3.range(i,n,o),c=d3.max(a.map(t=>d3.max(d3.histogram().domain([i,n]).thresholds(l)(t.y),t=>t.length))),d=t.state.overrideX||[i,n],u=t.state.overrideMultiY?.[0]||[0,1.05*c];return{xScale:d3.scaleLinear().domain(d).range([r.ML,r.W-r.MR]),yScale:d3.scaleLinear().domain(u).range([r.H-r.MB,r.MT])}}if("bar"===e.type){const e=a.flatMap(t=>t.rawX),s=a.flatMap(t=>t.y).filter(t=>Number.isFinite(t)),[i,n]=d3.extent(s),o=.06*(n-i),l=t.state.overrideMultiY?.[0]||[i-o,n+o];return{xScale:d3.scaleBand().domain(e).range([r.ML,r.W-r.MR]).padding(t.ChartRegistry.get("bar").bandPadding),yScale:d3.scaleLinear().domain(l).range([r.H-r.MB,r.MT])}}const s=a.flatMap(t=>t.x).filter(t=>Number.isFinite(t)),i=a.flatMap(t=>t.y).filter(t=>Number.isFinite(t)),[n,o]=d3.extent(s),[l,c]=d3.extent(i),d=.02*(o-n),u=.06*(c-l);let p;p=t.state.overrideX?t.state.overrideX:"ftir"===e.mode||"nmr"===e.mode?[o+d,n-d]:[n-d,o+d];const m=t.state.overrideMultiY?.[0]?t.state.overrideMultiY[0]:[l-u,c+u];return{xScale:d3.scaleLinear().domain(p).range([r.ML,r.W-r.MR]),yScale:d3.scaleLinear().domain(m).range([r.H-r.MB,r.MT])}},t.axis.resetScales=function(e=!0){const a=t.state;e&&(a.overrideX=null,a.overrideMultiY={},a.overrideXTicks=null,a.overrideYTicks={},a.overrideScaleformatX=null,a.overrideScaleformatY={},a.overrideCustomTicksX=null,a.overrideCustomTicksY={},a.overrideCustomTicksTernary=null,a.overrideTernary=null,a.overrideTernaryTicks=null,a.minorTickOn={},a.useCustomTicksOn={});const r=function(t){if(!t.length)return null;const e=t.flatMap(t=>t.x),a=t.flatMap(t=>t.y),[r,s]=d3.extent(e),[i,n]=d3.extent(a),o=.02*(s-r),l=.06*(n-i);return{minX:r-o,maxX:s+o,minY:i-l,maxY:n+l}}(t.getSeries());r&&e&&(document.getElementById("scalemin").value=r.minX,document.getElementById("scalemax").value=r.maxX)}}(window.GraphPlotter),function(t){"use strict";function e(e,a=0){const r=d3.format(""),s=d3.format(".2s"),i=d3.format(".0e"),n=t.state;let o=0;return"x"===e?o=n.overrideScaleformatX??0:"y"===e?o=n.overrideScaleformatY?.[a]??0:"a"!==e&&"b"!==e&&"c"!==e||(o=n.overrideScaleformatTernary?.[e]??0),1===o?s:2===o?i:r}t.axis.getTitles=function(t){switch(t){case"uvvis":return{x:"Wavelength (nm)",y:"Absorbance (a.u.)"};case"tauc":return{x:"Energy (eV)",y:"Intensity (a.u.)"};case"xrd":return{x:"2θ (°)",y:"Intensity (a.u.)"};case"ftir":return{x:"Wavenumber (cm<sup>-1</sup>)",y:"Transmittance (%)"};case"raman":return{x:"Raman Shift (cm<sup>-1</sup>)",y:"Intensity (a.u.)"};case"pl":return{x:"Wavelength (nm)",y:"Intensity (a.u.)"};case"xps":return{x:"Binding Energy (eV)",y:"Intensity (cps)"};case"tga":return{x:"Temperature (°C)",y:"Weight (%)"};case"dsc":return{x:"Temperature (°C)",y:"Heat Flow (mW)"};case"bet":return{x:"Relative Pressure (P/P<sub>0</sub>)",y:"Adsorbed Volume (cm<sup>3</sup>·g<sup>-1</sup>)"};case"saxs":return{x:"Scattering Vector q (Å<sup>-1</sup>)",y:"Intensity (a.u.)"};case"nmr":return{x:"δ (ppm)",y:"Intensity (a.u.)"};case"ternary":return{a:"A-axis",b:"B-axis",c:"C-axis"};case"tensile":return{x:"Strain",y:"Stress"};default:return{x:"x-axis",y:"y-axis"}}},t.axis.applyTickStyles=function(e,a,r,s,i="currentColor"){const n=(t.state.tickLabelStyles[a]||{})[r]||{};e.selectAll("text").classed("tick-label",!0).classed(`tick-${a}`,!0).style("font-size",n.fontSize||s+"px").style("fill",n.color||i).style("font-family",n.fontFamily||"Arial").style("font-weight",n.fontWeight||"normal").style("font-style",n.fontStyle||"normal").style("cursor","default")},t.axis.addMinorTicks=function(e,a,r,s=0,i=4,n=1,o="currentColor"){if("function"!=typeof a.ticks)return;let l=null,c=null,d=!1;if(null!=e.attr("data-xi"))l=t.state.overrideCustomTicksX||null,d="X"===window.selectedAxisName,c="X";else if(null!=e.attr("data-yi")){const a=+e.attr("data-yi");l=t.state.overrideCustomTicksY&&t.state.overrideCustomTicksY[a]||null,d=window.selectedAxisName===(0===a?"Y":"Y"+(a+1)),c="Y"+a}else null!=e.attr("data-ai")?(l=t.state.overrideCustomTicksTernary?.a||null,d="A"===window.selectedAxisName,c="A"):null!=e.attr("data-bi")?(l=t.state.overrideCustomTicksTernary?.b||null,d="B"===window.selectedAxisName,c="B"):null!=e.attr("data-ci")&&(l=t.state.overrideCustomTicksTernary?.c||null,d="C"===window.selectedAxisName,c="C");if(!1===t.state.minorTickOn[c])return;const u=!0===t.state.useCustomTicksOn?.[c],p=a.domain();let m=[];if(u){if(!Array.isArray(l)||l.length<2)return;const t=l.filter(Number.isFinite).sort((t,e)=>t-e);for(let e=0;e<t.length-1;e++){const a=(t[e]+t[e+1])/2;a>=p[0]&&a<=p[1]&&m.push(a)}}else{if(r===d3.axisBottom?s=t.state.overrideXTicks??t.state.overrideTernaryTicks?.a??s:r===d3.axisLeft?s=t.state.overrideYTicks?.[0]??t.state.overrideTernaryTicks?.b??s:r===d3.axisRight&&(s=t.state.overrideTernaryTicks?.c??s),null==s)return;const e=a.ticks(s);if(e.length>=2){const t=e[1]-e[0];m=e.slice(0,-1).map(e=>e+t/2),e[0]-t/2>=p[0]&&m.unshift(e[0]-t/2),e[e.length-1]+t/2<=p[1]&&m.push(e[e.length-1]+t/2)}}if(!m.length)return;m=m.filter(t=>t>=Math.min(p[0],p[1])&&t<=Math.max(p[0],p[1]));const h=e.append("g").call(r(a).tickValues(m).tickSize(i).tickFormat(""));h.select("path.domain").remove(),h.selectAll("line").classed("minor-tick",!0).attr("stroke-width",n).attr("stroke",o)},t.axis.drawAxis=function(a,r,s,i,n){const o=t.config.DIM;if(["ternary","ternaryline","ternaryarea"].includes(i.type))return a.selectAll(".axis-title").remove(),void t.axis.renderTernaryAxes(a,i,o);a.selectAll(".axis-title.ternary").remove();const l=r.x,c=r.y,d=t.state.overrideCustomTicksX,u=d?null:t.state.overrideXTicks??i.xticks,p=t.state.overrideCustomTicksY&&t.state.overrideCustomTicksY[0],m=p?null:t.state.overrideYTicks&&null!=t.state.overrideYTicks[0]?t.state.overrideYTicks[0]:i.yticks,h=a.append("g").attr("data-xi",0).attr("transform","translate(0,"+(o.H-o.MB)+")").attr("stroke-width",i.scalewidth).call(d3.axisBottom(l).tickValues(d).ticks(u).tickSize(6).tickPadding(4).tickFormat("bar"===i.type?null:e("x",0)));t.axis.applyTickStyles(h,"x",0,i.scaleFs);const f=a.append("g").attr("data-yi",0).attr("transform","translate("+o.ML+",0)").attr("stroke-width",i.scalewidth).call(d3.axisLeft(c).tickValues(p).ticks(m).tickSize(6).tickPadding(4).tickFormat(e("y",0)));t.axis.applyTickStyles(f,"y",0,i.scaleFs),t.axis.addMinorTicks(h,l,d3.axisBottom,i.xticks,4,i.scalewidth,"currentColor"),t.axis.addMinorTicks(f,c,d3.axisLeft,i.yticks,4,i.scalewidth,"currentColor"),a.append("line").attr("x1",o.ML).attr("y1",o.MT).attr("x2",o.W-o.MR).attr("y2",o.MT).attr("stroke","black").attr("stroke-linecap","square").attr("stroke-width",i.scalewidth),a.append("line").attr("x1",o.W-o.MR).attr("y1",o.MT).attr("x2",o.W-o.MR).attr("y2",o.H-o.MB).attr("stroke","black").attr("stroke-linecap","square").attr("stroke-width",i.scalewidth),function(a,r,s,i){const n=r.y,o=t.config.DIM;if(1===s.multiyaxis&&["line","area","scatter","scatterline"].includes(s.type)&&i.length>1){if(r.y2=i.map((t,e)=>{if(0===e)return n;const[a,r]=d3.extent(t.y);return d3.scaleLinear().domain([a-.06*(r-a),r+.06*(r-a)]).range([o.H-o.MB,o.MT])}),t.state.multiYScales=r.y2,t.state.overrideMultiY)for(const[e,a]of Object.entries(t.state.overrideMultiY)){const r=+e;t.state.multiYScales[r]&&t.state.multiYScales[r].domain(a)}i.slice(1).forEach((r,i)=>{const n=i+1,l=t.state.overrideCustomTicksY&&t.state.overrideCustomTicksY[n],c=l?null:t.state.overrideYTicks&&null!=t.state.overrideYTicks[n]?t.state.overrideYTicks[n]:s.yticks,d=a.append("g").attr("data-yi",n).attr("transform",`translate(${o.W-o.MR+i*s.multiygap},0)`).attr("stroke-width",s.scalewidth).call(d3.axisRight(t.state.multiYScales[n]).tickValues(l).ticks(c).tickFormat(e("y",n)));d.selectAll("path,line").attr("stroke",r.color),t.axis.addMinorTicks(d,t.state.multiYScales[n],d3.axisRight,c,4,s.scalewidth,r.color),t.axis.applyTickStyles(d,"y",n,s.scaleFs,r.color)})}}(a,r,i,n),function(e,a,r){a.forEach(a=>{let s=e.select(`g.axis-title-${a.key}`);if(s.empty()){s=e.append("g").classed(`axis-title axis-title-${a.key} user-text`,!0).attr("data-axis-mode",r).attr("transform",`translate(${a.pos[0]},${a.pos[1]}) ${a.rotation?`rotate(${a.rotation})`:""}`.replace(/\s+/g," ")).call(t.utils.applyDrag);const i=t.utils.editableText(s,{x:0,y:0,text:a.label,rotation:0});i.div.html(a.label),i.fo.attr("width",i.div.node().scrollWidth+5).attr("x",-(i.div.node().scrollWidth+5)/2).attr("y",0),i.div.style("text-align",a.anchor||"middle")}else if(s.attr("data-axis-mode")!==r){const t=s.select("foreignObject");t.select("div").html(a.label);const e=t.select("div").node().scrollWidth+5;t.attr("width",e).attr("x",-e/2).attr("y",0),s.attr("data-axis-mode",r)}s.attr("transform",`translate(${a.pos[0]},${a.pos[1]}) ${a.rotation?`rotate(${a.rotation})`:""}`.replace(/\s+/g," "))})}(a,[{key:"x",label:s.x,pos:[o.W/2,o.H-o.MB/1.7],rotation:0,anchor:"middle"},{key:"y",label:s.y,pos:[o.ML-60,o.H/2],rotation:-90,anchor:"middle"}],i.mode)},t.axis.renderTernaryAxes=function(e,a,r){t.axis.drawTernaryAxis(e,a);const s=r.W-r.ML-r.MR,i=r.H-r.MT-r.MB,n=Math.min(s,2*i/Math.sqrt(3)),o=n*Math.sqrt(3)/2,l=[r.ML+(s-n)/2,r.MT+(i-o)/2+o],c=[l[0]+n,l[1]],d=[l[0]+n/2,l[1]-o];[{text:"A-axis",x:(c[0]+d[0])/2+50,y:(c[1]+d[1])/2-25,rot:60,cls:"tern-x"},{text:"B-axis",x:(l[0]+d[0])/2-50,y:(l[1]+d[1])/2-25,rot:-60,cls:"tern-y"},{text:"C-axis",x:(l[0]+c[0])/2,y:l[1]+25,rot:0,cls:"tern-z"}].forEach(({text:a,x:r,y:s,rot:i,cls:n})=>{const o=e.append("g").classed(`axis-title ternary ${n} user-text`,!0).attr("transform",`translate(${r},${s}) rotate(${i})`),{fo:l,div:c}=t.utils.editableText(o,{x:0,y:0,text:a,rotation:0});l.attr("width",c.node().scrollWidth+5).attr("x",-(c.node().scrollWidth+5)/2)})},t.axis.drawTernaryAxis=function(e,a){const r=t.config.DIM,s=r.W-r.ML-r.MR,i=r.H-r.MT-r.MB,n=Math.min(s,2*i/Math.sqrt(3)),o=n*Math.sqrt(3)/2,l=r.ML+(s-n)/2,c=r.MT+(i-o)/2+o,d=l+n,u=t.state.overrideTernary?.a||[0,100],p=t.state.overrideTernary?.b||[0,100],m=t.state.overrideTernary?.c||[0,100],h=d3.scaleLinear().domain(u).range([0,n]),f=d3.scaleLinear().domain(p).range([n,0]),y=d3.scaleLinear().domain(m).range([0,n]),g=t.state.overrideCustomTicksTernary?.a,v=t.state.overrideCustomTicksTernary?.b,x=t.state.overrideCustomTicksTernary?.c,k=g?null:t.state.overrideTernaryTicks?.a??a.xticks,w=v?null:t.state.overrideTernaryTicks?.b??a.xticks,b=x?null:t.state.overrideTernaryTicks?.c??a.xticks;t.state.axisScales={a:h,b:f,c:y};const T=e.append("g").attr("data-ai",0).attr("transform",`translate(${l},${c})`).attr("stroke-width",a.scalewidth).call(d3.axisBottom(h).tickValues(g).ticks(k).tickSize(6).tickPadding(4));t.axis.applyTickStyles(T,"a",0,a.scaleFs);const S=e.append("g").attr("data-bi",0).attr("transform",`translate(${l},${c}) rotate(210)`).attr("stroke-width",a.scalewidth).call(d3.axisLeft(f).tickValues(v).ticks(w).tickSize(-6).tickPadding(15));S.selectAll("text").attr("transform","rotate(-210)").style("text-anchor","middle").attr("dy","0px"),t.axis.applyTickStyles(S,"b",0,a.scaleFs);const M=e.append("g").attr("data-ci",0).attr("transform",`translate(${d},${c}) rotate(150)`).attr("stroke-width",a.scalewidth).call(d3.axisRight(y).tickValues(x).ticks(b).tickSize(-6).tickPadding(15));M.selectAll("text").attr("transform","rotate(-150)").style("text-anchor","middle").attr("dy","0px"),t.axis.applyTickStyles(M,"c",0,a.scaleFs),t.axis.addMinorTicks(T,h,d3.axisBottom,k,4,a.scalewidth,"currentColor"),t.axis.addMinorTicks(S,f,d3.axisLeft,w,-4,a.scalewidth,"currentColor"),t.axis.addMinorTicks(M,y,d3.axisRight,b,-4,a.scalewidth,"currentColor")},t.axis.drawTernaryGridLines=function(e,a){const r=t.config.DIM,s=r.W-r.ML-r.MR,i=r.H-r.MT-r.MB,n=Math.min(s,2*i/Math.sqrt(3)),o=n*Math.sqrt(3)/2,l=r.ML+(s-n)/2,c=r.MT+(i-o)/2+o,d=l+n,u=c,p=l+n/2,m=c-o,h=t.state.overrideTernary||{},f=[h.a||[0,100],h.b||[0,100],h.c||[0,100]],y=[[l,c,d,u,p,m],[d,u,l,c,p,m],[p,m,l,c,d,u]];[d3.scaleLinear().domain(f[0]).range([0,n]),d3.scaleLinear().domain(f[1]).range([n,0]),d3.scaleLinear().domain(f[2]).range([0,n])].forEach((t,r)=>t.ticks(a.xticks).forEach(t=>{if(t<=f[r][0]||t>=f[r][1])return;const s=(t-f[r][0])/(f[r][1]-f[r][0]),[i,n,o,l,c,d]=y[r];e.append("line").attr("x1",i+(o-i)*s).attr("y1",n+(l-n)*s).attr("x2",i+(c-i)*s).attr("y2",n+(d-n)*s).attr("stroke",a.gridcolor||"#ccc").attr("stroke-width",a.gridwidth||1).attr("stroke-dasharray","2,2")}))}}(window.GraphPlotter),function(t){"use strict";function e(e,a){document.getElementById(e).addEventListener("input",r=>{const s=parseFloat(r.target.value),i=parseFloat(document.getElementById("scalemin"===e?"scalemax":"scalemin").value);if(!isNaN(s)&&!isNaN(i)){if("X"===window.selectedAxisName)t.state.overrideX=a?[s,i]:[i,s];else if(window.selectedAxisName.startsWith("Y")){const e=window.activeYi||0;t.state.overrideMultiY=t.state.overrideMultiY||{},t.state.overrideMultiY[e]=a?[s,i]:[i,s]}else if(["A","B","C"].includes(window.selectedAxisName)){const e=window.selectedAxisName.toLowerCase();t.state.overrideTernary=t.state.overrideTernary||{},t.state.overrideTernary[e]=a?[s,i]:[i,s]}t.renderChart()}})}t.axis.tickEditing=function(e){e.selectAll("g.tick,path.domain,text.tick-label,line.minor-tick,g.tick line").style("cursor","pointer").on("click",e=>{e.stopPropagation(),t.utils.clearActive(),"bar"===document.querySelector('input[name="charttype"]:checked').id&&d3.select(e.currentTarget).classed("tick-x")||["scalemin","scalemax","tickcount","scaleformat","customticks","useCustomTicks","showMinorTicks"].forEach(t=>document.getElementById(t).disabled=!1);const a=e.currentTarget,r="path"===a.tagName?a.parentNode:"g"===a.tagName?a:a.closest("g[data-xi],g[data-yi],g[data-ai],g[data-bi],g[data-ci]");if(!r)return;const s=r.getAttribute("data-xi"),i=r.getAttribute("data-yi"),n=r.getAttribute("data-ai"),o=r.getAttribute("data-bi"),l=r.getAttribute("data-ci");let c,d,u,p;if(null!=s)u="X",p="X",c=d3.select(r).selectAll("text.tick-x"),d=t.state.lastXScale.domain();else if(null!=i)u="0"===i?"Y":"Y"+(+i+1),p="Y"+ +i,c=d3.select(r).selectAll("text.tick-y"),d=(t.state.multiYScales?.[i]||t.state.lastYScale).domain(),window.activeYi=+i;else if(null!=n)u="A",p="A",c=d3.select(r).selectAll("text.tick-a"),d=t.state.axisScales.a.domain();else if(null!=o)u="B",p="B",c=d3.select(r).selectAll("text.tick-b"),d=t.state.axisScales.b.domain();else{if(null==l)return;u="C",p="C",c=d3.select(r).selectAll("text.tick-c"),d=t.state.axisScales.c.domain()}window.selectedAxisName=u,c.attr("contenteditable",!0).style("outline","1px solid #4A90E2").style("cursor","pointer"),t.state.activeTicks=c;const m=t=>document.getElementById(t),h=m("axis-label"),f=m("scalemin"),y=m("scalemax"),g=m("tickcount"),v=m("scaleformat"),x=m("useCustomTicks"),k=m("customticks");h.textContent="Axis Settings: "+u,f.value=d[0].toFixed(2),y.value=d[1].toFixed(2);const w=["A","B","C"].includes(u),b=u.startsWith("Y"),T="X"===u?t.state.overrideCustomTicksX:w?t.state.overrideCustomTicksTernary?.[u.toLowerCase()]:t.state.overrideCustomTicksY?.[window.activeYi];k.value=T?.join(",")||"",g.value=("X"===u?t.state.overrideXTicks:w?t.state.overrideTernaryTicks?.[u.toLowerCase()]:t.state.overrideYTicks?.[window.activeYi])||c.size(),v.value="X"===u?t.state.overrideScaleformatX??0:u.startsWith("Y")?t.state.overrideScaleformatY?.[window.activeYi]??0:t.state.overrideScaleformatTernary?.[u.toLowerCase()]??0,document.querySelector('label[for="scaleformat"]').textContent=["Format: 00","Format: K","Format: e"][+v.value];const S="X"===u||b||w;x.disabled=!S,x.checked=!(!t.state.useCustomTicksOn||!t.state.useCustomTicksOn[p]),v.disabled=w,g.disabled=x.checked,k.disabled=!x.checked;const M=document.getElementById("showMinorTicks");M.disabled=!1,M.checked=!1!==t.state.minorTickOn[p]})},e("scalemin",!0),e("scalemax",!1),document.getElementById("tickcount").addEventListener("input",function(){const e=+this.value;if("X"===window.selectedAxisName)t.state.overrideXTicks=e;else if("Y"===window.selectedAxisName||window.selectedAxisName.startsWith("Y")){const a=window.activeYi;t.state.overrideYTicks=t.state.overrideYTicks||{},t.state.overrideYTicks[a]=e}else["A","B","C"].includes(window.selectedAxisName)&&(t.state.overrideTernaryTicks=t.state.overrideTernaryTicks||{},t.state.overrideTernaryTicks[window.selectedAxisName.toLowerCase()]=e);t.renderChart()}),document.getElementById("scaleformat").addEventListener("input",function(){const e=+this.value;if(document.querySelector('label[for="scaleformat"]').textContent=["Format: 00","Format: K","Format: e"][e],"X"===window.selectedAxisName)t.state.overrideScaleformatX=e;else if(window.selectedAxisName.startsWith("Y")){const a=window.activeYi||0;t.state.overrideScaleformatY=t.state.overrideScaleformatY||{},t.state.overrideScaleformatY[a]=e}t.renderChart()}),document.getElementById("customticks").addEventListener("input",function(){const e=this.value.trim(),a=e?e.split(",").map(t=>parseFloat(t.trim())).filter(t=>!isNaN(t)):null;if("X"===window.selectedAxisName)t.state.overrideCustomTicksX=a;else if(window.selectedAxisName.startsWith("Y")){const e=window.activeYi||0;t.state.overrideCustomTicksY=t.state.overrideCustomTicksY||{},a?t.state.overrideCustomTicksY[e]=a:delete t.state.overrideCustomTicksY[e]}else{const e=Array.from(t.state.activeTicks.nodes()[0].classList).find(t=>t.startsWith("tick-")&&!["tick-label","tick-x","tick-y"].includes(t));if(e){const r=e.split("-")[1];t.state.overrideCustomTicksTernary=t.state.overrideCustomTicksTernary||{},a?t.state.overrideCustomTicksTernary[r]=a:delete t.state.overrideCustomTicksTernary[r]}}t.renderChart()}),document.getElementById("useCustomTicks").addEventListener("change",function(){const e=this.checked,a=document.getElementById("customticks"),r=document.getElementById("tickcount");a.disabled=!e,r.disabled=e;const s="X"===window.selectedAxisName?"X":window.selectedAxisName.startsWith("Y")?"Y"+(window.activeYi||0):window.selectedAxisName;t.state.useCustomTicksOn=t.state.useCustomTicksOn||{},t.state.useCustomTicksOn[s]=e;if(e){const e=(i=a.value).trim()?i.split(",").map(t=>+t.trim()).filter(Number.isFinite):[];if("X"===s)t.state.overrideCustomTicksX=e;else if(s.startsWith("Y")){const a=window.activeYi||0;t.state.overrideCustomTicksY=t.state.overrideCustomTicksY||{},t.state.overrideCustomTicksY[a]=e}else{const a=s.toLowerCase();t.state.overrideCustomTicksTernary=t.state.overrideCustomTicksTernary||{},t.state.overrideCustomTicksTernary[a]=e}}else if("X"===s)t.state.overrideCustomTicksX=null;else if(s.startsWith("Y")){const e=window.activeYi||0;t.state.overrideCustomTicksY&&delete t.state.overrideCustomTicksY[e]}else{const e=s.toLowerCase();t.state.overrideCustomTicksTernary&&delete t.state.overrideCustomTicksTernary[e]}var i;t.renderChart()}),document.getElementById("showMinorTicks").addEventListener("change",function(){if(!window.selectedAxisName)return;let e="X"===window.selectedAxisName?"X":window.selectedAxisName.startsWith("Y")?"Y"+(window.activeYi||0):window.selectedAxisName;t.state.minorTickOn[e]=this.checked,t.renderChart()})}(window.GraphPlotter),function(t){"use strict";function e(e,a,r,s,i,n){switch(e.selectAll(".legend-marker").remove(),a){case"scatter":case"ternary":{const a=t.config.SYMBOL_TYPES[i%t.config.SYMBOL_TYPES.length],o=d3.symbol().type(a).size(Math.PI*r.symbolsize**2);e.append("path").classed("legend-marker",!0).attr("d",o).attr("transform",`translate(${n/2},0)`).attr("fill",s.color);break}case"scatterline":case"ternaryline":{e.append("line").classed("legend-marker",!0).attr("x2",n).attr("stroke",s.color).attr("stroke-width",r.linewidth);const a=t.config.SYMBOL_TYPES[i%t.config.SYMBOL_TYPES.length],o=d3.symbol().type(a).size(Math.PI*r.symbolsize**2);e.append("path").classed("legend-marker",!0).attr("d",o).attr("transform",`translate(${n/2},0)`).attr("fill",s.color);break}case"bar":case"histogram":e.append("rect").classed("legend-marker",!0).attr("width",n).attr("height",8).attr("y",-4).attr("fill",s.color);break;case"area":case"ternaryarea":e.append("rect").classed("legend-marker",!0).attr("width",n).attr("height",8).attr("y",-4).attr("fill",s.color).attr("fill-opacity",r.opacity);break;default:e.append("line").classed("legend-marker",!0).attr("x2",n).attr("stroke",s.color).attr("stroke-width",r.linewidth)}}t.ui.drawLegend=function(){const a=d3.select("#chart svg"),r=t.state.hot.getData(),s=r[0],i=t.getSeries(),n=t.getSettings(),o=s.map((e,a)=>"Y-axis"===e&&t.state.colEnabled[a]?a:-1).filter(t=>t>=0),l=t.config.DIM.W-t.config.DIM.MR-100,c=t.config.DIM.MT+25,d=a.selectAll("g.legend-group").data(o,t=>t);d.exit().remove(),d.attr("transform",function(t,e){return this.dataset.savedTransform||`translate(${l},${c+20*e})`});d.enter().append("g").classed("legend-group",1).attr("data-col",t=>t).attr("transform",(t,e)=>`translate(${l},${c+20*e})`).call(t.utils.applyDrag).each(function(a,s){e(d3.select(this),n.type,n,i[s],s,20);const o=t.utils.editableText(d3.select(this),{x:25,y:-10,text:r[2][a]});o.fo.attr("width",o.div.node().scrollWidth+o.pad);const l=o.div.node();l.addEventListener("click",t=>{t.stopPropagation(),l.focus()}),l.addEventListener("keydown",t=>{"Enter"===t.key&&(t.preventDefault(),l.blur())}),l.addEventListener("blur",function(){t.state.hot.setDataAtCell(2,a,l.textContent.trim(),"paste"),t.state.hot.render(),d3.select(l).attr("contenteditable",!1).style("outline","none").style("cursor","move")})}),d.select("foreignObject div").text(t=>r[2][t]),d.each(function(t,a){d3.select(this).selectAll(".legend-marker").remove(),e(d3.select(this),n.type,n,i[a],a,20)})},t.ui.drawErrorBars=function(t,e,a,r){const s=("bar"===r.type&&a.x.bandwidth?a.x.bandwidth():0)/e.length,i="bar"===r.type?.2*s:r.symbolsize;e.forEach((e,n)=>{e.error&&e.rawX.forEach((o,l)=>{const c=e.error[l];if(!isFinite(c))return;const d="bar"===r.type?a.x(o)+n*s+s/2:a.x(o),u=a.y(e.y[l]+c),p=a.y(e.y[l]-c);t.append("line").attr("x1",d).attr("x2",d).attr("y1",u).attr("y2",p).attr("stroke",e.errorColor).attr("stroke-width",r.linewidth),[u,p].forEach(a=>t.append("line").attr("x1",d-i).attr("x2",d+i).attr("y1",a).attr("y2",a).attr("stroke",e.errorColor).attr("stroke-width",r.linewidth))})})}}(window.GraphPlotter),function(t){"use strict";t.ui.toolTip=function(e,a){const r=d3.select("#tooltip");e.on("mousemove",function(s){const[i,n]=d3.pointer(s,e.node());if(i<t.config.DIM.ML||i>t.config.DIM.W-t.config.DIM.MR||n<t.config.DIM.MT||n>t.config.DIM.H-t.config.DIM.MB)return;const o=a.xScale.invert(i).toFixed(4),l=a.yScale.invert(n).toFixed(4);r.html("X-Scale:<b> "+o+"</b><br>Y-Scale:<b> "+l+"</b>")})},t.ui.areacalculation=function(){const e=d3.select("#chart svg");if(e.empty())return;const a=d3.brushX().extent([[t.config.DIM.ML,t.config.DIM.MT],[t.config.DIM.W-t.config.DIM.MR,t.config.DIM.H-t.config.DIM.MB]]).on("end",function({selection:a}){if(e.selectAll(".area-highlight").remove(),!a)return void d3.select("#areaResults").html("");const[r,s]=a,i=t.state.lastXScale.invert(r),n=t.state.lastXScale.invert(s),o=Math.min(i,n),l=Math.max(i,n),c=document.querySelector('input[name="axistitles"]:checked').value,d="ftir"===c?100:t.state.lastYScale.domain()[0]<=0&&0<=t.state.lastYScale.domain()[1]?0:t.state.lastYScale.domain()[0],u=t.state.lastYScale(d);let p="";t.getSeries().forEach(a=>{const r=a.x.map((t,e)=>({x:t,y:a.y[e]})).filter(t=>t.x>=o&&t.x<=l);if(r.length<2)return;let s=0;for(let t=0;t<r.length-1;t++){s+=(r[t+1].x-r[t].x)*("ftir"===c?d-(r[t].y+r[t+1].y)/2:(r[t].y+r[t+1].y)/2)}e.append("path").datum(r).attr("class","area-highlight").attr("d",d3.area().x(e=>t.state.lastXScale(e.x)).y0(()=>u).y1(e=>t.state.lastYScale(e.y))).attr("fill",a.color).attr("fill-opacity","ftir"===c?.1:.2).lower(),p+=`<div style="color:${a.color};">${a.label}: Area = <b>${s.toFixed(4)}</b></div>`}),d3.select("#areaResults").html(p||"<em>No data in selected range.</em>")}),r=e.append("g").attr("class","area-brush").style("display","none").call(a);d3.select("#enableAreaCalc").on("change",function(){this.checked?r.style("display",null):(r.style("display","none").call(a.move,null),e.selectAll(".area-highlight").remove(),d3.select("#areaResults").html(""))})},t.ui.disableAreaCal=function(){const t=document.getElementById("enableAreaCalc");t.checked&&(t.checked=!1,t.dispatchEvent(new Event("change")))}}(window.GraphPlotter),function(t){"use strict";function e(e,a){if(t.state.activeTicks){var r="color"==e?"fill":"fontSize"==e?"font-size":"fontFamily"==e?"font-family":"fontWeight"==e?"font-weight":"fontStyle"==e?"font-style":e,s=(t.state.activeTicks.attr("class")||"").split(/\s+/).find(t=>t.startsWith("tick-")&&"tick-label"!==t);if(s){var i=s.slice(5),n="y"==i&&window.activeYi||0;t.state.tickLabelStyles[i]=t.state.tickLabelStyles[i]||{},t.state.tickLabelStyles[i][n]=t.state.tickLabelStyles[i][n]||{},t.state.tickLabelStyles[i][n][e]=a,t.state.activeTicks.style(r,a)}}}function a(){if(void 0!==t.state.activeText&&t.state.activeText)return t.state.activeText.node?t.state.activeText.node():t.state.activeText;if(void 0!==t.state.activeDiv&&t.state.activeDiv)return t.state.activeDiv.node?t.state.activeDiv.node():t.state.activeDiv;const e=window.getSelection&&window.getSelection();if(!e||0===e.rangeCount)return null;let a=e.anchorNode instanceof Element?e.anchorNode:e.anchorNode&&e.anchorNode.parentElement;if(!a)return null;return a.closest&&a.closest("foreignObject > div[contenteditable]")||null}function r(){const t=a(),e=!!t&&document.queryCommandState("superscript"),r=!!t&&document.queryCommandState("subscript"),s=document.getElementById("supBtn"),i=document.getElementById("subBtn");e?(s.classList.add("active"),i.classList.remove("active")):r?(i.classList.add("active"),s.classList.remove("active")):(s.classList.remove("active"),i.classList.remove("active"))}t.ui.refs.colorCtrl=d3.select("#addedtextcolor"),t.ui.refs.sizeCtrl=d3.select("#addedtextsize"),t.ui.refs.addTextBtn=d3.select("#addtext"),t.ui.refs.rmBtn=d3.select("#removebtn"),t.ui.refs.fontCtrl=d3.select("#fontfamily"),t.ui.refs.boldBtn=d3.select("#boldBtn"),t.ui.refs.italicBtn=d3.select("#italicBtn"),t.ui.refs.colorCtrl.on("input",function(){const a=this.value,r=t.state.activeText||t.state.activeDiv;if(r&&r.style("color",a),t.state.activeTicks&&e("color",a),t.state.activeGroup){const e=t.state.activeGroup.select(".shape"),r=e.node().tagName.toLowerCase();"rect"!==r&&"ellipse"!==r||"none"===e.attr("fill")?e.attr("stroke",a):e.attr("fill",a).attr("stroke",a),t.features.updateArrowMarkerColor(e,a)}}),t.ui.refs.sizeCtrl.on("input",a=>{const r=a.target.value+"px";if(e("fontSize",r),t.state.activeText||t.state.activeDiv){const e=t.state.activeText||t.state.activeDiv;e.style("font-size",r),t.state.activeFo&&t.state.activeFo.attr("width",e.node().scrollWidth+5)}if(!t.state.activeGroup)return;const s=+a.target.value,i=5+s/2,n=t.state.activeGroup.select(".shape"),o=t.state.activeGroup.select(".outline"),l=t.state.activeGroup.select(".hit");if(n.attr("stroke-width",s),l.attr("stroke-width","rect"==n.node().tagName?2*i:s+2*i),"rect"==n.node().tagName){const e=t.features.bufferOutline(n,i);o.attr("x",e.x).attr("y",e.y).attr("width",e.w).attr("height",e.h)}else{const e=t.features.bufferOutline(n,i);o.attr("points",e.join(" "))}}),t.ui.refs.fontCtrl.on("change",a=>{const r=a.target.value;e("fontFamily",r);const s=t.state.activeText||t.state.activeDiv||t.state.activeTicks;if(s&&s.style("font-family",r),t.state.activeFo){const e=t.state.activeFo,a=e.select("div").node();e.attr("width",a.scrollWidth+5)}}),t.ui.refs.boldBtn.on("click",()=>{const a=!t.ui.refs.boldBtn.classed("active");t.ui.refs.boldBtn.classed("active",a),e("fontWeight",a?"bold":"normal");const r=t.state.activeText||t.state.activeDiv||t.state.activeTicks;r&&r.style("font-weight",a?"bold":"normal")}),t.ui.refs.italicBtn.on("click",()=>{const a=!t.ui.refs.italicBtn.classed("active");t.ui.refs.italicBtn.classed("active",a),e("fontStyle",a?"italic":"normal");const r=t.state.activeText||t.state.activeDiv||t.state.activeTicks;r&&r.style("font-style",a?"italic":"normal")}),t.ui.applySupSub=function(t){const e=a();if(!e)return;e.focus();const s=document.queryCommandState("superscript"),i=document.queryCommandState("subscript");"sup"===t?(s||i&&document.execCommand("subscript",!1,null),document.execCommand("superscript",!1,null)):(i||s&&document.execCommand("superscript",!1,null),document.execCommand("subscript",!1,null)),function(t){const e=t&&t.parentNode;e&&e.tagName&&"foreignobject"===e.tagName.toLowerCase()&&(e.setAttribute("width",t.scrollWidth+5),e.setAttribute("height",t.scrollHeight+5))}(e),r()},document.getElementById("supBtn").addEventListener("mousedown",e=>{e.preventDefault(),t.ui.applySupSub("sup")}),document.getElementById("subBtn").addEventListener("mousedown",e=>{e.preventDefault(),t.ui.applySupSub("sub")}),document.addEventListener("selectionchange",r),document.addEventListener("mouseup",r),document.addEventListener("keyup",r),t.ui.refs.rmBtn.on("click",()=>{if(t.state.activeGroup)t.state.activeGroup.style("display","none"),t.state.activeGroup=null;else if(t.state.activeFo){const e=t.state.activeFo.node().parentNode;e.classList.contains("legend-group")?d3.select(e).style("display","none"):d3.select(t.state.activeFo.node()).style("display","none")}t.state.activeFo=t.state.activeDiv=null,t.ui.refs.rmBtn.classed("disabled",!0)})}(window.GraphPlotter),function(t){"use strict";function e(e){e.select(".hit").style("cursor","move").on("click",a=>{t.state.hot.deselectCell(),a.stopPropagation(),t.features.activateShape(d3.select(e.node()))}),e.call(t.utils.applyDrag)}t.features.activateShape=function(e){if(t.state.activeGroup===e)return;e.select(".outline").attr("visibility","visible"),t.state.activeGroup=e;e.select(".shape");t.utils.updateInspector(e.select(".shape"))},t.features.activateText=function(e,a){if(t.state.activeText===e)return;e.attr("contenteditable",!0).style("border","1px solid rgb(74,144,226)").node().focus(),t.state.activeText=e,t.state.activeFo=a,t.utils.updateInspector(e);const r=e.node();setTimeout(()=>{const t=document.createRange();t.selectNodeContents(r);const e=window.getSelection();e.removeAllRanges(),e.addRange(t)},0)},t.features.updateArrowMarkerColor=function(t,e){let a=t.attr("marker-end");if(a&&a.startsWith("url(#arrowhead-")){let t=a.slice(5,-1);d3.select(`#${t} path`).attr("fill",e)}},t.features.bufferOutline=function(t,e){const a=t.node().tagName;if("rect"===a){return{x:+t.attr("x")-e,y:+t.attr("y")-e,w:+t.attr("width")+2*e,h:+t.attr("height")+2*e}}if("ellipse"===a){return{cx:+t.attr("cx"),cy:+t.attr("cy"),rx:+t.attr("rx")+e,ry:+t.attr("ry")+e}}{const a=+t.attr("x1"),r=+t.attr("y1"),s=+t.attr("x2"),i=+t.attr("y2"),n=s-a,o=i-r,l=Math.hypot(n,o),c=-o/l,d=n/l;return[[a+c*e,r+d*e],[s+c*e,i+d*e],[s-c*e,i-d*e],[a-c*e,r-d*e]]}},t.features.prepareShapeLayer=function(){const a=d3.select("#chart svg");a.on("click.shapeBackground",e=>{e.target===a.node()&&t.utils.clearActive()}),a.on("mousedown.draw",function(e){if("none"===t.state.shapeMode)return;e.preventDefault(),t.state.drawing=!0;const[r,s]=d3.pointer(e,a.node()),i="fillRect"===t.state.shapeMode||"fillEllipse"===t.state.shapeMode?"#96d35f":"#000000",n=t.state.shapeMode,o=/rect/i.test(n),l=/line|arrow/i.test(n),c=/arrow/i.test(n),d=/dashed/i.test(n),u="fillRect"===n||"fillEllipse"===n,p=/ellipse/i.test(n);l?(t.state.tempShape=a.append("line").attr("x1",r).attr("y1",s).attr("x2",r).attr("y2",s).attr("stroke",i).attr("stroke-width",1).attr("fill","none"),c&&t.state.tempShape.attr("marker-end",`url(#${function(e,a){let r="arrowhead-"+ ++t.state.arrowCount,s=e.select("defs");return s.empty()&&(s=e.append("defs")),s.append("marker").attr("id",r).attr("viewBox","0 -5 10 10").attr("refX",1).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill",a),r}(a,i)})`),d&&t.state.tempShape.attr("stroke-dasharray","7,5")):o?(t.state.tempShape=a.append("rect").attr("x",r).attr("y",s).attr("width",0).attr("height",0),u?t.state.tempShape.attr("stroke",i).attr("stroke-width",.5).attr("fill",i).attr("fill-opacity",.2):(t.state.tempShape.attr("stroke",i).attr("stroke-width",1).attr("fill","none"),d&&t.state.tempShape.attr("stroke-dasharray","7,5"))):p&&(t.state.tempShape=a.append("ellipse").attr("cx",r).attr("cy",s).attr("rx",0).attr("ry",0),u?t.state.tempShape.attr("stroke",i).attr("stroke-width",.5).attr("fill",i).attr("fill-opacity",.2):(t.state.tempShape.attr("stroke",i).attr("stroke-width",1).attr("fill","none"),d&&t.state.tempShape.attr("stroke-dasharray","7,5"))),t.state.drawStart={x:r,y:s}}),a.on("mousemove.draw",function(e){if(!t.state.drawing||!t.state.tempShape)return;const[r,s]=d3.pointer(e,a.node()),i=t.state.tempShape.node().tagName;if("rect"===i){const e=t.state.drawStart.x,a=t.state.drawStart.y,i=r-e,n=s-a;t.state.tempShape.attr("x",i<0?r:e).attr("y",n<0?s:a).attr("width",Math.abs(i)).attr("height",Math.abs(n))}else if("ellipse"===i){const e=r-t.state.drawStart.x,a=s-t.state.drawStart.y,i=Math.abs(e)/2,n=Math.abs(a)/2,o=t.state.drawStart.x+(e<0?-i:i),l=t.state.drawStart.y+(a<0?-n:n);t.state.tempShape.attr("cx",o).attr("cy",l).attr("rx",i).attr("ry",n)}else t.state.tempShape.attr("x2",r).attr("y2",s)}),a.on("mouseup.draw mouseleave.draw",function(){if(!t.state.drawing||!t.state.tempShape)return;t.state.drawing=!1;const r=t.state.tempShape.node().tagName,s=t.state.tempShape.attr("stroke"),i=+t.state.tempShape.attr("stroke-width")||1,n=t.state.tempShape.node().getBBox();if(n.width<5&&n.height<5||"line"===r&&Math.hypot(n.width,n.height)<5)t.state.tempShape.remove(),t.state.tempShape=null;else{t.state.tempShape.remove();const n=a.append("g").classed("shape-group",!0),o=5;if("line"===r){const e={x1:+t.state.tempShape.attr("x1"),y1:+t.state.tempShape.attr("y1"),x2:+t.state.tempShape.attr("x2"),y2:+t.state.tempShape.attr("y2")};n.append("line").classed("hit",1).attr("x1",e.x1).attr("y1",e.y1).attr("x2",e.x2).attr("y2",e.y2).attr("stroke","transparent").attr("stroke-width",i+2*o).attr("fill","none");let a=n.append("line").classed("shape",1).attr("x1",e.x1).attr("y1",e.y1).attr("x2",e.x2).attr("y2",e.y2).attr("stroke",s).attr("stroke-width",i).attr("fill","none").attr("pointer-events","none");t.state.tempShape.attr("marker-end")&&a.attr("marker-end",t.state.tempShape.attr("marker-end")),t.state.tempShape.attr("stroke-dasharray")&&a.attr("stroke-dasharray",t.state.tempShape.attr("stroke-dasharray"));const r=t.features.bufferOutline(a,o+i/2);n.append("polygon").classed("outline",1).attr("points",r.join(" ")).attr("stroke","rgb(74,144,226)").attr("stroke-width",1).attr("fill","none").attr("pointer-events","none").attr("visibility","hidden")}else if("rect"===r){const e={x:+t.state.tempShape.attr("x"),y:+t.state.tempShape.attr("y"),width:+t.state.tempShape.attr("width"),height:+t.state.tempShape.attr("height")};let a;n.append("rect").classed("hit",1).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("stroke","transparent").attr("stroke-width","fillRect"===t.state.shapeMode?2*o:i+2*o).attr("fill","none"),"fillRect"===t.state.shapeMode?a=n.append("rect").classed("shape",1).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("stroke",s).attr("stroke-width",.5).attr("fill",s).attr("fill-opacity",.2):(a=n.append("rect").classed("shape",1).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("stroke",s).attr("stroke-width",i).attr("fill","none"),t.state.tempShape.attr("stroke-dasharray")&&a.attr("stroke-dasharray",t.state.tempShape.attr("stroke-dasharray")));const r=t.features.bufferOutline(a,o);n.append("rect").classed("outline",1).attr("x",r.x).attr("y",r.y).attr("width",r.w).attr("height",r.h).attr("stroke","rgb(74,144,226)").attr("stroke-width",1).attr("fill","none").attr("pointer-events","none").attr("visibility","hidden")}else if("ellipse"===r){const e=+t.state.tempShape.attr("cx"),a=+t.state.tempShape.attr("cy"),r=+t.state.tempShape.attr("rx"),l=+t.state.tempShape.attr("ry");let c;n.append("ellipse").classed("hit",1).attr("cx",e).attr("cy",a).attr("rx",r).attr("ry",l).attr("stroke","transparent").attr("stroke-width","fillEllipse"===t.state.shapeMode?2*o:i+2*o).attr("fill","none"),"fillEllipse"===t.state.shapeMode?c=n.append("ellipse").classed("shape",1).attr("cx",e).attr("cy",a).attr("rx",r).attr("ry",l).attr("stroke",s).attr("stroke-width",.5).attr("fill",s).attr("fill-opacity",.2):(c=n.append("ellipse").classed("shape",1).attr("cx",e).attr("cy",a).attr("rx",r).attr("ry",l).attr("stroke",s).attr("stroke-width",i).attr("fill","none"),t.state.tempShape.attr("stroke-dasharray")&&c.attr("stroke-dasharray",t.state.tempShape.attr("stroke-dasharray"))),n.append("ellipse").classed("outline",1).attr("cx",e).attr("cy",a).attr("rx",r+o).attr("ry",l+o).attr("stroke","rgb(74,144,226)").attr("stroke-width",1).attr("fill","none").attr("pointer-events","none").attr("visibility","hidden")}e(n),setTimeout(()=>t.features.activateShape(n),0),t.state.tempShape=null}d3.selectAll('input[name="shape"]').property("checked",!1),t.state.shapeMode="none"})},t.ui.refs.addTextBtn.on("click",function(){t.ui.disableAreaCal();const e=d3.select("#chart svg");if(e.empty())return;const{fo:a,div:r}=t.utils.editableText(e,{x:t.config.DIM.W/2-t.config.DIM.MT,y:t.config.DIM.H/2-t.config.DIM.MR,text:"Text",rotation:0});a.classed("user-text",1).call(t.utils.applyDrag),t.utils.clearActive(),t.features.activateText(r,a)}),d3.selectAll('input[name="shape"]').on("change",function(){t.ui.disableAreaCal(),t.state.shapeMode=this.value,t.utils.clearActive()}),t.features.makeShapeInteractive=e}(window.GraphPlotter),function(t){"use strict";$("#zoomBtn").click(function(){const e=$(this);if(e.hasClass("active"))return d3.select(".zoom-brush").remove(),void e.removeClass("active");e.addClass("active");const a=document.getElementById("enableAreaCalc");a.checked&&(a.checked=!1,a.dispatchEvent(new Event("change")));const r=d3.select("#chart svg");r.empty()||r.append("g").attr("class","zoom-brush").style("cursor","crosshair").call(d3.brush().extent([[t.config.DIM.ML,t.config.DIM.MT],[t.config.DIM.W-t.config.DIM.MR,t.config.DIM.H-t.config.DIM.MB]]).on("end",({selection:a})=>{if(r.select(".zoom-brush").remove(),e.removeClass("active"),!a)return;const[[s,i],[n,o]]=a,l=t.state.lastXScale.invert(s),c=t.state.lastXScale.invert(n),d=t.state.lastXScale.domain(),u=d[0]>d[1]?[Math.max(l,c),Math.min(l,c)]:[Math.min(l,c),Math.max(l,c)],p=[t.state.lastYScale.invert(i),t.state.lastYScale.invert(o)].sort((t,e)=>t-e);t.state.overrideX=u,t.state.overrideMultiY=t.state.overrideMultiY||{},t.state.overrideMultiY[0]=p,document.getElementById("scalemin").value=u[0].toFixed(2),document.getElementById("scalemax").value=u[1].toFixed(2),t.renderChart()}))}),d3.select("#chart").on("dblclick",()=>{t.axis.resetScales(!0),t.renderChart()})}(window.GraphPlotter),function(t){"use strict";function e(t,e){const a=Math.floor(e/2),r=[];for(let e=0;e<t.length;e++){let s=0,i=0;for(let r=e-a;r<=e+a;r++)r>=0&&r<t.length&&isFinite(t[r])&&(s+=t[r],i++);r[e]=i?s/i:NaN}return r}function a(t,e){const a=Math.floor(e/2),r=[],s=[];for(let e=0;e<t.length;e++){let s=1/0;for(let r=e-a;r<=e+a;r++)r>=0&&r<t.length&&isFinite(t[r])&&(s=Math.min(s,t[r]));r[e]=s===1/0?NaN:s}for(let t=0;t<r.length;t++){let e=-1/0;for(let s=t-a;s<=t+a;s++)s>=0&&s<r.length&&isFinite(r[s])&&(e=Math.max(e,r[s]));s[t]=e===-1/0?NaN:e}return s}function r(e,a,r){const s=t.state.hot.getData(),i=s[0],n=s.slice(3),o=s[2].slice();i.forEach((l,c)=>{if("Y-axis"===l&&t.state.colEnabled[c]){if("corrected"===e&&o[c].includes("(baseline)"))return;const l=n.map(t=>parseFloat(t[c])||NaN),d=a(l,r),u=s[1].length;i.push("Y-axis"),s[1].push(t.config.COLORS[u%t.config.COLORS.length]),s[2].push(`${o[c]} (${e})`),n.forEach((t,e)=>t.push(d[e]))}}),t.state.hot.loadData(s),t.axis.resetScales(!0),t.renderChart()}document.getElementById("applysmoothing").onclick=()=>{const t=+document.getElementById("smoothingslider").value;t>0&&(r("smoothed",e,t),document.getElementById("smoothingslider").value=0)},document.getElementById("applybaseline").onclick=()=>{const e=+document.getElementById("baselineslider").value;if(e<=0)return;"ftir"===t.getSettings().mode?(r("baseline",(t,e)=>a(t.map(t=>-t),e).map(t=>-t),e),r("corrected",(t,e)=>{const r=a(t.map(t=>-t),e).map(t=>-t);return t.map((t,e)=>isFinite(t)&&isFinite(r[e])?t/r[e]*100:NaN)},e)):(r("baseline",a,e),r("corrected",(t,e)=>{const r=a(t,e);return t.map((t,e)=>isFinite(t)&&isFinite(r[e])?t-r[e]:NaN)},e)),document.getElementById("baselineslider").value=0},["smoothing","baseline"].forEach(r=>document.getElementById(r+"slider").addEventListener("input",s=>{"smoothing"===r&&t.renderChart(),function(e,r,s){const i=d3.select("#chart svg");if(i.selectAll(`g.${s}`).remove(),r<=0)return;const n=t.getSettings(),o="ftir"===n.mode&&"baseline-preview"===s,l=t.getSeries().map(t=>{let s;return s=o?a(t.y.map(t=>-t),r).map(t=>-t):e(t.y,r),{rawX:t.rawX,x:t.x,y:s,color:t.color}}),c=t.ChartRegistry.get(n.type),d=i.append("g").classed(s,!0).attr("clip-path","url(#clip)");c.draw(d,l,{x:t.state.lastXScale,y:t.state.lastYScale},n),d.selectAll("path").attr("stroke","gray").attr("stroke-width",n.linewidth)}("smoothing"===r?e:a,+s.target.value,`${r}-preview`)}))}(window.GraphPlotter),function(t){"use strict";function e(t,e){const a=[],r=[];for(let s=0;s<t.length;s++){const i=+t[s],n=+e[s];Number.isFinite(i)&&Number.isFinite(n)&&(a.push(i),r.push(n))}const s=a.length;if(s<2)return null;let i=0,n=0,o=0,l=0,c=0;for(let t=0;t<s;t++){const e=a[t],s=r[t];i+=e,n+=s,o+=e*e,l+=e*s,c+=s*s}const d=s*o-i*i;if(0===d)return null;const u=(s*l-i*n)/d,p=(n-u*i)/s,m=n/s;let h=0,f=0;for(let t=0;t<s;t++){const e=r[t],s=u*a[t]+p;h+=(e-m)*(e-m),f+=(e-s)*(e-s)}return{m:u,b:p,r2:h>0?1-f/h:1}}function a(t,e){let a=0,r=0,s=0,i=0,n=0,o=0,l=0,c=0,d=0;for(let u=0;u<t.length;u++){const p=+t[u],m=+e[u];if(Number.isFinite(p)&&Number.isFinite(m)){const t=p*p,e=t*p;a+=1,r+=p,s+=t,i+=e,n+=e*p,o+=m,l+=p*m,c+=t*m,d++}}if(d<3)return null;const u=function(t,e){let a=t.map(t=>t.slice()),r=e.slice();for(let t=0;t<3;t++){let e=t;for(let r=t+1;r<3;r++)Math.abs(a[r][t])>Math.abs(a[e][t])&&(e=r);[a[t],a[e]]=[a[e],a[t]],[r[t],r[e]]=[r[e],r[t]];const s=a[t][t];if(0===s)return null;for(let e=t;e<3;e++)a[t][e]/=s;r[t]/=s;for(let e=0;e<3;e++)if(e!==t){const s=a[e][t];for(let r=t;r<3;r++)a[e][r]-=s*a[t][r];r[e]-=s*r[t]}}return r}([[n,i,s],[i,s,r],[s,r,a]],[c,l,o]);if(!u)return null;const[p,m,h]=u;let f=o/a,y=0,g=0;for(let a=0;a<t.length;a++){const r=+t[a],s=+e[a];if(Number.isFinite(r)&&Number.isFinite(s)){const t=p*r*r+m*r+h;y+=(s-f)*(s-f),g+=(s-t)*(s-t)}}return{a:p,b:m,c:h,r2:y>0?1-g/y:1}}document.getElementById("applyfit").onclick=function(){const r=d3.select(this);if(r.classed("active"))return d3.select(".fit-brush").remove(),void r.classed("active",!1).style("background",null);const s=t.state.hot.getData(),i=s[0],n=s[1],o=s[2],l=s.slice(3),c=[];for(let e=0;e<i.length;e++)"Y-axis"===i[e]&&t.state.colEnabled[e]&&c.push(e);if(!c.length)return void alert("No enabled Y series.");const d=i.map((e,a)=>"X-axis"===e&&t.state.colEnabled[a]?a:-1).filter(t=>t>=0);if(!d.length)return void alert("Missing X-axis.");r.classed("active",!0).style("background","#c6c6c6");const u=d3.select("#chart svg");u.empty()||u.append("g").attr("class","fit-brush").style("cursor","crosshair").call(d3.brushX().extent([[t.config.DIM.ML,t.config.DIM.MT],[t.config.DIM.W-t.config.DIM.MR,t.config.DIM.H-t.config.DIM.MB]]).on("end",({selection:s})=>{if(u.select(".fit-brush").remove(),r.classed("active",!1).style("background",null),!s)return;const[p,m]=s.map(t.state.lastXScale.invert),h=Math.min(p,m),f=Math.max(p,m),y=(document.querySelector('input[name="fit"]:checked')||{value:"linear"}).value,g=[];for(const r of c){let s=-1;for(let t=0;t<d.length;t++){const e=d[t],a=d[t+1]??i.length;if(r>e&&r<a){s=e;break}}if(s<0)continue;const c=o[r],u=[],p=[];if(l.forEach(t=>{const e=parseFloat(t[s]),a=parseFloat(t[r]);Number.isFinite(e)&&Number.isFinite(a)&&e>=h&&e<=f&&(u.push(e),p.push(a))}),!(u.length<2))if("linear"===y){const a=e(u,p);if(!a)continue;const r=l.map(t=>{const e=parseFloat(t[s]);return Number.isFinite(e)&&e>=h&&e<=f?(r=a.m,i=a.b,r*e+i):"";var r,i});i.push("Y-axis"),n.push(t.config.COLORS[n.length%t.config.COLORS.length]),o.push(c+" (fit)"),l.forEach((t,e)=>t.push(r[e])),g.push(`${c}: m=${a.m.toFixed(6)}, b=${a.b.toFixed(6)}, R<sup>2</sup>=${a.r2.toFixed(5)}`)}else{if(u.length<3)continue;const e=a(u,p);if(!e)continue;const r=l.map(t=>{const a=parseFloat(t[s]);return Number.isFinite(a)&&a>=h&&a<=f?(r=e.a,i=e.b,n=e.c,r*(o=a)*o+i*o+n):"";var r,i,n,o});i.push("Y-axis"),n.push(t.config.COLORS[n.length%t.config.COLORS.length]),o.push(c+" (fit)"),l.forEach((t,e)=>t.push(r[e])),g.push(`${c}: a=${e.a.toExponential(3)}, b=${e.b.toExponential(3)}, c=${e.c.toExponential(3)}, R<sup>2</sup>=${e.r2.toFixed(5)}`)}}t.state.hot.loadData([i,n,o,...l]);for(let e=0;e<i.length;e++)void 0===t.state.colEnabled[e]&&(t.state.colEnabled[e]=!0);t.state.hot.render(),t.axis.resetScales(!1),t.renderChart();const v=t.config.DIM.ML+6,x=t.config.DIM.MT+12,k=d3.select("#chart svg"),w=k.selectAll("foreignObject.user-text").size();g.forEach((e,a)=>{const r=t.utils.editableText(k,{x:v,y:x+16*(w+a),text:e,rotation:0});r.div.html(e),r.fo.attr("width",r.div.node().scrollWidth+r.pad).attr("height",r.div.node().scrollHeight+r.pad),r.fo.classed("user-text",!0).call(t.utils.applyDrag)})}))}}(window.GraphPlotter),function(t){"use strict";document.getElementById("generateTauc").addEventListener("click",()=>{const e=parseFloat(document.querySelector('input[name="tauc"]:checked').value),a=t.state.hot.getData().map(t=>t.slice()),r=a[0],s=a[1],i=a[2],n=r.length,o=r.indexOf("X-axis"),l=r.indexOf("Y-axis",o+1);if(o<0||l<0)return alert("Missing X-axis or Y-axis");a.forEach(t=>t.splice(n)),r.splice(n),s.splice(n),i.splice(n);const c=[];for(let t=3;t<a.length;t++)c[t]=1240/parseFloat(a[t][o]);r.push("X-axis"),s.push(s[o]),i.push(i[o]),r.push("Y-axis"),s.push(s[l]),i.push(i[l]+` (Tauc n=${e})`);for(let t=3;t<a.length;t++)a[t].push(c[t],Math.pow(2.303*c[t]*parseFloat(a[t][l]),e));t.state.hot.loadData(a),t.state.colEnabled={};const d=r.length;for(let e=0;e<d;e++)t.state.colEnabled[e]=e>=n;document.getElementById("axis-tauc").checked=!0,t.state.hot.render(),t.axis.resetScales(!0),t.renderChart()})}(window.GraphPlotter),function(){"use strict";const t={xrd:{paid:"product/xrd-data-matching-online/",msg:["Plotting XRD data? Get expert phase matching against verified reference databases.","XRD peaks plotted! Need accurate compound identification for your materials?","Beautiful XRD graph! Reviewers often ask for proper phase matching with reference cards.","Need more than a plot? Get professional phase identification and peak assignment.","XRD data ready! Our experts can match your peaks to thousands of known compounds."]},ftir:{paid:"product/ftir-data-matching-online/",msg:["FTIR spectrum looks great! Need automated compound identification?","Plotting FTIR? Get your peaks matched against 10,000+ reference materials.","Beautiful transmittance plot! Want to identify functional groups automatically?","FTIR graph ready! Our experts can match your peaks to known compounds.","Nice FTIR spectrum! Reviewers love seeing compound matches with similarity scores."]},xps:{paid:"product/xps-analysis-online/",msg:["Plotting XPS data? Get professional peak deconvolution and fitting.","XPS spectrum ready! Need atomic percentages and oxidation state analysis?","Great binding energy plot! Our experts can deconvolute overlapping peaks.","XPS graph looks good! Want publication-ready peak assignments?","Need more than a plot? Get full XPS analysis with chemical state identification."]},raman:{paid:"product/raman-crystallite-size-calculator/",msg:["Raman spectrum plotted! Need ID/IG ratio and crystallite size analysis?","Working with carbon materials? Get expert D and G band deconvolution.","Nice Raman plot! Reviewers often ask for proper peak fitting.","Raman data ready! Our experts can calculate defect density and crystallite size.","Beautiful Raman spectrum! Want Tuinstra-Koenig analysis for your publication?"]},uvvis:{paid:"product/band-gap-calculation-from-tauc-plot/",msg:["UV-Vis spectrum ready! Need accurate band gap from Tauc plot?","Plotting absorbance data? Get publication-ready Tauc plot analysis.","Nice UV-Vis spectrum! Reviewers expect proper band gap determination.","UV-Vis data plotted! Our experts can calculate direct/indirect band gaps.","Absorbance graph looks good! Want professional Tauc plot fitting?"]},tauc:{paid:"product/band-gap-calculation-from-tauc-plot/",msg:["Generating Tauc plot? Let our experts ensure accurate band gap values.","Tauc analysis started! Get professionally fitted linear region extraction.","Band gap calculation in progress! Reviewers appreciate expert Tauc analysis.","Need reviewer-ready band gap values? Our experts ensure proper fitting.","Tauc plot ready! Get verified band gap calculation for your publication."]},nmr:{paid:"product/nmr-data-analysis/",msg:["Plotting NMR spectrum? Get full structural elucidation from your data.","NMR data loaded! Need peak assignments and purity assessment?","Nice NMR plot! Our experts can provide complete spectral interpretation.","Chemical shifts visible! Want professional structure confirmation?","NMR spectrum ready! Get publication-quality peak assignments."]},pl:{paid:"product/custom-analysis/",msg:["Plotting PL data? Need quantum yield or peak fitting analysis?","Photoluminescence spectrum ready! Get expert emission peak analysis.","Nice PL plot! Our analysis team can extract valuable optical properties.","PL data loaded! Want professional peak deconvolution?","Beautiful emission spectrum! Get expert analysis for your publication."]},dsc:{paid:"product/dsc-percent-crystallinity-calculation-by-our-expert-team/",msg:["DSC thermogram plotted! Need accurate crystallinity calculation?","Plotting DSC data? Get professional enthalpy of fusion analysis.","DSC curve ready! Our experts can calculate percent crystallinity.","Nice thermal data! Reviewers expect proper baseline integration.","DSC plot looks good! Get publication-ready crystallinity values."]},tga:{paid:"product/custom-analysis/",msg:["Plotting TGA data? Need thermal stability analysis?","TGA curve ready! Our experts can analyze decomposition profiles.","Nice weight loss curve! Get detailed thermal analysis.","TGA data loaded! Want professional derivative thermogravimetric analysis?","Thermal data plotted! Get expert interpretation for your manuscript."]},bet:{paid:"product/bet-analsysis-online/",msg:["Plotting BET isotherm? Get surface area and pore analysis.","BET data loaded! Our experts calculate surface area and pore distribution.","Nice adsorption plot! Want complete BET analysis with pore shape?","BET curve ready! Get publication-ready surface area values.","Isotherm plotted! Need BJH pore size distribution analysis."]},saxs:{paid:"product/custom-analysis/",msg:["Plotting SAXS data? Need particle size distribution analysis?","SAXS pattern ready! Our experts can extract structural parameters.","Nice scattering plot! Want professional data fitting?"]},tensile:{paid:"product/custom-analysis/",msg:["Plotting stress-strain curve? Need mechanical property calculations?","Tensile data ready! Our experts can analyze modulus and yield strength."]},default:{paid:"product/scientific-graph-plotting/",msg:["Great graph! Need publication-quality formatting for journals?","Nice plot! Our experts create journal-ready 2D/3D scientific figures.","Data plotted! Want professionally formatted graphs for your paper?","Graph looks good! We also offer complete data analysis services.","Beautiful visualization! Need more analysis? Check our expert services."]}};function e(){const e=document.querySelector('input[name="axistitles"]:checked'),a=e?e.value:"default",r=t[a]||t.default,s=r.msg[Math.floor(Math.random()*r.msg.length)],i={axis:a,paid:r.paid,message:s,timestamp:Date.now()};sessionStorage.setItem("instanano_graph_upsell",JSON.stringify(i))}document.addEventListener("click",function(t){t.target&&("download"===t.target.id||t.target.closest("#download"))&&e(),t.target&&("save"===t.target.id||t.target.closest("#save"))&&e()})}(window.GraphPlotter),function(t){"use strict";t.parsers.parseText=function(t){return t.trim().split(/\r?\n/).map(t=>t.split(/,|\t/))},t.parsers.parseXLSX=function(t){const e=XLSX.read(new Uint8Array(t),{type:"array"});return XLSX.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{header:1})},t.parsers.parseXRDML=function(t){const e=(new DOMParser).parseFromString(t,"application/xml"),a=e.getElementsByTagName("scan")[0]||e.getElementsByTagNameNS("*","scan")[0];let r=a.getElementsByTagName("positions");if(!r.length){const t=a.getElementsByTagName("dataPoints")[0];r=t?t.getElementsByTagName("positions"):r}const s=Array.from(r).find(t=>(t.getAttribute("axis")||"").toLowerCase().includes("2theta")),i=parseFloat((s.getElementsByTagName("startPosition")[0]||s.getElementsByTagNameNS("*","startPosition")[0]).textContent),n=parseFloat((s.getElementsByTagName("endPosition")[0]||s.getElementsByTagNameNS("*","endPosition")[0]).textContent);let o=a.getElementsByTagName("counts");if(!o.length&&(o=a.getElementsByTagName("intensities"),!o.length)){const t=a.getElementsByTagName("dataPoints")[0];o=t?t.getElementsByTagName("intensities"):o}const l=o[0].textContent.trim().split(/\s+/).map(Number),c=l.length,d=(n-i)/(c-1);return Array.from({length:c},(t,e)=>[i+d*e,l[e]])}}(window.GraphPlotter),function(t){"use strict";t.parsers.parseNMR=async function(e){const a=t=>(t.webkitRelativePath||t.relativePath||t.name).replace(/\\/g,"/");if(!e||!e.length)return!1;const r=new Map(e.map(t=>[a(t),t])),s=e.filter(t=>/\/fid$/i.test(a(t)));if(!s.length)return!1;function i(t){return(t.match(/^\#\#\$(\w+)=([\s\S]*?)(?=\n\#\#|\s*$)/gm)||[]).reduce((t,e)=>{const a=/^\#\#\$(\w+)=([\s\S]*)$/m.exec(e);if(!a)return t;const r=a[2].replace(/[()]/g," ").trim().split(/\s+/)[0];return t[a[1]]=isNaN(+r)?r:+r,t},{})}const n=[];for(const t of s){const e=a(t).replace(/\/fid$/i,""),s=r.get(e+"/acqus")||r.get(e+"/ACQUS");if(!s)continue;const o=i(await s.text()),l=+o.SFO1,c=+o.SW_h;if(!isFinite(l)||!isFinite(c))continue;const d=isFinite(+o.O1P)?+o.O1P:isFinite(+o.O1)?+o.O1/l:0,u=+o.BYTORDA||0,p=+o.DTYPA||0,m=+o.NC||0,h=Math.max(0,Math.round(+o.GRPDLY||0)),f=await t.arrayBuffer(),y=new DataView(f),g=0===u;let v,x=4;2===p?(x=2,v=t=>y.getInt16(2*t,g)):3===p?(x=4,v=t=>y.getFloat32(4*t,g)):5===p?(x=8,v=t=>y.getFloat64(8*t,g)):(x=4,v=t=>y.getInt32(4*t,g));const k=(f.byteLength/x|0)/2|0,w=Math.pow(2,m),b=new Float64Array(k),T=new Float64Array(k);for(let t=0;t<k;t++)b[t]=v(2*t)*w,T[t]=v(2*t+1)*w;const S=Math.min(h,k-1),M=b.subarray(S),C=T.subarray(S);let E=1;for(;E<M.length;)E<<=1;const B=new Float64Array(E),N=new Float64Array(E);B.set(M),N.set(C);for(let t=1,e=0;t<E;t++){let a=E>>1;for(;e&a;a>>=1)e^=a;e^=a,t<e&&([B[t],B[e]]=[B[e],B[t]],[N[t],N[e]]=[N[e],N[t]])}for(let t=2;t<=E;t<<=1){const e=-2*Math.PI/t,a=Math.cos(e),r=Math.sin(e);for(let e=0;e<E;e+=t){let s=1,i=0;for(let n=0;n<t/2;n++){const o=e+n,l=o+t/2,c=s*B[l]-i*N[l],d=s*N[l]+i*B[l];B[l]=B[o]-c,N[l]=N[o]-d,B[o]+=c,N[o]+=d;const u=s;s=u*a-i*r,i=u*r+i*a}}}const L=E>>1,I=new Float64Array(E);for(let t=0;t<E;t++)I[t]=Math.hypot(B[t],N[t]);const A=new Float64Array(E);A.set(I.subarray(L)),A.set(I.subarray(0,L),E-L);const D=c/E,Y=-c/2,F=new Float64Array(E);for(let t=0;t<E;t++)F[t]=d+(Y+t*D)/l;n.push({name:e.split("/").pop(),x:Array.from(F).reverse(),y:Array.from(A).reverse()})}if(!n.length)return!1;const o=2*n.length,l=Array.from({length:o},(t,e)=>e%2?"Y-axis":"X-axis"),c=Array.from({length:o},(e,a)=>t.config.COLORS[a%t.config.COLORS.length]),d=[];n.forEach(t=>{d.push("ppm"),d.push(t.name)});const u=Math.max(...n.map(t=>t.x.length)),p=Array.from({length:u},(t,e)=>n.flatMap(t=>[t.x[e]??"",t.y[e]??""]));return t.state.hot.loadData([l,c,d,...p]),document.getElementById("axis-nmr").checked=!0,t.axis.resetScales(!0),t.renderChart(),!0}}(window.GraphPlotter),function(t){"use strict";const e={},a={ftirmatch:{range:20,single:50},xpsmatch:{range:1,single:.5},ramanmatch:{range:10,single:30},uvvismatch:{range:20,single:40},hnmrmatch:{range:.2,single:.5},cnmrmatch:{range:10,single:20}},r={ftirmatch:["Peak Position","Group","Class","Intensity"],xpsmatch:["Peak Position","Group","Material","Notes"],ramanmatch:["Raman Shift (cm⁻¹)","Material","Mode","Notes"],uvvismatch:["λmax (nm)","Material","Characteristic","Description"],hnmrmatch:["Chemical Shift (ppm)","Type","Assignment","Description"],cnmrmatch:["Chemical Shift (ppm)","Type","Assignment","Description"]};async function s(t){if(e[t])return e[t];try{const a=t.replace("match",""),r=await fetch("https://cdn.jsdelivr.net/gh/instanano/graph@latest/match/"+a+"/match.json");if(!r.ok)throw new Error(r.status);const s=await r.json();return e[t]=s,s}catch(e){return console.error("Load failed:",t,e),[]}}d3.select("#matchedData").html("<p>Please click any peak.</p>"),document.getElementById("icon5").addEventListener("change",function(){this.checked&&s(document.querySelector('input[name="matchinstrument"]:checked').id)}),document.querySelector('label[for="icon5"]').addEventListener("mouseenter",()=>{s(document.querySelector('input[name="matchinstrument"]:checked').id)}),document.querySelectorAll('input[name="matchinstrument"]').forEach(t=>{t.addEventListener("change",async function(){d3.select("#matchedData").html("<p>Loading...</p>"),await s(this.id),d3.select("#matchedData").html("<p>Please click any peak.</p>")})}),d3.select("#chart").on("click.match",async function(e){if(!document.getElementById("icon5").checked)return;const i=d3.select("#chart svg").node(),[n,o]=d3.pointer(e,i);n<t.config.DIM.ML||n>t.config.DIM.W-t.config.DIM.MR||o<t.config.DIM.MT||o>t.config.DIM.H-t.config.DIM.MB||await async function(t){const e=document.querySelector('input[name="matchinstrument"]:checked').id,i=a[e]||{range:0,single:0},n=r[e]||[],o=(await s(e)).filter(e=>{const a=e[0].split("-").map(Number);return a.length>1?t>=a[0]-i.range&&t<=a[1]+i.range:Math.abs(t-a[0])<=i.single});d3.select("#matchedData").html(o.length?function(t,e){return t.map(t=>'<div class="matchedrow">'+t.map((t,a)=>`<div class="matchedrow-h${a+1}"><b>${e[a]}:</b> ${t}</div>`).join("")+"</div>").join("")}(o,n):"<p>No matching peaks found.</p>")}(t.state.lastXScale.invert(n))})}(window.GraphPlotter),function(t){"use strict";async function a(t,e){return new Promise(a=>{$("#html-prompt-message").text(t),$("#html-prompt-input").val(e),$("#popup-prompt-overlay").css("display","flex").fadeIn(150),$("#html-prompt-input").focus().off("keydown").on("keydown",t=>{"Enter"===t.key&&$("#html-prompt-ok").click()}),$("#html-prompt-ok").off("click").on("click",()=>{$("#popup-prompt-overlay").fadeOut(150),a($("#html-prompt-input").val())}),$("#html-prompt-cancel").off("click").on("click",()=>{$("#popup-prompt-overlay").fadeOut(150),a(null)})})}$("#download").click(async function(t){if(t.preventDefault(),!myUserVars.isLoggedIn)return t.stopPropagation(),void $("#ajax-login-modal").show();$("#transparent-option").show();const e=await a("Enter DPI  (e.g. 150, 300, or 600 etc.)","600");if(null===e)return;const r=parseFloat(e);if(isNaN(r)||r<=0)return alert("Invalid DPI");const s=document.getElementById("html-prompt-transparent").checked,i=r/96,n=document.querySelector("#chart svg");if(!n)return;const o=n.cloneNode(!0);o.querySelectorAll("foreignObject div[contenteditable]").forEach(t=>t.style.border="none"),o.querySelectorAll(".outline[visibility='visible']").forEach(t=>t.setAttribute("visibility","hidden")),o.querySelectorAll("text[contenteditable='true']").forEach(t=>{t.removeAttribute("contenteditable"),t.style.outline="none"}),o.setAttribute("style",`background:${s?"transparent":"#fff"};font-family:Arial,sans-serif;`);const l="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(o)),c=new Image;c.onload=()=>{const t=document.createElement("canvas");t.width=c.width*i,t.height=c.height*i;const e=t.getContext("2d");s||(e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height)),e.drawImage(c,0,0,t.width,t.height),t.toBlob(t=>{const e=document.createElement("a");e.href=URL.createObjectURL(t),e.download=`chart@${r}dpi${s?"_transparent":""}.png`,e.click()},"image/png")},c.src=l}),$("#save").click(async function(e){if(e.preventDefault(),!myUserVars.isLoggedIn)return e.stopPropagation(),void $("#ajax-login-modal").show();$("#transparent-option").hide(),t.utils.clearActive();const r=new Date,s=t=>("0"+t).slice(-2),i=[s(r.getDate()),s(r.getMonth()+1),r.getFullYear()].join("-")+"_"+[s(r.getHours()),s(r.getMinutes()),s(r.getSeconds())].join("-"),n={v:"v1.0",ts:i,table:t.state.hot.getData(),settings:t.getSettings(),col:t.state.colEnabled,html:d3.select("#chart").html(),overrideX:t.state.overrideX||null,overrideMultiY:t.state.overrideMultiY||{},overrideXTicks:t.state.overrideXTicks||null,overrideYTicks:t.state.overrideYTicks||{},overrideTernaryTicks:t.state.overrideTernaryTicks||{},overrideScaleformatX:t.state.overrideScaleformatX||null,overrideScaleformatY:t.state.overrideScaleformatY||{},overrideCustomTicksX:t.state.overrideCustomTicksX||null,overrideCustomTicksY:t.state.overrideCustomTicksY||{},overrideCustomTicksTernary:t.state.overrideCustomTicksTernary||{},overrideTernary:t.state.overrideTernary||{},minorTickOn:t.state.minorTickOn||{},useCustomTicksOn:t.state.useCustomTicksOn||{}},o=URL.createObjectURL(new Blob([JSON.stringify(n)])),l=document.createElement("a"),c=await a("Enter file name",`Project_${i}`);c&&(l.href=o,l.download=`${c}.instanano`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o))}),t.importState=function(a){if(t.state.hot.loadData(a.table),t.state.colEnabled=a.col,t.state.overrideX=a.overrideX,t.state.overrideMultiY=a.overrideMultiY,t.state.overrideXTicks=a.overrideXTicks,t.state.overrideYTicks=a.overrideYTicks,t.state.overrideTernaryTicks=a.overrideTernaryTicks,t.state.overrideScaleformatX=a.overrideScaleformatX,t.state.overrideScaleformatY=a.overrideScaleformatY,t.state.overrideCustomTicksX=a.overrideCustomTicksX,t.state.overrideCustomTicksY=a.overrideCustomTicksY,t.state.overrideCustomTicksTernary=a.overrideCustomTicksTernary,t.state.overrideTernary=a.overrideTernary,t.state.minorTickOn=a.minorTickOn||{},t.state.useCustomTicksOn=a.useCustomTicksOn||{},d3.selectAll('input[type="checkbox"][data-col]').each(function(){this.checked=t.state.colEnabled[this.dataset.col]}),document.getElementById(a.settings.type).checked=!0,a.settings.mode){const t=document.querySelector(`input[name="axistitles"][value="${a.settings.mode}"]`);t&&(t.checked=!0)}t.state.hot.render(),t.axis.resetScales(!1),t.renderChart(),document.querySelector(`[name="aspectratio"][value="${a.settings.ratio}"]`).checked=!0,document.querySelector(`[name="axistitles"][value="${a.settings.mode}"]`).checked=!0,Object.entries(a.settings).forEach(([t,a])=>!/^(type|ratio|mode)$/.test(t)&&(e=document.getElementById(t))&&null!=a&&(e.value=a)),d3.select("#chart").html(a.html),t.features.prepareShapeLayer(),d3.selectAll(".shape-group").each(function(){t.features.makeShapeInteractive(d3.select(this))}),d3.selectAll("foreignObject.user-text,g.legend-group,g.axis-title").call(t.utils.applyDrag),t.axis.tickEditing(d3.select("#chart svg"))}}(window.GraphPlotter),function(t){"use strict";function e(){const e=t.getSeries();if(!e||0===e.length)return null;const a=e[0].x.filter(t=>Number.isFinite(t));if(0===a.length)return null;const r=Math.min(...a),s=Math.max(...a);return r>=180&&r<=200&&800===s?"uvvis":r>=398&&r<=400&&4e3===s?"ftir":r>=0&&r<=10&&s>=80&&s<=90?"xrd":null}function a(){t.state.hot.addHook("afterPaste",()=>{setTimeout(()=>{t.state.colEnabled={},t.state.hot.getData()[0].forEach((e,a)=>{t.state.colEnabled[a]=!0}),t.state.hot.render();const a=e();if(a){const t=document.querySelector(`input[name="axistitles"][value="${a}"]`);t&&(t.checked=!0)}t.axis.resetScales(!0);const r=d3.select("#chart svg");r.empty()||(r.selectAll(".shape-group").remove(),r.selectAll("foreignObject.user-text").remove(),t.state.tickLabelStyles={x:{fontSize:null,color:null},y:{fontSize:null,color:null}}),t.renderChart()},0)}),t.state.hot.addHook("afterChange",(e,a)=>{if(!e)return;let r=!1,s=!1;for(const[t,,a,i]of e)0===t&&a!==i&&(r=!0),t>=3&&a!==i&&(s=!0);s?t.axis.resetScales(!0):r&&t.axis.resetScales(!1),"paste"!==a&&t.renderChart()}),t.state.hot.addHook("beforeKeyDown",e=>{const a=t.state.hot.getSelectedLast();a&&0===a[0]&&(e.stopImmediatePropagation(),e.preventDefault())}),document.addEventListener("input",e=>{document.addEventListener("input",e=>{"enableAreaCalc"!==e.target.id&&"sidebar"!==e.target.name&&t.ui.disableAreaCal()});const a=e.target;a.matches(".control input")&&("axistitles"!==a.name&&"aspectratio"!==a.name||t.axis.resetScales(!1),"aspectratio"===a.name&&function(e){const a=t.config.ratioPresets[e]||t.config.ratioPresets["4:2.85"],[r,s]=e.split(":").map(Number),i=t.state.multiYScales?.length>1?(t.state.multiYScales.length-2)*a.multiygap:0;t.config.DIM.H=Math.round(t.config.DIM.W*s/r),t.config.DIM.MR=80+i,d3.selectAll("#chart svg g.axis-title foreignObject div").style("font-size",a.axisTitleFs+"px").each(function(){let t=this.scrollWidth+5;d3.select(this.parentNode).attr("width",t).attr("x",-t/2)}),d3.selectAll("#chart svg g.legend-group foreignObject div").style("font-size",a.legendFs+"px").each(function(){d3.select(this.parentNode).attr("width",this.scrollWidth+5)})}(a.value),t.renderChart())})}const r={instanano:null,csv:t.parsers.parseText,txt:t.parsers.parseText,xls:t.parsers.parseXLSX,xlsx:t.parsers.parseXLSX,xrdml:t.parsers.parseXRDML},s={xrdml:"xrd",raw:"xrd",spc:"uvvis"},i=document.getElementById("fileinput");i.accept=Object.keys(r).map(t=>"."+t).join(",");const n=document.getElementById("dropzone");async function o(a){const i=a&&a.items,n=i&&i.length?await(async()=>{const t=[],e=async(a,r="")=>{return a.isFile?await new Promise(e=>a.file(a=>{a.relativePath=r+a.name,t.push(a),e()})):await Promise.all((await(s=a.createReader(),new Promise(t=>{const e=[];!function a(){s.readEntries(r=>{r.length?(e.push(...r),a()):t(e)})}()}))).map(t=>e(t,r+a.name+"/")));var s};for(const t of i){const a=t.webkitGetAsEntry&&t.webkitGetAsEntry();a&&await e(a)}return t})():[...a?.files||a||[]];if(!n.length)return;if(await t.parsers.parseNMR(n))return;const o=n[0],l=o.name.split(".").pop().toLowerCase();if("instanano"===l){const e=await o.text();return void t.importState(JSON.parse(e))}const c=r[l];if(!c)return alert("Unsupported file type: ."+l);if(s[l]){const t=document.querySelector(`input[name="axistitles"][value="${s[l]}"]`);t&&(t.checked=!0)}let d;if("xls"===l||"xlsx"===l){d=c(await o.arrayBuffer())}else{d=c(await o.text())}const u=Math.max(...d.map(t=>t.length)),p=Array(u).fill().map((t,e)=>0===e?"X-axis":"Y-axis"),m=Array(u).fill().map((e,a)=>t.config.COLORS[a%t.config.COLORS.length]),h=Array(u).fill("Sample");t.state.hot.loadData([p,m,h,...d]),t.state.colEnabled={},t.state.hot.getData()[0].forEach((e,a)=>{t.state.colEnabled[a]=!0}),t.state.hot.render();const f=e();if(f){const t=document.querySelector(`input[name="axistitles"][value="${f}"]`);t&&(t.checked=!0)}d3.select("#chart").selectAll("g.axis-title, g.legend-group, g.shape-group, defs, foreignObject.user-text").remove(),t.ui.disableAreaCal(),t.state.tickLabelStyles={x:{fontSize:null,color:null},y:{fontSize:null,color:null}},t.axis.resetScales(!0),t.renderChart()}["dragenter","dragover"].forEach(t=>n.addEventListener(t,t=>{t.preventDefault(),n.classList.add("hover")})),["dragleave","drop"].forEach(t=>n.addEventListener(t,t=>{t.preventDefault(),n.classList.remove("hover")})),n.addEventListener("drop",async t=>{t.preventDefault(),n.classList.remove("hover"),await o(t.dataTransfer)}),i.addEventListener("change",async()=>{await o(i.files)}),n.addEventListener("click",()=>i.click());const l=document.querySelectorAll("input[id]"),c=document.querySelectorAll("[data-show]");document.querySelectorAll('input[name="charttype"]').forEach(e=>e.addEventListener("change",()=>{l.forEach(t=>{t.value=e.dataset[t.id]??t.dataset.defaultValue??t.defaultValue,t.dispatchEvent(new Event("input"))}),c.forEach(t=>{t.style.display=t.dataset.show.split(/\s+/).includes(e.id)?"":"none"});const a=e.dataset.axis?.split(/\s*,\s*/).map(t=>t.trim());if(a){const e=t.state.hot.getData();for(;e[0].length<a.length;)e.forEach((e,r)=>e.push(0===r?a[e.length].replace("*",""):1===r?t.config.COLORS[e.length%t.config.COLORS.length]:2===r?"Sample":""));t.state.hot.loadData(e)}if(a){let e=a.findIndex(t=>t.endsWith("*"));e<0&&(e=a.length);const r=a.map(t=>t.replace(/\*$/,"")),s=r.slice(e);t.state.hot.getData()[0].forEach((a,i)=>{const n=i<e?r[i]:s.length?s[(i-e)%s.length]:a;t.state.hot.setDataAtCell(0,i,n),t.state.colEnabled[i]=t.state.colEnabled[i]&&r.includes(n)}),t.state.hot.render()}t.axis.resetScales(!1),t.renderChart()})),document.querySelector('input[name="charttype"]:checked').dispatchEvent(new Event("change")),["smoothingslider","baselineslider","multiyaxis"].forEach(t=>{const e=document.getElementById(t);function a(){e.classList.toggle("zero","0"===e.value)}e.addEventListener("input",a),a()}),document.querySelectorAll("span[data-current-value]").forEach(t=>{const e=document.getElementById(t.dataset.currentValue);e&&"range"===e.type&&(t.textContent=e.value,e.oninput=()=>{t.textContent=e.value})});const d=document.getElementById("help-icon"),u=document.getElementById("help-prompt-overlay"),p=document.getElementById("help-close");d.addEventListener("click",()=>{u.style.display="flex"}),p.addEventListener("click",()=>{u.style.display="none"});const m=/Mac|iPod|iPhone|iPad/.test(navigator.platform),h=m?"meta":"ctrl",f=(()=>{const t=new Map;return addEventListener("keydown",e=>{const a=[];(m?e.metaKey:e.ctrlKey)&&a.push(h),a.push(e.key.toLowerCase());const r=a.sort().join("+");t.has(r)&&(e.preventDefault(),t.get(r)(e))}),(e,a)=>t.set((t=>t.toLowerCase().split("+").map(t=>t.trim()).sort().join("+"))(e),a)})();f(`${h}+s`,()=>document.getElementById("save").click()),f(`${h}+d`,()=>document.getElementById("download").click()),f(`${h}+z`,()=>document.getElementById("zoomBtn").click()),f(`${h}+backspace`,()=>document.getElementById("removebtn").click()),f("delete",()=>document.getElementById("removebtn").click()),f("escape",()=>{t.utils.clearActive(),document.getElementById("popup-prompt-overlay").style.display="none",document.getElementById("help-prompt-overlay").style.display="none",t.ui.disableAreaCal()}),f(`${h}+f`,()=>{const t=document.querySelector(".container");document.fullscreenElement?document.exitFullscreen().then(()=>t.style.background=""):t.requestFullscreen().then(()=>t.style.background="#f4eee2")}),f(`${h}+i`,()=>document.getElementById("enableAreaCalc").click()),f(`${h}+.`,()=>t.ui.applySupSub("sup")),f(`${h}+,`,()=>t.ui.applySupSub("sub"));const y="https://instanano.com/online-graph-plotter/",g=document.getElementById("mWP"),v=document.getElementById("mEM"),x=document.getElementById("mCP");g.href="https://wa.me/919467826266?text="+encodeURIComponent("Link to open InstaNANO Graph Plotter on your laptop:\n"+y),v.href="mailto:?subject="+encodeURIComponent("InstaNANO Graph Plotter Link")+"&body="+encodeURIComponent("Link to open InstaNANO Graph Plotter on your laptop:\n\n"+y),x.onclick=t=>(t.preventDefault(),navigator.clipboard.writeText(y).then(()=>x.textContent="Copied")),matchMedia("(max-width:600px)").matches&&(document.querySelectorAll("input[name=sidebar]").forEach(t=>t.checked=!1),document.querySelector(".icon-strip").addEventListener("click",t=>{let e=document.getElementById(t.target.closest("label")?.htmlFor);e?.checked&&(t.preventDefault(),e.checked=!1)}));const k={xrd:{paid:"product/xrd-data-matching-online/",msg:["Plotting XRD data? Get expert phase matching against verified reference databases.","XRD peaks plotted! Need accurate compound identification for your materials?","Beautiful XRD graph! Reviewers often ask for proper phase matching with reference cards.","Need more than a plot? Get professional phase identification and peak assignment.","XRD data ready! Our experts can match your peaks to thousands of known compounds."]},ftir:{paid:"product/ftir-data-matching-online/",msg:["FTIR spectrum looks great! Need automated compound identification?","Plotting FTIR? Get your peaks matched against 10,000+ reference materials.","Beautiful transmittance plot! Want to identify functional groups automatically?","FTIR graph ready! Our experts can match your peaks to known compounds.","Nice FTIR spectrum! Reviewers love seeing compound matches with similarity scores."]},xps:{paid:"product/xps-analysis-online/",msg:["Plotting XPS data? Get professional peak deconvolution and fitting.","XPS spectrum ready! Need atomic percentages and oxidation state analysis?","Great binding energy plot! Our experts can deconvolute overlapping peaks.","XPS graph looks good! Want publication-ready peak assignments?","Need more than a plot? Get full XPS analysis with chemical state identification."]},raman:{paid:"product/raman-crystallite-size-calculator/",msg:["Raman spectrum plotted! Need ID/IG ratio and crystallite size analysis?","Working with carbon materials? Get expert D and G band deconvolution.","Nice Raman plot! Reviewers often ask for proper peak fitting.","Raman data ready! Our experts can calculate defect density and crystallite size.","Beautiful Raman spectrum! Want Tuinstra-Koenig analysis for your publication?"]},uvvis:{paid:"product/band-gap-calculation-from-tauc-plot/",msg:["UV-Vis spectrum ready! Need accurate band gap from Tauc plot?","Plotting absorbance data? Get publication-ready Tauc plot analysis.","Nice UV-Vis spectrum! Reviewers expect proper band gap determination.","UV-Vis data plotted! Our experts can calculate direct/indirect band gaps.","Absorbance graph looks good! Want professional Tauc plot fitting?"]},tauc:{paid:"product/band-gap-calculation-from-tauc-plot/",msg:["Generating Tauc plot? Let our experts ensure accurate band gap values.","Tauc analysis started! Get professionally fitted linear region extraction.","Band gap calculation in progress! Reviewers appreciate expert Tauc analysis.","Need reviewer-ready band gap values? Our experts ensure proper fitting.","Tauc plot ready! Get verified band gap calculation for your publication."]},nmr:{paid:"product/nmr-data-analysis/",msg:["Plotting NMR spectrum? Get full structural elucidation from your data.","NMR data loaded! Need peak assignments and purity assessment?","Nice NMR plot! Our experts can provide complete spectral interpretation.","Chemical shifts visible! Want professional structure confirmation?","NMR spectrum ready! Get publication-quality peak assignments."]},pl:{paid:"product/custom-analysis/",msg:["Plotting PL data? Need quantum yield or peak fitting analysis?","Photoluminescence spectrum ready! Get expert emission peak analysis.","Nice PL plot! Our analysis team can extract valuable optical properties.","PL data loaded! Want professional peak deconvolution?","Beautiful emission spectrum! Get expert analysis for your publication."]},dsc:{paid:"product/dsc-percent-crystallinity-calculation-by-our-expert-team/",msg:["DSC thermogram plotted! Need accurate crystallinity calculation?","Plotting DSC data? Get professional enthalpy of fusion analysis.","DSC curve ready! Our experts can calculate percent crystallinity.","Nice thermal data! Reviewers expect proper baseline integration.","DSC plot looks good! Get publication-ready crystallinity values."]},tga:{paid:"product/custom-analysis/",msg:["Plotting TGA data? Need thermal stability analysis?","TGA curve ready! Our experts can analyze decomposition profiles.","Nice weight loss curve! Get detailed thermal analysis.","TGA data loaded! Want professional derivative thermogravimetric analysis?","Thermal data plotted! Get expert interpretation for your manuscript."]},bet:{paid:"product/bet-analsysis-online/",msg:["Plotting BET isotherm? Get surface area and pore analysis.","BET data loaded! Our experts calculate surface area and pore distribution.","Nice adsorption plot! Want complete BET analysis with pore shape?","BET curve ready! Get publication-ready surface area values.","Isotherm plotted! Need BJH pore size distribution analysis."]},saxs:{paid:"product/custom-analysis/",msg:["Plotting SAXS data? Need particle size distribution analysis?","SAXS pattern ready! Our experts can extract structural parameters.","Nice scattering plot! Want professional data fitting?"]},tensile:{paid:"product/custom-analysis/",msg:["Plotting stress-strain curve? Need mechanical property calculations?","Tensile data ready! Our experts can analyze modulus and yield strength."]},default:{paid:"product/scientific-graph-plotting/",msg:["Great graph! Need publication-quality formatting for journals?","Nice plot! Our experts create journal-ready 2D/3D scientific figures.","Data plotted! Want professionally formatted graphs for your paper?","Graph looks good! We also offer complete data analysis services.","Beautiful visualization! Need more analysis? Check our expert services."]}},w="instanano_graph_upsell";function b(){if(sessionStorage.getItem(w))return;const t=document.querySelector('input[name="axistitles"]:checked'),e=t?t.value:"default",a=k[e]||k.default,r=a.msg[Math.floor(Math.random()*a.msg.length)],s={axis:e,paid:a.paid,message:r,timestamp:Date.now()};sessionStorage.setItem(w,JSON.stringify(s))}$("#download").click(b),$("#save").click(b),t.getSeries=function(){const e=t.getSettings(),a=t.state.hot.getData(),r=a[0],s=a.slice(3),i=t.state.colEnabled,n=[];if("ternary"===e.type||"ternaryline"===e.type||"ternaryarea"===e.type){const e=t.state.hot.getData()[0],a=t.state.hot.getData().slice(3),r=e.indexOf("X-axis"),s=e.indexOf("Y-axis"),i=e.indexOf("Z-axis");return[{rawX:a.map(t=>+t[r]),y:a.map(t=>+t[s]),z:a.map(t=>+t[i]),color:t.state.hot.getData()[1][s]}]}if("histogram"===e.type)return r.forEach((t,e)=>{if("Y-axis"===t&&i[e]){const t=s.map(t=>parseFloat(t[e])).filter(t=>Number.isFinite(t));n.push({y:t,color:a[1][e],label:a[2][e]})}}),n;const o=r.map((t,e)=>"X-axis"===t&&i[e]?e:-1).filter(t=>t>=0);return o.forEach((t,l)=>{const c=null!=o[l+1]?o[l+1]:r.length;for(let o=t+1;o<c;o++)if("Y-axis"===r[o]&&i[o]){const l=s.map(a=>"bar"===e.type?a[t]:parseFloat(a[t])),c=s.map(t=>parseFloat(t[o])),d="Y-error"===r[o+1]&&i[o+1]?o+1:-1,u=d>=0?s.map(t=>parseFloat(t[d])||NaN):null,p=d>=0?a[1][d]:null;n.push({rawX:l,x:l,y:c,color:a[1][o],label:a[2][o],error:u,errorColor:p})}}),n},t.getSettings=function(){const e=document.querySelector('input[name="aspectratio"]:checked').value,a=t.config.ratioPresets[e],r={type:document.querySelector('input[name="charttype"]:checked').id,symbolsize:+document.getElementById("symbolsize").value,xticks:a.xticks,yticks:a.yticks,scaleformat:+document.getElementById("scaleformat").value,bins:+document.getElementById("bins").value,multiygap:+document.getElementById("multiygap").value,scalewidth:+document.getElementById("scalewidth").value,linewidth:+document.getElementById("linewidth").value,multiyaxis:+document.getElementById("multiyaxis").value,opacity:+document.getElementById("opacity").value,mode:document.querySelector('input[name="axistitles"]:checked').value,scaleFs:a.scaleFs,axisTitleFs:a.axisTitleFs,legendFs:a.legendFs,ratio:document.querySelector('input[name="aspectratio"]:checked').value},s=document.querySelector('input[name="charttype"]:checked').dataset;return Object.entries(s).forEach(([t,e])=>{/^-?\d+(\.\d+)?$/.test(e)?r[t]=+e:e.includes(",")?r[t]=e.split(",").map(t=>t.trim()):r[t]=e}),r},t.renderChart=function(){const e=d3.select("#chart"),a=e.select("svg").selectAll("g.axis-title, g.legend-group, g.shape-group, foreignObject.user-text").remove();e.html("");const{s:r,series:s,xScale:i,yScale:n,W:o,H:l,MT:c,MB:d,ML:u,MR:p,titles:m}=t.axis.prepareChartContext(),h=function(e,{W:a,H:r,ML:s,MR:i,MT:n,MB:o},l="clip",c={}){const d=e.append("svg").attr("viewBox",`0 0 ${a} ${r}`).on("click",e=>{e.defaultPrevented||e.target!==d.node()||t.utils.clearActive()}),u=d.append("defs").append("clipPath").attr("id",l);if("ternary"===c.type||"ternaryline"===c.type||"ternaryarea"===c.type){const t=a-s-i,e=r-n-o,l=Math.min(t,2*e/Math.sqrt(3)),c=l*Math.sqrt(3)/2,d=s+(t-l)/2,p=n+(e-c)/2+c,m=d+l,h=d+l/2,f=p-c;u.append("polygon").attr("points",`${d},${p} ${m},${p} ${h},${f}`)}else u.append("rect").attr("x",s).attr("y",n).attr("width",a-s-i).attr("height",r-n-o);return d}(e,{W:o,H:l,ML:u,MR:p,MT:c,MB:d},"clip",r);t.ui.areacalculation(),a.each(function(){h.node().appendChild(this)});const f={x:i,y:n};!function(e,a,r){if(1!==a.multiyaxis||r.length<2)return;const s=r.map((e,a)=>{const[r,s]=d3.extent(e.y),i=.06*(s-r),n=t.state.overrideMultiY?.[a]?t.state.overrideMultiY[a]:[r-i,s+i];return d3.scaleLinear().domain(n).range([t.config.DIM.H-t.config.DIM.MB,t.config.DIM.MT])});e.y2=s,e.y=s[0],t.state.multiYScales=s}(f,r,s);const y=h.append("g").attr("clip-path","url(#clip)");t.ChartRegistry.get(r.type).draw(y,s,f,r),t.axis.drawAxis(h,f,m,r,s),t.ui.drawLegend(),t.ui.toolTip(h,{xScale:i,yScale:n}),t.features.prepareShapeLayer(),t.axis.tickEditing(d3.select("#chart svg"))},t.init=function(){t.initTable(),a(),t.axis.resetScales(!0),t.renderChart()},document.addEventListener("DOMContentLoaded",()=>{window.GraphPlotter.init()})}(window.GraphPlotter);