window.GraphPlotter=window.GraphPlotter||{state:{hot:null,colEnabled:{},activeGroup:null,activeText:null,activeDiv:null,activeFo:null,activeTicks:null,tickLabelStyles:{x:{},y:{},a:{},b:{},c:{}},lastXScale:null,lastYScale:null,multiYScales:null,axisScales:null,overrideX:null,overrideMultiY:{},overrideXTicks:null,overrideYTicks:{},overrideTernary:{},overrideTernaryTicks:{},overrideScaleformatX:null,overrideScaleformatY:{},overrideCustomTicksX:null,overrideCustomTicksY:{},overrideCustomTicksTernary:{},minorTickOn:{},useCustomTicksOn:{},shapeMode:"none",drawing:!1,drawStart:null,tempShape:null,arrowCount:0},config:{},utils:{},ChartRegistry:null,parsers:{},ui:{refs:{}},axis:{},features:{},init:null,renderChart:null,getSeries:null,getSettings:null},function(t){"use strict";t.config.COLORS=["#FFFF00","#000000","#0000FF","#FF0000","#008000","#00FFFF","#FF00FF","#FFA500","#800080","#A52A2A"],t.config.DIM={W:600,H:300,MT:30,MB:60,ML:70,MR:80},t.config.SYMBOL_TYPES=[d3.symbolCircle,d3.symbolTriangle,d3.symbolSquare,d3.symbolDiamond,d3.symbolStar,d3.symbolCross],t.config.ratioPresets={"4:2.85":{linewidth:1.4,scalewidth:1.4,axisTitleFs:13,legendFs:13,scaleFs:12,xticks:6,yticks:5,multiygap:35},"16:9.15":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:11,xticks:6,yticks:5,multiygap:35},"2:1.05":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:11,xticks:6,yticks:5,multiygap:35},"3:1.2":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:10,xticks:7,yticks:3,multiygap:35},"4:1.35":{linewidth:1.2,scalewidth:1.2,axisTitleFs:11,legendFs:11,scaleFs:10,xticks:7,yticks:2,multiygap:35}}}(window.GraphPlotter),function(t){"use strict";t.utils.escapeHTML=function(t){return String(null==t?"":t).replace(/[&<>"']/g,(t=>"&"===t?"&amp;":"<"===t?"&lt;":">"===t?"&gt;":'"'===t?"&quot;":"&#39;"))},t.utils.clearActive=function(){const e=t.state;e.activeGroup&&(e.activeGroup.select(".outline").attr("visibility","hidden"),e.activeGroup=null),e.activeText&&(e.activeText.attr("contenteditable",!1).style("border",null),e.activeText=null),e.activeDiv&&(e.activeDiv.attr("contenteditable",!1).style("border",null).style("cursor","move"),e.activeDiv=null),e.activeTicks&&(e.activeTicks.attr("contenteditable",!1).style("outline",null).style("cursor","pointer"),e.activeTicks=null,document.getElementById("axis-label").textContent="Axis Settings: Select Axis",document.getElementById("scalemin").value="",document.getElementById("scalemax").value="",document.getElementById("customticks").value=""),e.activeFo=null,t.ui.refs.boldBtn&&t.ui.refs.boldBtn.classed("active",!1),t.ui.refs.italicBtn&&t.ui.refs.italicBtn.classed("active",!1),t.ui.refs.rmBtn&&t.ui.refs.rmBtn.classed("disabled",!0),window.getSelection().removeAllRanges(),["scalemin","scalemax","tickcount","scaleformat","customticks","useCustomTicks","showMinorTicks"].forEach((t=>{document.getElementById(t).disabled=!0}))},t.utils.rgbToHex=function(t){return"#"+t.match(/\d+/g).map((t=>(+t).toString(16).padStart(2,"0"))).join("")},t.utils.applyDrag=d3.drag().on("start",(function(e){t.state.hot.deselectCell(),e.sourceEvent.preventDefault(),t.utils.clearActive();const a=d3.select(this).raise();if(a.classed("shape-group"))t.features.activateShape(a);else{const e="foreignObject"===a.node().tagName?a:a.select("foreignObject"),r=e.select("div");t.features.activateText(r,e),setTimeout((()=>{window.getSelection().selectAllChildren(r.node())}),0)}})).on("drag",(function(t){const e=d3.select(this),a=e.attr("transform")||"",r=a.match(/translate\(([^,]+),([^)]+)\)/)||[],n=+r[1]||0,s=+r[2]||0,i=(/rotate\(([^)]+)\)/.exec(a)||[])[0]||"";e.attr("transform",`translate(${n+t.dx},${s+t.dy})${i}`)})).on("end",(function(){const t=d3.select(this);if(t.classed("user-text")||t.classed("axis-title")||t.classed("legend-group")){const e=t.select("foreignObject div");t.classed("legend-group")&&(this.dataset.savedTransform=t.attr("transform")),e.on("blur",(()=>{e.attr("contenteditable",!1).style("cursor","move")}))}})),t.utils.updateInspector=function(e){const a=e.node(),r=window.getComputedStyle(a),n=parseFloat(e.attr("stroke-width"))||parseInt(r.fontSize,10),s="DIV"===a.tagName?r.color:"none"!==r.stroke?r.stroke:r.fill;t.ui.refs.sizeCtrl.property("value",n),t.ui.refs.colorCtrl.property("value",t.utils.rgbToHex(s));const i=r.fontFamily.split(",")[0].replace(/['"]/g,"");t.ui.refs.fontCtrl.property("value",i);const o="700"===r.fontWeight||"bold"===r.fontWeight;t.ui.refs.boldBtn.classed("active",o);const c="italic"===r.fontStyle;t.ui.refs.italicBtn.classed("active",c),t.ui.refs.rmBtn.classed("disabled",!1)},t.utils.editableText=function(t,{x:e,y:a,text:r,rotation:n}){const s=t.append("foreignObject").attr("x",e).attr("y",a).attr("transform",n?`rotate(${n},${e},${a})`:null).attr("overflow","visible"),i=s.append("xhtml:div").attr("contenteditable",!1).style("display","inline-block").style("white-space","nowrap").style("padding","2px").style("cursor","move").style("font-size","12px").text(String(null==r?"":r)),o=i.node().scrollWidth,c=i.node().scrollHeight;return s.attr("width",o+2).attr("height",c+2),i.on("input",(()=>{const t=i.node().scrollWidth,e=i.node().scrollHeight;s.attr("width",t+2).attr("height",e+2)})).on("paste",(function(t){t.preventDefault();const e=(t.clipboardData||window.clipboardData).getData("text/plain");if("function"==typeof document.execCommand&&document.execCommand("insertText",!1,e))return;const a=window.getSelection();if(!a||!a.rangeCount)return void(this.textContent+=e);a.deleteFromDocument();const r=document.createTextNode(e),n=a.getRangeAt(0);n.insertNode(r),n.setStartAfter(r),n.collapse(!0),a.removeAllRanges(),a.addRange(n)})).on("keydown",(function(t){"Enter"===t.key&&(t.preventDefault(),this.blur())})).on("blur",(()=>{d3.select(i.node()).style("cursor","move")})),{fo:s,div:i,pad:2}}}(window.GraphPlotter),function(t){"use strict";const e=new Map;t.ChartRegistry={register(t){if(!t.id||"function"!=typeof t.draw)throw new Error("Invalid chart registration");e.set(t.id,t)},get(t){const a=e.get(t);if(!a)throw new Error(`Unknown chart type: ${t}`);return a}}}(window.GraphPlotter),function(t){"use strict";function e(){const e=t.state.hot.getData(),a=document.querySelector('label[for="icon1"]');if(!a)return;const r=e[0].some(((a,r)=>t.state.colEnabled[r]&&e.slice(3).every((t=>null==t[r]||""===t[r]||isNaN(+t[r]))))),n=a.querySelector(".warning-badge");if(r){if(!n){const t=document.createElement("span");t.className="warning-badge",t.textContent="!",a.appendChild(t)}}else n&&n.remove()}t.initTable=function(){const a=document.getElementById("table");t.state.hot=new myTable(a,{data:[["X-axis","Y-axis"],["#FFFF00","#000000"],["Sample","Sample"],[10,223],[20,132],[30,532],[40,242],[50,300],[70,100],[100,250]],colHeaders:e=>(t.state.colEnabled[e]=!1!==t.state.colEnabled[e],`<input type="checkbox" data-col="${e}" ${t.state.colEnabled[e]?"checked":""}>`),rowHeaders:t=>["Axis","Color","Name"][t]||t-2,rowHeaderWidth:60,colWidths:70,contextMenu:!0,afterRemoveRow:()=>{t.matchXRD?.invalidateLock?.(),t.axis.resetScales(!0),t.renderChart()},afterRemoveCol:()=>{t.matchXRD?.invalidateLock?.(),t.axis.resetScales(!0),t.renderChart()},afterChange:(e,a)=>{if(!e)return;if("loadData"===a)return;e.some((([t])=>0===Number(t)||Number(t)>=3))&&t.matchXRD?.invalidateLock?.()},afterCreateCol:(e,a)=>{t.matchXRD?.invalidateLock?.();for(let r=e;r<e+a;r++)t.state.hot.setDataAtCell(0,r,"Y-axis"),t.state.hot.setDataAtCell(1,r,t.config.COLORS[r%t.config.COLORS.length]),t.state.hot.setDataAtCell(2,r,"Sample")},cells:(e,a)=>{const r={};0===e&&(r.type="dropdown",r.source=["X-axis","Y-axis","Z-axis","Y-error"],r.className="tabledropdown"),1===e&&(r.renderer=(e,a,r,n,s,i)=>{if(a.innerHTML="",!["X-axis","Z-axis"].includes(e.getDataAtCell(0,n))){const s=document.createElement("input");s.type="color",s.value=i||t.config.COLORS[n%t.config.COLORS.length],s.oninput=t=>e.setDataAtCell(r,n,t.target.value),a.appendChild(s)}}),2===e&&(r.renderer=(t,e,a,r,n,s)=>{e.textContent=["X-axis","Z-axis"].includes(t.getDataAtCell(0,r))?"":s||"Sample"});const n=r.renderer||myTable.renderers.TextRenderer;return r.renderer=function(e,a,r,s,i,o){n.apply(this,arguments),a.style.background=t.state.colEnabled[s]?"":"lightcoral"},r}}),t.state.hot.addHook("afterCreateCol",e),a.addEventListener("change",(a=>{if(a.target.matches('input[type="checkbox"][data-col]')){const r=+a.target.dataset.col;t.state.colEnabled[r]=a.target.checked,t.matchXRD?.invalidateLock?.(),t.state.hot.render(),t.axis.resetScales(!1),t.renderChart(),e()}}))}}(window.GraphPlotter),function(t){"use strict";t.ChartRegistry.register({id:"line",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(t,e,a,r)=>{e.forEach(((e,n)=>{const s=a.y2?a.y2[n]:a.y,i=d3.line().defined(((t,a)=>Number.isFinite(e.x[a])&&Number.isFinite(e.y[a]))).x(((t,r)=>a.x(e.x[r]))).y(((t,a)=>s(e.y[a])));t.append("path").datum(e.y).attr("fill","none").attr("stroke",e.color).attr("stroke-width",r.linewidth).attr("d",i)}))}}),t.ChartRegistry.register({id:"stacked",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(e,a,r,n)=>{const{H:s,MT:i,MB:o}=t.config.DIM,c=s-i-o,l=a.length+1,d=.1*c/l,u=(c-d*l)/a.length;a.forEach(((t,a)=>{const s=d3.min(t.y),o=d3.max(t.y),c=i+d*(a+1)+u*a,l=c+u,m=d3.scaleLinear().domain([s,o]).range([l,c]),p=d3.line().defined(((e,a)=>Number.isFinite(t.x[a])&&Number.isFinite(t.y[a]))).x(((e,a)=>r.x(t.x[a]))).y(((e,a)=>m(t.y[a])));e.append("path").datum(t.y).attr("fill","none").attr("stroke",t.color).attr("stroke-width",n.linewidth).attr("d",p)}))}})}(window.GraphPlotter),function(t){"use strict";t.ChartRegistry.register({id:"scatter",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(e,a,r,n)=>{t.ui.drawErrorBars(e,a,r,n),a.forEach(((a,s)=>{const i=r.y2?r.y2[s]:r.y,o=d3.symbol().type(t.config.SYMBOL_TYPES[s%t.config.SYMBOL_TYPES.length]).size(Math.PI*Math.pow(n.symbolsize,2));e.selectAll().data(a.x).enter().append("path").attr("d",o).attr("transform",((t,e)=>`translate(${r.x(t)},${i(a.y[e])})`)).attr("fill",a.color)}))}}),t.ChartRegistry.register({id:"scatterline",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(e,a,r,n)=>{t.ChartRegistry.get("line").draw(e,a,r,n),t.ChartRegistry.get("scatter").draw(e,a,r,n)}})}(window.GraphPlotter),function(t){"use strict";t.ChartRegistry.register({id:"bar",dimensions:["x","y"],scaleBuilders:{x:d3.scaleBand,y:d3.scaleLinear},bandPadding:.1,draw:(e,a,r,n)=>{const s=r.x.bandwidth()/a.length;a.forEach(((t,a)=>{e.selectAll().data(t.y).enter().append("rect").attr("x",((e,n)=>r.x(t.rawX[n])+a*s)).attr("y",(t=>r.y(t))).attr("width",s).attr("height",(t=>r.y.range()[0]-r.y(t))).attr("fill",t.color)})),t.ui.drawErrorBars(e,a,r,n)}}),t.ChartRegistry.register({id:"histogram",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},bandPadding:.1,draw:(e,a,r,n)=>{const s=r.x.domain(),[i,o]=s,c=(o-i)/n.bins,l=d3.range(i,o,c);let d=0;const u=a.map((t=>{const e=t.y.filter((t=>Number.isFinite(t)&&t>=i&&t<=o)),a=d3.histogram().domain([i,o]).thresholds(l)(e);return d=Math.max(d,d3.max(a,(t=>t.length))),a}));a.forEach(((s,i)=>{const o=u[i],c=d3.scaleBand().domain(o.map((t=>t.x0))).range([t.config.DIM.ML,t.config.DIM.W-t.config.DIM.MR]).padding(t.ChartRegistry.get(n.type).bandPadding),l=c.bandwidth();e.selectAll("rect.hist-bin-"+i).data(o).enter().append("rect").attr("class","hist-bin-"+i).attr("x",(t=>c(t.x0))).attr("width",l).attr("y",(t=>r.y(t.length))).attr("height",(e=>t.config.DIM.H-t.config.DIM.MB-r.y(e.length))).attr("fill",s.color).attr("fill-opacity",.5+.5/a.length)}))}})}(window.GraphPlotter),function(){"use strict";window.GraphPlotter.ChartRegistry.register({id:"area",dimensions:["x","y"],scaleBuilders:{x:d3.scaleLinear,y:d3.scaleLinear},draw:(t,e,a,r)=>{e.forEach(((e,n)=>{const s=a.y2?a.y2[n]:a.y,i=d3.area().defined(((t,a)=>Number.isFinite(e.x[a])&&Number.isFinite(e.y[a]))).x(((t,r)=>a.x(e.x[r]))).y0((()=>s.range()[0])).y1(((t,a)=>s(e.y[a])));t.append("path").datum(e.y).attr("fill",e.color).attr("fill-opacity",r.opacity).attr("stroke",e.color).attr("stroke-width",0).attr("d",i)}))}})}(),function(t){"use strict";function e(e,a,r,n={}){t.axis.drawTernaryAxis(e,r);const s=t.config.DIM,i=s.W-s.ML-s.MR,o=s.H-s.MT-s.MB,c=Math.min(i,2*o/Math.sqrt(3)),l=c*Math.sqrt(3)/2,d=s.ML+(i-c)/2,u=s.MT+(o-l)/2+l,m=d+c,p=u,h=d+c/2,f=u-l,g=t.state.overrideTernary?.a||[0,100],y=t.state.overrideTernary?.b||[0,100],v=t.state.overrideTernary?.c||[0,100],x=(t,e)=>(t-e[0])/(e[1]-e[0]);a.forEach(((a,s)=>{const i=a.rawX.map(((t,e)=>{const r=x(t,g),n=x(a.y[e],y),s=x(a.z[e],v),i=r+n+s;if(!i)return null;return{x:(r*m+n*h+s*d)/i,y:(r*p+n*f+s*u)/i,i:e}})).filter(Boolean);if(n.area&&e.append("polygon").attr("points",i.map((t=>`${t.x},${t.y}`)).join(" ")).attr("fill",a.color).attr("fill-opacity",r.opacity||1),n.line){const t=d3.line().x((t=>t.x)).y((t=>t.y));e.append("path").datum(i).attr("fill","none").attr("stroke",a.color).attr("stroke-width",r.linewidth).attr("d",t)}if(n.symbol){const n=d3.symbol().type(t.config.SYMBOL_TYPES[s%t.config.SYMBOL_TYPES.length]).size(Math.PI*r.symbolsize**2);i.forEach((t=>e.append("path").attr("d",n).attr("transform",`translate(${t.x},${t.y})`).attr("fill",a.color)))}}))}t.ChartRegistry.register({id:"ternary",dimensions:["x","y","z"],draw:(a,r,n,s)=>{t.axis.drawTernaryGridLines(a,s),e(a,r,s,{symbol:!0})}}),t.ChartRegistry.register({id:"ternaryline",dimensions:["x","y","z"],draw:(a,r,n,s)=>{t.axis.drawTernaryGridLines(a,s),e(a,r,s,{symbol:!0,line:!0})}}),t.ChartRegistry.register({id:"ternaryarea",dimensions:["x","y","z"],draw:(a,r,n,s)=>{t.axis.drawTernaryGridLines(a,s),e(a,r,s,{area:!0})}})}(window.GraphPlotter),function(t){"use strict";t.axis.prepareChartContext=function(){const e=t.getSettings(),a=t.getSeries(),[r,n]=e.ratio.split(":").map(Number);t.config.DIM.H=Math.round(t.config.DIM.W*n/r),t.config.DIM.MR=80+(1===e.multiyaxis&&a.length>1?(a.length-2)*e.multiygap:0);const s=t.axis.getTitles(e.mode),{xScale:i,yScale:o}=t.axis.makeScales(e,a);return t.state.lastXScale=i,t.state.lastYScale=o,{s:e,series:a,xScale:i,yScale:o,W:t.config.DIM.W,H:t.config.DIM.H,MT:t.config.DIM.MT,MB:t.config.DIM.MB,ML:t.config.DIM.ML,MR:t.config.DIM.MR,titles:s}},t.axis.makeScales=function(e,a){const r=t.config.DIM;if("histogram"===e.type){const n=a.flatMap((t=>t.y)).filter((t=>Number.isFinite(t))),[s,i]=d3.extent(n),o=(i-s)/e.bins,c=d3.range(s,i,o),l=d3.max(a.map((t=>d3.max(d3.histogram().domain([s,i]).thresholds(c)(t.y),(t=>t.length))))),d=t.state.overrideX||[s,i],u=t.state.overrideMultiY?.[0]||[0,1.05*l];return{xScale:d3.scaleLinear().domain(d).range([r.ML,r.W-r.MR]),yScale:d3.scaleLinear().domain(u).range([r.H-r.MB,r.MT])}}if("bar"===e.type){const e=a.flatMap((t=>t.rawX)),n=a.flatMap((t=>t.y)).filter((t=>Number.isFinite(t))),[s,i]=d3.extent(n),o=.06*(i-s),c=t.state.overrideMultiY?.[0]||[s-o,i+o];return{xScale:d3.scaleBand().domain(e).range([r.ML,r.W-r.MR]).padding(t.ChartRegistry.get("bar").bandPadding),yScale:d3.scaleLinear().domain(c).range([r.H-r.MB,r.MT])}}const n=a.flatMap((t=>t.x)).filter((t=>Number.isFinite(t))),s=a.flatMap((t=>t.y)).filter((t=>Number.isFinite(t))),[i,o]=d3.extent(n),[c,l]=d3.extent(s),d=.02*(o-i),u=.06*(l-c);let m;m=t.state.overrideX?t.state.overrideX:"ftir"===e.mode||"nmr"===e.mode?[o+d,i-d]:[i-d,o+d];const p=t.state.overrideMultiY?.[0]?t.state.overrideMultiY[0]:[c-u,l+u];return{xScale:d3.scaleLinear().domain(m).range([r.ML,r.W-r.MR]),yScale:d3.scaleLinear().domain(p).range([r.H-r.MB,r.MT])}},t.axis.applyGraphRatio=function(e){const a=t.config.ratioPresets[e]||t.config.ratioPresets["4:2.85"],[r,n]=e.split(":").map(Number),s=t.state.multiYScales?.length>1?(t.state.multiYScales.length-2)*a.multiygap:0;t.config.DIM.H=Math.round(t.config.DIM.W*n/r),t.config.DIM.MR=80+s,d3.selectAll("#chart svg g.axis-title foreignObject div").style("font-size",a.axisTitleFs+"px").each((function(){const t=this.scrollWidth+5;d3.select(this.parentNode).attr("width",t).attr("x",-t/2)})),d3.selectAll("#chart svg g.legend-group foreignObject div").style("font-size",a.legendFs+"px").each((function(){d3.select(this.parentNode).attr("width",this.scrollWidth+5)}))},t.axis.resetScales=function(e=!0){const a=t.state;e&&(a.overrideX=null,a.overrideMultiY={},a.overrideXTicks=null,a.overrideYTicks={},a.overrideScaleformatX=null,a.overrideScaleformatY={},a.overrideCustomTicksX=null,a.overrideCustomTicksY={},a.overrideCustomTicksTernary=null,a.overrideTernary=null,a.overrideTernaryTicks=null,a.minorTickOn={},a.useCustomTicksOn={});const r=function(t){if(!t.length)return null;const e=t.flatMap((t=>t.x)),a=t.flatMap((t=>t.y)),[r,n]=d3.extent(e),[s,i]=d3.extent(a),o=.02*(n-r),c=.06*(i-s);return{minX:r-o,maxX:n+o,minY:s-c,maxY:i+c}}(t.getSeries());r&&e&&(document.getElementById("scalemin").value=r.minX,document.getElementById("scalemax").value=r.maxX)}}(window.GraphPlotter),function(t){"use strict";function e(e,a=0){const r=d3.format(""),n=d3.format(".2s"),s=d3.format(".0e"),i=t.state;let o=0;return"x"===e?o=i.overrideScaleformatX??0:"y"===e?o=i.overrideScaleformatY?.[a]??0:"a"!==e&&"b"!==e&&"c"!==e||(o=i.overrideScaleformatTernary?.[e]??0),1===o?n:2===o?s:r}t.axis.getTitles=function(t){switch(t){case"uvvis":return{x:"Wavelength (nm)",y:"Absorbance (a.u.)"};case"tauc":return{x:"Energy (eV)",y:"Intensity (a.u.)"};case"xrd":return{x:"2θ (°)",y:"Intensity (a.u.)"};case"ftir":return{x:"Wavenumber (cm⁻¹)",y:"Transmittance (%)"};case"raman":return{x:"Raman Shift (cm⁻¹)",y:"Intensity (a.u.)"};case"pl":return{x:"Wavelength (nm)",y:"Intensity (a.u.)"};case"xps":return{x:"Binding Energy (eV)",y:"Intensity (cps)"};case"tga":return{x:"Temperature (°C)",y:"Weight (%)"};case"dsc":return{x:"Temperature (°C)",y:"Heat Flow (mW)"};case"bet":return{x:"Relative Pressure (P/P₀)",y:"Adsorbed Volume (cm³·g⁻¹)"};case"saxs":return{x:"Scattering Vector q (Å⁻¹)",y:"Intensity (a.u.)"};case"nmr":return{x:"δ (ppm)",y:"Intensity (a.u.)"};case"ternary":return{a:"A-axis",b:"B-axis",c:"C-axis"};case"tensile":return{x:"Strain",y:"Stress"};default:return{x:"x-axis",y:"y-axis"}}},t.axis.applyTickStyles=function(e,a,r,n,s="currentColor"){const i=(t.state.tickLabelStyles[a]||{})[r]||{};e.selectAll("text").classed("tick-label",!0).classed(`tick-${a}`,!0).style("font-size",i.fontSize||n+"px").style("fill",i.color||s).style("font-family",i.fontFamily||"Arial").style("font-weight",i.fontWeight||"normal").style("font-style",i.fontStyle||"normal").style("cursor","default")},t.axis.addMinorTicks=function(e,a,r,n=0,s=4,i=1,o="currentColor"){if("function"!=typeof a.ticks)return;let c=null,l=null,d=!1;if(null!=e.attr("data-xi"))c=t.state.overrideCustomTicksX||null,d="X"===window.selectedAxisName,l="X";else if(null!=e.attr("data-yi")){const a=+e.attr("data-yi");c=t.state.overrideCustomTicksY&&t.state.overrideCustomTicksY[a]||null,d=window.selectedAxisName===(0===a?"Y":"Y"+(a+1)),l="Y"+a}else null!=e.attr("data-ai")?(c=t.state.overrideCustomTicksTernary?.a||null,d="A"===window.selectedAxisName,l="A"):null!=e.attr("data-bi")?(c=t.state.overrideCustomTicksTernary?.b||null,d="B"===window.selectedAxisName,l="B"):null!=e.attr("data-ci")&&(c=t.state.overrideCustomTicksTernary?.c||null,d="C"===window.selectedAxisName,l="C");if(!1===t.state.minorTickOn[l])return;const u=!0===t.state.useCustomTicksOn?.[l],m=a.domain();let p=[];if(u){if(!Array.isArray(c)||c.length<2)return;const t=c.filter(Number.isFinite).sort(((t,e)=>t-e));for(let e=0;e<t.length-1;e++){const a=(t[e]+t[e+1])/2;a>=m[0]&&a<=m[1]&&p.push(a)}}else{if(r===d3.axisBottom?n=t.state.overrideXTicks??t.state.overrideTernaryTicks?.a??n:r===d3.axisLeft?n=t.state.overrideYTicks?.[0]??t.state.overrideTernaryTicks?.b??n:r===d3.axisRight&&(n=t.state.overrideTernaryTicks?.c??n),null==n)return;const e=a.ticks(n);if(e.length>=2){const t=e[1]-e[0];p=e.slice(0,-1).map((e=>e+t/2)),e[0]-t/2>=m[0]&&p.unshift(e[0]-t/2),e[e.length-1]+t/2<=m[1]&&p.push(e[e.length-1]+t/2)}}if(!p.length)return;p=p.filter((t=>t>=Math.min(m[0],m[1])&&t<=Math.max(m[0],m[1])));const h=e.append("g").call(r(a).tickValues(p).tickSize(s).tickFormat(""));h.select("path.domain").remove(),h.selectAll("line").classed("minor-tick",!0).attr("stroke-width",i).attr("stroke",o)},t.axis.drawAxis=function(a,r,n,s,i){const o=t.config.DIM;if(["ternary","ternaryline","ternaryarea"].includes(s.type))return a.selectAll(".axis-title").remove(),void t.axis.renderTernaryAxes(a,s,o);a.selectAll(".axis-title.ternary").remove();const c=r.x,l=r.y,d=t.state.overrideCustomTicksX,u=d?null:t.state.overrideXTicks??s.xticks,m=t.state.overrideCustomTicksY&&t.state.overrideCustomTicksY[0],p=m?null:t.state.overrideYTicks&&null!=t.state.overrideYTicks[0]?t.state.overrideYTicks[0]:s.yticks,h=a.append("g").attr("data-xi",0).attr("transform","translate(0,"+(o.H-o.MB)+")").attr("stroke-width",s.scalewidth).call(d3.axisBottom(c).tickValues(d).ticks(u).tickSize(6).tickPadding(4).tickFormat("bar"===s.type?null:e("x",0)));t.axis.applyTickStyles(h,"x",0,s.scaleFs);const f=a.append("g").attr("data-yi",0).attr("transform","translate("+o.ML+",0)").attr("stroke-width",s.scalewidth).call(d3.axisLeft(l).tickValues(m).ticks(p).tickSize(6).tickPadding(4).tickFormat(e("y",0)));t.axis.applyTickStyles(f,"y",0,s.scaleFs),t.axis.addMinorTicks(h,c,d3.axisBottom,s.xticks,4,s.scalewidth,"currentColor"),t.axis.addMinorTicks(f,l,d3.axisLeft,s.yticks,4,s.scalewidth,"currentColor"),a.append("line").attr("x1",o.ML).attr("y1",o.MT).attr("x2",o.W-o.MR).attr("y2",o.MT).attr("stroke","black").attr("stroke-linecap","square").attr("stroke-width",s.scalewidth),a.append("line").attr("x1",o.W-o.MR).attr("y1",o.MT).attr("x2",o.W-o.MR).attr("y2",o.H-o.MB).attr("stroke","black").attr("stroke-linecap","square").attr("stroke-width",s.scalewidth),function(a,r,n,s){const i=r.y,o=t.config.DIM;if(1===n.multiyaxis&&["line","area","scatter","scatterline"].includes(n.type)&&s.length>1){if(r.y2=s.map(((t,e)=>{if(0===e)return i;const[a,r]=d3.extent(t.y);return d3.scaleLinear().domain([a-.06*(r-a),r+.06*(r-a)]).range([o.H-o.MB,o.MT])})),t.state.multiYScales=r.y2,t.state.overrideMultiY)for(const[e,a]of Object.entries(t.state.overrideMultiY)){const r=+e;t.state.multiYScales[r]&&t.state.multiYScales[r].domain(a)}s.slice(1).forEach(((r,s)=>{const i=s+1,c=t.state.overrideCustomTicksY&&t.state.overrideCustomTicksY[i],l=c?null:t.state.overrideYTicks&&null!=t.state.overrideYTicks[i]?t.state.overrideYTicks[i]:n.yticks,d=a.append("g").attr("data-yi",i).attr("transform",`translate(${o.W-o.MR+s*n.multiygap},0)`).attr("stroke-width",n.scalewidth).call(d3.axisRight(t.state.multiYScales[i]).tickValues(c).ticks(l).tickFormat(e("y",i)));d.selectAll("path,line").attr("stroke",r.color),t.axis.addMinorTicks(d,t.state.multiYScales[i],d3.axisRight,l,4,n.scalewidth,r.color),t.axis.applyTickStyles(d,"y",i,n.scaleFs,r.color)}))}}(a,r,s,i),function(e,a,r){a.forEach((a=>{let n=e.select(`g.axis-title-${a.key}`);if(n.empty()){n=e.append("g").classed(`axis-title axis-title-${a.key} user-text`,!0).attr("data-axis-mode",r).attr("transform",`translate(${a.pos[0]},${a.pos[1]}) ${a.rotation?`rotate(${a.rotation})`:""}`.replace(/\s+/g," ")).call(t.utils.applyDrag);const s=t.utils.editableText(n,{x:0,y:0,text:a.label,rotation:0});s.div.text(a.label),s.fo.attr("width",s.div.node().scrollWidth+5).attr("x",-(s.div.node().scrollWidth+5)/2).attr("y",0),s.div.style("text-align",a.anchor||"middle")}else if(n.attr("data-axis-mode")!==r){const t=n.select("foreignObject");t.select("div").text(a.label);const e=t.select("div").node().scrollWidth+5;t.attr("width",e).attr("x",-e/2).attr("y",0),n.attr("data-axis-mode",r)}n.attr("transform",`translate(${a.pos[0]},${a.pos[1]}) ${a.rotation?`rotate(${a.rotation})`:""}`.replace(/\s+/g," "))}))}(a,[{key:"x",label:n.x,pos:[o.W/2,o.H-o.MB/1.7],rotation:0,anchor:"middle"},{key:"y",label:n.y,pos:[o.ML-60,o.H/2],rotation:-90,anchor:"middle"}],s.mode)},t.axis.renderTernaryAxes=function(e,a,r){t.axis.drawTernaryAxis(e,a);const n=r.W-r.ML-r.MR,s=r.H-r.MT-r.MB,i=Math.min(n,2*s/Math.sqrt(3)),o=i*Math.sqrt(3)/2,c=[r.ML+(n-i)/2,r.MT+(s-o)/2+o],l=[c[0]+i,c[1]],d=[c[0]+i/2,c[1]-o];[{text:"A-axis",x:(l[0]+d[0])/2+50,y:(l[1]+d[1])/2-25,rot:60,cls:"tern-x"},{text:"B-axis",x:(c[0]+d[0])/2-50,y:(c[1]+d[1])/2-25,rot:-60,cls:"tern-y"},{text:"C-axis",x:(c[0]+l[0])/2,y:c[1]+25,rot:0,cls:"tern-z"}].forEach((({text:a,x:r,y:n,rot:s,cls:i})=>{const o=e.append("g").classed(`axis-title ternary ${i} user-text`,!0).attr("transform",`translate(${r},${n}) rotate(${s})`),{fo:c,div:l}=t.utils.editableText(o,{x:0,y:0,text:a,rotation:0});c.attr("width",l.node().scrollWidth+5).attr("x",-(l.node().scrollWidth+5)/2)}))},t.axis.drawTernaryAxis=function(e,a){const r=t.config.DIM,n=r.W-r.ML-r.MR,s=r.H-r.MT-r.MB,i=Math.min(n,2*s/Math.sqrt(3)),o=i*Math.sqrt(3)/2,c=r.ML+(n-i)/2,l=r.MT+(s-o)/2+o,d=c+i,u=t.state.overrideTernary?.a||[0,100],m=t.state.overrideTernary?.b||[0,100],p=t.state.overrideTernary?.c||[0,100],h=d3.scaleLinear().domain(u).range([0,i]),f=d3.scaleLinear().domain(m).range([i,0]),g=d3.scaleLinear().domain(p).range([0,i]),y=t.state.overrideCustomTicksTernary?.a,v=t.state.overrideCustomTicksTernary?.b,x=t.state.overrideCustomTicksTernary?.c,k=y?null:t.state.overrideTernaryTicks?.a??a.xticks,b=v?null:t.state.overrideTernaryTicks?.b??a.xticks,w=x?null:t.state.overrideTernaryTicks?.c??a.xticks;t.state.axisScales={a:h,b:f,c:g};const S=e.append("g").attr("data-ai",0).attr("transform",`translate(${c},${l})`).attr("stroke-width",a.scalewidth).call(d3.axisBottom(h).tickValues(y).ticks(k).tickSize(6).tickPadding(4));t.axis.applyTickStyles(S,"a",0,a.scaleFs);const T=e.append("g").attr("data-bi",0).attr("transform",`translate(${c},${l}) rotate(210)`).attr("stroke-width",a.scalewidth).call(d3.axisLeft(f).tickValues(v).ticks(b).tickSize(-6).tickPadding(15));T.selectAll("text").attr("transform","rotate(-210)").style("text-anchor","middle").attr("dy","0px"),t.axis.applyTickStyles(T,"b",0,a.scaleFs);const M=e.append("g").attr("data-ci",0).attr("transform",`translate(${d},${l}) rotate(150)`).attr("stroke-width",a.scalewidth).call(d3.axisRight(g).tickValues(x).ticks(w).tickSize(-6).tickPadding(15));M.selectAll("text").attr("transform","rotate(-150)").style("text-anchor","middle").attr("dy","0px"),t.axis.applyTickStyles(M,"c",0,a.scaleFs),t.axis.addMinorTicks(S,h,d3.axisBottom,k,4,a.scalewidth,"currentColor"),t.axis.addMinorTicks(T,f,d3.axisLeft,b,-4,a.scalewidth,"currentColor"),t.axis.addMinorTicks(M,g,d3.axisRight,w,-4,a.scalewidth,"currentColor")},t.axis.drawTernaryGridLines=function(e,a){const r=t.config.DIM,n=r.W-r.ML-r.MR,s=r.H-r.MT-r.MB,i=Math.min(n,2*s/Math.sqrt(3)),o=i*Math.sqrt(3)/2,c=r.ML+(n-i)/2,l=r.MT+(s-o)/2+o,d=c+i,u=l,m=c+i/2,p=l-o,h=t.state.overrideTernary||{},f=[h.a||[0,100],h.b||[0,100],h.c||[0,100]],g=[[c,l,d,u,m,p],[d,u,c,l,m,p],[m,p,c,l,d,u]];[d3.scaleLinear().domain(f[0]).range([0,i]),d3.scaleLinear().domain(f[1]).range([i,0]),d3.scaleLinear().domain(f[2]).range([0,i])].forEach(((t,r)=>t.ticks(a.xticks).forEach((t=>{if(t<=f[r][0]||t>=f[r][1])return;const n=(t-f[r][0])/(f[r][1]-f[r][0]),[s,i,o,c,l,d]=g[r];e.append("line").attr("x1",s+(o-s)*n).attr("y1",i+(c-i)*n).attr("x2",s+(l-s)*n).attr("y2",i+(d-i)*n).attr("stroke",a.gridcolor||"#ccc").attr("stroke-width",a.gridwidth||1).attr("stroke-dasharray","2,2")}))))}}(window.GraphPlotter),function(t){"use strict";function e(){return"string"==typeof window.selectedAxisName?window.selectedAxisName:""}function a(a,r){document.getElementById(a).addEventListener("input",(n=>{const s=parseFloat(n.target.value),i=parseFloat(document.getElementById("scalemin"===a?"scalemax":"scalemin").value),o=e();if(!isNaN(s)&&!isNaN(i)&&o){if("X"===o)t.state.overrideX=r?[s,i]:[i,s];else if(o.startsWith("Y")){const e=window.activeYi||0;t.state.overrideMultiY=t.state.overrideMultiY||{},t.state.overrideMultiY[e]=r?[s,i]:[i,s]}else if(["A","B","C"].includes(o)){const e=o.toLowerCase();t.state.overrideTernary=t.state.overrideTernary||{},t.state.overrideTernary[e]=r?[s,i]:[i,s]}t.renderChart()}}))}t.axis.tickEditing=function(e){e.selectAll("g.tick,path.domain,text.tick-label,line.minor-tick,g.tick line").style("cursor","pointer").on("click",(e=>{e.stopPropagation(),t.utils.clearActive(),"bar"===document.querySelector('input[name="charttype"]:checked').id&&d3.select(e.currentTarget).classed("tick-x")||["scalemin","scalemax","tickcount","scaleformat","customticks","useCustomTicks","showMinorTicks"].forEach((t=>document.getElementById(t).disabled=!1));const a=e.currentTarget,r="path"===a.tagName?a.parentNode:"g"===a.tagName?a:a.closest("g[data-xi],g[data-yi],g[data-ai],g[data-bi],g[data-ci]");if(!r)return;const n=r.getAttribute("data-xi"),s=r.getAttribute("data-yi"),i=r.getAttribute("data-ai"),o=r.getAttribute("data-bi"),c=r.getAttribute("data-ci");let l,d,u,m;if(null!=n)u="X",m="X",l=d3.select(r).selectAll("text.tick-x"),d=t.state.lastXScale.domain();else if(null!=s)u="0"===s?"Y":"Y"+(+s+1),m="Y"+ +s,l=d3.select(r).selectAll("text.tick-y"),d=(t.state.multiYScales?.[s]||t.state.lastYScale).domain(),window.activeYi=+s;else if(null!=i)u="A",m="A",l=d3.select(r).selectAll("text.tick-a"),d=t.state.axisScales.a.domain();else if(null!=o)u="B",m="B",l=d3.select(r).selectAll("text.tick-b"),d=t.state.axisScales.b.domain();else{if(null==c)return;u="C",m="C",l=d3.select(r).selectAll("text.tick-c"),d=t.state.axisScales.c.domain()}window.selectedAxisName=u,t.ui.openSidebarPanel?.("icon3"),l.attr("contenteditable",!0).style("outline","1px solid #4A90E2").style("cursor","pointer"),t.state.activeTicks=l;const p=t=>document.getElementById(t),h=p("axis-label"),f=p("scalemin"),g=p("scalemax"),y=p("tickcount"),v=p("scaleformat"),x=p("useCustomTicks"),k=p("customticks");h.textContent="Axis Settings: "+u,f.value=d[0].toFixed(2),g.value=d[1].toFixed(2);const b=["A","B","C"].includes(u),w=u.startsWith("Y"),S="X"===u?t.state.overrideCustomTicksX:b?t.state.overrideCustomTicksTernary?.[u.toLowerCase()]:t.state.overrideCustomTicksY?.[window.activeYi];k.value=S?.join(",")||"",y.value=("X"===u?t.state.overrideXTicks:b?t.state.overrideTernaryTicks?.[u.toLowerCase()]:t.state.overrideYTicks?.[window.activeYi])||l.size(),v.value="X"===u?t.state.overrideScaleformatX??0:u.startsWith("Y")?t.state.overrideScaleformatY?.[window.activeYi]??0:t.state.overrideScaleformatTernary?.[u.toLowerCase()]??0,document.querySelector('label[for="scaleformat"]').textContent=["Format: 00","Format: K","Format: e"][+v.value];const T="X"===u||w||b;x.disabled=!T,x.checked=!(!t.state.useCustomTicksOn||!t.state.useCustomTicksOn[m]),v.disabled=b,y.disabled=x.checked,k.disabled=!x.checked;const M=document.getElementById("showMinorTicks");M.disabled=!1,M.checked=!1!==t.state.minorTickOn[m]}))},a("scalemin",!0),a("scalemax",!1),document.getElementById("tickcount").addEventListener("input",(function(){const a=e();if(!a)return;const r=+this.value;if("X"===a)t.state.overrideXTicks=r;else if("Y"===a||a.startsWith("Y")){const e=window.activeYi;t.state.overrideYTicks=t.state.overrideYTicks||{},t.state.overrideYTicks[e]=r}else["A","B","C"].includes(a)&&(t.state.overrideTernaryTicks=t.state.overrideTernaryTicks||{},t.state.overrideTernaryTicks[a.toLowerCase()]=r);t.renderChart()})),document.getElementById("scaleformat").addEventListener("input",(function(){const a=+this.value;document.querySelector('label[for="scaleformat"]').textContent=["Format: 00","Format: K","Format: e"][a];const r=e();if(r){if("X"===r)t.state.overrideScaleformatX=a;else if(r.startsWith("Y")){const e=window.activeYi||0;t.state.overrideScaleformatY=t.state.overrideScaleformatY||{},t.state.overrideScaleformatY[e]=a}t.renderChart()}})),document.getElementById("customticks").addEventListener("input",(function(){const a=e();if(!a)return;const r=this.value.trim(),n=r?r.split(",").map((t=>parseFloat(t.trim()))).filter((t=>!isNaN(t))):null;if("X"===a)t.state.overrideCustomTicksX=n;else if(a.startsWith("Y")){const e=window.activeYi||0;t.state.overrideCustomTicksY=t.state.overrideCustomTicksY||{},n?t.state.overrideCustomTicksY[e]=n:delete t.state.overrideCustomTicksY[e]}else{const e=t.state.activeTicks?Array.from(t.state.activeTicks.nodes()[0].classList).find((t=>t.startsWith("tick-")&&!["tick-label","tick-x","tick-y"].includes(t))):null;if(e){const a=e.split("-")[1];t.state.overrideCustomTicksTernary=t.state.overrideCustomTicksTernary||{},n?t.state.overrideCustomTicksTernary[a]=n:delete t.state.overrideCustomTicksTernary[a]}}t.renderChart()})),document.getElementById("useCustomTicks").addEventListener("change",(function(){const a=e();if(!a)return;const r=this.checked,n=document.getElementById("customticks"),s=document.getElementById("tickcount");n.disabled=!r,s.disabled=r;const i="X"===a?"X":a.startsWith("Y")?"Y"+(window.activeYi||0):a;t.state.useCustomTicksOn=t.state.useCustomTicksOn||{},t.state.useCustomTicksOn[i]=r;if(r){const e=(o=n.value).trim()?o.split(",").map((t=>+t.trim())).filter(Number.isFinite):[];if("X"===i)t.state.overrideCustomTicksX=e;else if(i.startsWith("Y")){const a=window.activeYi||0;t.state.overrideCustomTicksY=t.state.overrideCustomTicksY||{},t.state.overrideCustomTicksY[a]=e}else{const a=i.toLowerCase();t.state.overrideCustomTicksTernary=t.state.overrideCustomTicksTernary||{},t.state.overrideCustomTicksTernary[a]=e}}else if("X"===i)t.state.overrideCustomTicksX=null;else if(i.startsWith("Y")){const e=window.activeYi||0;t.state.overrideCustomTicksY&&delete t.state.overrideCustomTicksY[e]}else{const e=i.toLowerCase();t.state.overrideCustomTicksTernary&&delete t.state.overrideCustomTicksTernary[e]}var o;t.renderChart()})),document.getElementById("showMinorTicks").addEventListener("change",(function(){if(!window.selectedAxisName)return;let e="X"===window.selectedAxisName?"X":window.selectedAxisName.startsWith("Y")?"Y"+(window.activeYi||0):window.selectedAxisName;t.state.minorTickOn[e]=this.checked,t.renderChart()}))}(window.GraphPlotter),function(t){"use strict";function e(e,a,r,n,s,i){switch(e.selectAll(".legend-marker").remove(),a){case"scatter":case"ternary":{const a=t.config.SYMBOL_TYPES[s%t.config.SYMBOL_TYPES.length],o=d3.symbol().type(a).size(Math.PI*r.symbolsize**2);e.append("path").classed("legend-marker",!0).attr("d",o).attr("transform",`translate(${i/2},0)`).attr("fill",n.color);break}case"scatterline":case"ternaryline":{e.append("line").classed("legend-marker",!0).attr("x2",i).attr("stroke",n.color).attr("stroke-width",r.linewidth);const a=t.config.SYMBOL_TYPES[s%t.config.SYMBOL_TYPES.length],o=d3.symbol().type(a).size(Math.PI*r.symbolsize**2);e.append("path").classed("legend-marker",!0).attr("d",o).attr("transform",`translate(${i/2},0)`).attr("fill",n.color);break}case"bar":case"histogram":e.append("rect").classed("legend-marker",!0).attr("width",i).attr("height",8).attr("y",-4).attr("fill",n.color);break;case"area":case"ternaryarea":e.append("rect").classed("legend-marker",!0).attr("width",i).attr("height",8).attr("y",-4).attr("fill",n.color).attr("fill-opacity",r.opacity);break;default:e.append("line").classed("legend-marker",!0).attr("x2",i).attr("stroke",n.color).attr("stroke-width",r.linewidth)}}t.ui.drawLegend=function(){const a=d3.select("#chart svg"),r=t.state.hot.getData(),n=r[0],s=t.getSeries(),i=t.getSettings(),o=n.map(((e,a)=>"Y-axis"===e&&t.state.colEnabled[a]?a:-1)).filter((t=>t>=0)),c=t.config.DIM.W-t.config.DIM.MR-100,l=t.config.DIM.MT+25,d=a.selectAll("g.legend-group:not(.xrd-ref-legend)").data(o,(t=>t));d.exit().remove(),d.attr("transform",(function(t,e){return this.dataset.savedTransform||`translate(${c},${l+20*e})`}));d.enter().append("g").classed("legend-group",1).attr("data-col",(t=>t)).attr("transform",((t,e)=>`translate(${c},${l+20*e})`)).call(t.utils.applyDrag).each((function(a,n){e(d3.select(this),i.type,i,s[n],n,20);const o=t.utils.editableText(d3.select(this),{x:25,y:-10,text:r[2][a]});o.fo.attr("width",o.div.node().scrollWidth+o.pad);const c=o.div.node();c.addEventListener("click",(t=>{t.stopPropagation(),c.focus()})),c.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),c.blur())})),c.addEventListener("blur",(function(){t.state.hot.setDataAtCell(2,a,c.textContent.trim(),"paste"),t.state.hot.render(),d3.select(c).attr("contenteditable",!1).style("outline","none").style("cursor","move")}))})),d.select("foreignObject div").text((t=>r[2][t])),d.each((function(t,a){d3.select(this).selectAll(".legend-marker").remove(),e(d3.select(this),i.type,i,s[a],a,20)}))},t.ui.drawErrorBars=function(t,e,a,r){const n=("bar"===r.type&&a.x.bandwidth?a.x.bandwidth():0)/e.length,s="bar"===r.type?.2*n:r.symbolsize;e.forEach(((e,i)=>{e.error&&e.rawX.forEach(((o,c)=>{const l=e.error[c];if(!isFinite(l))return;const d="bar"===r.type?a.x(o)+i*n+n/2:a.x(o),u=a.y(e.y[c]+l),m=a.y(e.y[c]-l);t.append("line").attr("x1",d).attr("x2",d).attr("y1",u).attr("y2",m).attr("stroke",e.errorColor).attr("stroke-width",r.linewidth),[u,m].forEach((a=>t.append("line").attr("x1",d-s).attr("x2",d+s).attr("y1",a).attr("y2",a).attr("stroke",e.errorColor).attr("stroke-width",r.linewidth)))}))}))}}(window.GraphPlotter),function(t){"use strict";t.ui.toolTip=function(e,a){const r=d3.select("#tooltip").node();let n=!1,s=null;e.on("mousemove",(function(i){s=d3.pointer(i,e.node()),n||(n=!0,requestAnimationFrame((()=>{if(n=!1,!s)return;const[e,i]=s;if(e<t.config.DIM.ML||e>t.config.DIM.W-t.config.DIM.MR||i<t.config.DIM.MT||i>t.config.DIM.H-t.config.DIM.MB)return;const o=a.xScale.invert(e).toFixed(4),c=a.yScale.invert(i).toFixed(4);!function(t,e,a){if(!t)return;const r=document.createElement("b");r.textContent=` ${e}`;const n=document.createElement("b");n.textContent=` ${a}`,t.replaceChildren(document.createTextNode("X-Scale:"),r,document.createElement("br"),document.createTextNode("Y-Scale:"),n)}(r,o,c)})))}))},t.ui.areacalculation=function(){const e=d3.select("#chart svg");if(e.empty())return;const a=document.getElementById("areaResults"),r=d3.brushX().extent([[t.config.DIM.ML,t.config.DIM.MT],[t.config.DIM.W-t.config.DIM.MR,t.config.DIM.H-t.config.DIM.MB]]).on("end",(function({selection:r}){if(e.selectAll(".area-highlight").remove(),!r)return void(a&&a.replaceChildren());const[n,s]=r,i=t.state.lastXScale.invert(n),o=t.state.lastXScale.invert(s),c=Math.min(i,o),l=Math.max(i,o),d=document.querySelector('input[name="axistitles"]:checked').value,u="ftir"===d?100:t.state.lastYScale.domain()[0]<=0&&0<=t.state.lastYScale.domain()[1]?0:t.state.lastYScale.domain()[0],m=t.state.lastYScale(u),p=[];t.getSeries().forEach((a=>{const r=a.x.map(((t,e)=>({x:t,y:a.y[e]}))).filter((t=>t.x>=c&&t.x<=l));if(r.length<2)return;let n=0;for(let t=0;t<r.length-1;t++){n+=(r[t+1].x-r[t].x)*("ftir"===d?u-(r[t].y+r[t+1].y)/2:(r[t].y+r[t+1].y)/2)}e.append("path").datum(r).attr("class","area-highlight").attr("d",d3.area().x((e=>t.state.lastXScale(e.x))).y0((()=>m)).y1((e=>t.state.lastYScale(e.y)))).attr("fill",a.color).attr("fill-opacity","ftir"===d?.1:.2).lower(),p.push({label:a.label,color:a.color,area:n})})),function(t,e){if(!t)return;if(!e.length){const e=document.createElement("em");return e.textContent="No data in selected range.",void t.replaceChildren(e)}const a=document.createDocumentFragment();e.forEach((({label:t,color:e,area:r})=>{const n=document.createElement("div");n.style.color=e;const s=document.createElement("b");s.textContent=r.toFixed(4),n.append(document.createTextNode(`${t}: Area = `),s),a.appendChild(n)})),t.replaceChildren(a)}(a,p)})),n=e.append("g").attr("class","area-brush").style("display","none").call(r);d3.select("#enableAreaCalc").on("change",(function(){this.checked?n.style("display",null):(n.style("display","none").call(r.move,null),e.selectAll(".area-highlight").remove(),a&&a.replaceChildren())}))},t.ui.disableAreaCal=function(){const t=document.getElementById("enableAreaCalc");t.checked&&(t.checked=!1,t.dispatchEvent(new Event("change")))}}(window.GraphPlotter),function(t){"use strict";function e(e,a){if(t.state.activeTicks){var r="color"==e?"fill":"fontSize"==e?"font-size":"fontFamily"==e?"font-family":"fontWeight"==e?"font-weight":"fontStyle"==e?"font-style":e,n=(t.state.activeTicks.attr("class")||"").split(/\s+/).find((t=>t.startsWith("tick-")&&"tick-label"!==t));if(n){var s=n.slice(5),i="y"==s&&window.activeYi||0;t.state.tickLabelStyles[s]=t.state.tickLabelStyles[s]||{},t.state.tickLabelStyles[s][i]=t.state.tickLabelStyles[s][i]||{},t.state.tickLabelStyles[s][i][e]=a,t.state.activeTicks.style(r,a)}}}function a(){if(void 0!==t.state.activeText&&t.state.activeText)return t.state.activeText.node?t.state.activeText.node():t.state.activeText;if(void 0!==t.state.activeDiv&&t.state.activeDiv)return t.state.activeDiv.node?t.state.activeDiv.node():t.state.activeDiv;const e=window.getSelection&&window.getSelection();if(!e||0===e.rangeCount)return null;let a=e.anchorNode instanceof Element?e.anchorNode:e.anchorNode&&e.anchorNode.parentElement;if(!a)return null;return a.closest&&a.closest("foreignObject > div[contenteditable]")||null}function r(){const t=a(),e=!!t&&document.queryCommandState("superscript"),r=!!t&&document.queryCommandState("subscript"),n=document.getElementById("supBtn"),s=document.getElementById("subBtn");e?(n.classList.add("active"),s.classList.remove("active")):r?(s.classList.add("active"),n.classList.remove("active")):(n.classList.remove("active"),s.classList.remove("active"))}t.ui.refs.colorCtrl=d3.select("#addedtextcolor"),t.ui.refs.sizeCtrl=d3.select("#addedtextsize"),t.ui.refs.addTextBtn=d3.select("#addtext"),t.ui.refs.addTextVBtn=d3.select("#addtextv"),t.ui.refs.rmBtn=d3.select("#removebtn"),t.ui.refs.fontCtrl=d3.select("#fontfamily"),t.ui.refs.boldBtn=d3.select("#boldBtn"),t.ui.refs.italicBtn=d3.select("#italicBtn"),t.ui.refs.colorCtrl.on("input",(function(){const a=this.value,r=t.state.activeText||t.state.activeDiv;if(r&&r.style("color",a),t.state.activeTicks&&e("color",a),t.state.activeGroup){const e=t.state.activeGroup.select(".shape"),r=e.node().tagName.toLowerCase();"rect"!==r&&"ellipse"!==r||"none"===e.attr("fill")?e.attr("stroke",a):e.attr("fill",a).attr("stroke",a),t.features.updateArrowMarkerColor(e,a)}})),t.ui.refs.sizeCtrl.on("input",(a=>{const r=a.target.value+"px";if(e("fontSize",r),t.state.activeText||t.state.activeDiv){const e=t.state.activeText||t.state.activeDiv;e.style("font-size",r),t.state.activeFo&&t.state.activeFo.attr("width",e.node().scrollWidth+5)}if(!t.state.activeGroup)return;const n=+a.target.value,s=5+n/2,i=t.state.activeGroup.select(".shape"),o=t.state.activeGroup.select(".outline"),c=t.state.activeGroup.select(".hit");if(i.attr("stroke-width",n),c.attr("stroke-width","rect"==i.node().tagName?2*s:n+2*s),"rect"==i.node().tagName){const e=t.features.bufferOutline(i,s);o.attr("x",e.x).attr("y",e.y).attr("width",e.w).attr("height",e.h)}else{const e=t.features.bufferOutline(i,s);o.attr("points",e.join(" "))}})),t.ui.refs.fontCtrl.on("change",(a=>{const r=a.target.value;e("fontFamily",r);const n=t.state.activeText||t.state.activeDiv||t.state.activeTicks;if(n&&n.style("font-family",r),t.state.activeFo){const e=t.state.activeFo,a=e.select("div").node();e.attr("width",a.scrollWidth+5)}})),t.ui.refs.boldBtn.on("click",(()=>{const a=!t.ui.refs.boldBtn.classed("active");t.ui.refs.boldBtn.classed("active",a),e("fontWeight",a?"bold":"normal");const r=t.state.activeText||t.state.activeDiv||t.state.activeTicks;r&&r.style("font-weight",a?"bold":"normal")})),t.ui.refs.italicBtn.on("click",(()=>{const a=!t.ui.refs.italicBtn.classed("active");t.ui.refs.italicBtn.classed("active",a),e("fontStyle",a?"italic":"normal");const r=t.state.activeText||t.state.activeDiv||t.state.activeTicks;r&&r.style("font-style",a?"italic":"normal")})),t.ui.applySupSub=function(t){const e=a();if(!e)return;e.focus();const n=document.queryCommandState("superscript"),s=document.queryCommandState("subscript");"sup"===t?(n||s&&document.execCommand("subscript",!1,null),document.execCommand("superscript",!1,null)):(s||n&&document.execCommand("superscript",!1,null),document.execCommand("subscript",!1,null)),function(t){const e=t&&t.parentNode;e&&e.tagName&&"foreignobject"===e.tagName.toLowerCase()&&(e.setAttribute("width",t.scrollWidth+5),e.setAttribute("height",t.scrollHeight+5))}(e),r()},document.getElementById("supBtn").addEventListener("mousedown",(e=>{e.preventDefault(),t.ui.applySupSub("sup")})),document.getElementById("subBtn").addEventListener("mousedown",(e=>{e.preventDefault(),t.ui.applySupSub("sub")})),document.addEventListener("selectionchange",r),document.addEventListener("mouseup",r),document.addEventListener("keyup",r),t.ui.refs.rmBtn.on("click",(()=>{if(t.state.activeGroup)t.state.activeGroup.style("display","none"),t.state.activeGroup=null;else if(t.state.activeFo){const e=t.state.activeFo.node().parentNode;if(e.classList.contains("xrd-ref-legend")){const a=e.dataset.refid||"";t.matchXRD?.removeReference?.(a),d3.select(e).remove()}else e.classList.contains("legend-group")?d3.select(e).style("display","none"):d3.select(t.state.activeFo.node()).style("display","none")}t.state.activeFo=t.state.activeDiv=null,t.ui.refs.rmBtn.classed("disabled",!0)}))}(window.GraphPlotter),function(t){"use strict";let e=!1;t.ui.openSidebarPanel=function(t){const e=document.getElementById(t);return!(!e||"sidebar"!==e.name)&&(e.checked=!0,!0)},t.ui.bindShellEvents=function(){if(e)return;e=!0;const a=document.getElementById("help-icon"),r=document.getElementById("help-prompt-overlay"),n=document.getElementById("help-close");a?.addEventListener("click",(()=>{r.style.display="flex"})),n?.addEventListener("click",(()=>{r.style.display="none"}));const s=/Mac|iPod|iPhone|iPad/.test(navigator.platform),i=s?"meta":"ctrl",o=(()=>{const t=new Map;return addEventListener("keydown",(e=>{const a=[];(s?e.metaKey:e.ctrlKey)&&a.push(i),a.push(e.key.toLowerCase());const r=a.sort().join("+");t.has(r)&&(e.preventDefault(),t.get(r)(e))})),(e,a)=>t.set((t=>t.toLowerCase().split("+").map((t=>t.trim())).sort().join("+"))(e),a)})();o(`${i}+s`,(()=>document.getElementById("save")?.click())),o(`${i}+d`,(()=>document.getElementById("download")?.click())),o(`${i}+z`,(()=>document.getElementById("zoomBtn")?.click())),o(`${i}+backspace`,(()=>document.getElementById("removebtn")?.click())),o("delete",(()=>document.getElementById("removebtn")?.click())),o("escape",(()=>{t.utils.clearActive();const e=document.getElementById("popup-prompt-overlay"),a=document.getElementById("help-prompt-overlay");e&&(e.style.display="none"),a&&(a.style.display="none"),t.ui.disableAreaCal()})),o(`${i}+f`,(()=>{const t=document.querySelector(".container");t&&(document.fullscreenElement?document.exitFullscreen().then((()=>{t.style.background=""})):t.requestFullscreen().then((()=>{t.style.background="#f4eee2"})))})),o(`${i}+i`,(()=>document.getElementById("enableAreaCalc")?.click())),o(`${i}+.`,(()=>t.ui.applySupSub("sup"))),o(`${i}+,`,(()=>t.ui.applySupSub("sub")));const c="https://instanano.com/online-graph-plotter/",l=document.getElementById("mWP"),d=document.getElementById("mEM"),u=document.getElementById("mCP");l&&(l.href="https://wa.me/919467826266?text="+encodeURIComponent("Link to open InstaNANO Graph Plotter on your laptop:\n"+c)),d&&(d.href="mailto:?subject="+encodeURIComponent("InstaNANO Graph Plotter Link")+"&body="+encodeURIComponent("Link to open InstaNANO Graph Plotter on your laptop:\n\n"+c)),u&&(u.onclick=t=>(t.preventDefault(),navigator.clipboard.writeText(c).then((()=>{u.textContent="Copied"})))),matchMedia("(max-width:600px)").matches&&(document.querySelectorAll("input[name=sidebar]").forEach((t=>{t.checked=!1})),document.querySelector(".icon-strip")?.addEventListener("click",(t=>{const e=t.target.closest("label"),a=document.getElementById(e?.htmlFor);a?.checked&&(t.preventDefault(),a.checked=!1)})))}}(window.GraphPlotter),function(t){"use strict";function e(e){e.select(".hit").style("cursor","move").on("click",(a=>{t.state.hot.deselectCell(),a.stopPropagation(),t.features.activateShape(d3.select(e.node()))})),e.call(t.utils.applyDrag)}function a(e){t.ui.disableAreaCal();const a=d3.select("#chart svg");if(a.empty())return;const{fo:r,div:n}=t.utils.editableText(a,{x:t.config.DIM.W/2-t.config.DIM.MT,y:t.config.DIM.H/2-t.config.DIM.MR,text:"Text",rotation:e});r.classed("user-text",1).call(t.utils.applyDrag),t.utils.clearActive(),t.features.activateText(n,r)}t.features.activateShape=function(e){if(t.state.activeGroup===e)return;e.select(".outline").attr("visibility","visible"),t.state.activeGroup=e;e.select(".shape");t.utils.updateInspector(e.select(".shape"))},t.features.activateText=function(e,a){if(t.state.activeText===e)return;e.attr("contenteditable",!0).style("border","1px solid rgb(74,144,226)").node().focus(),t.state.activeText=e,t.state.activeFo=a,t.utils.updateInspector(e);const r=e.node();setTimeout((()=>{const t=document.createRange();t.selectNodeContents(r);const e=window.getSelection();e.removeAllRanges(),e.addRange(t)}),0)},t.features.updateArrowMarkerColor=function(t,e){let a=t.attr("marker-end");if(a&&a.startsWith("url(#arrowhead-")){let t=a.slice(5,-1);d3.select(`#${t} path`).attr("fill",e)}},t.features.bufferOutline=function(t,e){const a=t.node().tagName;if("rect"===a){return{x:+t.attr("x")-e,y:+t.attr("y")-e,w:+t.attr("width")+2*e,h:+t.attr("height")+2*e}}if("ellipse"===a){return{cx:+t.attr("cx"),cy:+t.attr("cy"),rx:+t.attr("rx")+e,ry:+t.attr("ry")+e}}{const a=+t.attr("x1"),r=+t.attr("y1"),n=+t.attr("x2"),s=+t.attr("y2"),i=n-a,o=s-r,c=Math.hypot(i,o),l=-o/c,d=i/c;return[[a+l*e,r+d*e],[n+l*e,s+d*e],[n-l*e,s-d*e],[a-l*e,r-d*e]]}},t.features.prepareShapeLayer=function(){const a=d3.select("#chart svg");a.on("click.shapeBackground",(e=>{e.target===a.node()&&t.utils.clearActive()})),a.on("mousedown.draw",(function(e){if("none"===t.state.shapeMode)return;e.preventDefault(),t.state.drawing=!0;const[r,n]=d3.pointer(e,a.node()),s="fillRect"===t.state.shapeMode||"fillEllipse"===t.state.shapeMode?"#96d35f":"#000000",i=t.state.shapeMode,o=/rect/i.test(i),c=/line|arrow/i.test(i),l=/arrow/i.test(i),d=/dashed/i.test(i),u="fillRect"===i||"fillEllipse"===i,m=/ellipse/i.test(i);c?(t.state.tempShape=a.append("line").attr("x1",r).attr("y1",n).attr("x2",r).attr("y2",n).attr("stroke",s).attr("stroke-width",1).attr("fill","none"),l&&t.state.tempShape.attr("marker-end",`url(#${function(e,a){let r="arrowhead-"+ ++t.state.arrowCount,n=e.select("defs");return n.empty()&&(n=e.append("defs")),n.append("marker").attr("id",r).attr("viewBox","0 -5 10 10").attr("refX",1).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill",a),r}(a,s)})`),d&&t.state.tempShape.attr("stroke-dasharray","7,5")):o?(t.state.tempShape=a.append("rect").attr("x",r).attr("y",n).attr("width",0).attr("height",0),u?t.state.tempShape.attr("stroke",s).attr("stroke-width",.5).attr("fill",s).attr("fill-opacity",.2):(t.state.tempShape.attr("stroke",s).attr("stroke-width",1).attr("fill","none"),d&&t.state.tempShape.attr("stroke-dasharray","7,5"))):m&&(t.state.tempShape=a.append("ellipse").attr("cx",r).attr("cy",n).attr("rx",0).attr("ry",0),u?t.state.tempShape.attr("stroke",s).attr("stroke-width",.5).attr("fill",s).attr("fill-opacity",.2):(t.state.tempShape.attr("stroke",s).attr("stroke-width",1).attr("fill","none"),d&&t.state.tempShape.attr("stroke-dasharray","7,5"))),t.state.drawStart={x:r,y:n}})),a.on("mousemove.draw",(function(e){if(!t.state.drawing||!t.state.tempShape)return;const[r,n]=d3.pointer(e,a.node()),s=t.state.tempShape.node().tagName;if("rect"===s){const e=t.state.drawStart.x,a=t.state.drawStart.y,s=r-e,i=n-a;t.state.tempShape.attr("x",s<0?r:e).attr("y",i<0?n:a).attr("width",Math.abs(s)).attr("height",Math.abs(i))}else if("ellipse"===s){const e=r-t.state.drawStart.x,a=n-t.state.drawStart.y,s=Math.abs(e)/2,i=Math.abs(a)/2,o=t.state.drawStart.x+(e<0?-s:s),c=t.state.drawStart.y+(a<0?-i:i);t.state.tempShape.attr("cx",o).attr("cy",c).attr("rx",s).attr("ry",i)}else t.state.tempShape.attr("x2",r).attr("y2",n)})),a.on("mouseup.draw mouseleave.draw",(function(){if(!t.state.drawing||!t.state.tempShape)return;t.state.drawing=!1;const r=t.state.tempShape.node().tagName,n=t.state.tempShape.attr("stroke"),s=+t.state.tempShape.attr("stroke-width")||1,i=t.state.tempShape.node().getBBox();if(i.width<5&&i.height<5||"line"===r&&Math.hypot(i.width,i.height)<5)t.state.tempShape.remove(),t.state.tempShape=null;else{t.state.tempShape.remove();const i=a.append("g").classed("shape-group",!0),o=5;if("line"===r){const e={x1:+t.state.tempShape.attr("x1"),y1:+t.state.tempShape.attr("y1"),x2:+t.state.tempShape.attr("x2"),y2:+t.state.tempShape.attr("y2")};i.append("line").classed("hit",1).attr("x1",e.x1).attr("y1",e.y1).attr("x2",e.x2).attr("y2",e.y2).attr("stroke","transparent").attr("stroke-width",s+2*o).attr("fill","none");let a=i.append("line").classed("shape",1).attr("x1",e.x1).attr("y1",e.y1).attr("x2",e.x2).attr("y2",e.y2).attr("stroke",n).attr("stroke-width",s).attr("fill","none").attr("pointer-events","none");t.state.tempShape.attr("marker-end")&&a.attr("marker-end",t.state.tempShape.attr("marker-end")),t.state.tempShape.attr("stroke-dasharray")&&a.attr("stroke-dasharray",t.state.tempShape.attr("stroke-dasharray"));const r=t.features.bufferOutline(a,o+s/2);i.append("polygon").classed("outline",1).attr("points",r.join(" ")).attr("stroke","rgb(74,144,226)").attr("stroke-width",1).attr("fill","none").attr("pointer-events","none").attr("visibility","hidden")}else if("rect"===r){const e={x:+t.state.tempShape.attr("x"),y:+t.state.tempShape.attr("y"),width:+t.state.tempShape.attr("width"),height:+t.state.tempShape.attr("height")};let a;i.append("rect").classed("hit",1).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("stroke","transparent").attr("stroke-width","fillRect"===t.state.shapeMode?2*o:s+2*o).attr("fill","none"),"fillRect"===t.state.shapeMode?a=i.append("rect").classed("shape",1).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("stroke",n).attr("stroke-width",.5).attr("fill",n).attr("fill-opacity",.2):(a=i.append("rect").classed("shape",1).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("stroke",n).attr("stroke-width",s).attr("fill","none"),t.state.tempShape.attr("stroke-dasharray")&&a.attr("stroke-dasharray",t.state.tempShape.attr("stroke-dasharray")));const r=t.features.bufferOutline(a,o);i.append("rect").classed("outline",1).attr("x",r.x).attr("y",r.y).attr("width",r.w).attr("height",r.h).attr("stroke","rgb(74,144,226)").attr("stroke-width",1).attr("fill","none").attr("pointer-events","none").attr("visibility","hidden")}else if("ellipse"===r){const e=+t.state.tempShape.attr("cx"),a=+t.state.tempShape.attr("cy"),r=+t.state.tempShape.attr("rx"),c=+t.state.tempShape.attr("ry");let l;i.append("ellipse").classed("hit",1).attr("cx",e).attr("cy",a).attr("rx",r).attr("ry",c).attr("stroke","transparent").attr("stroke-width","fillEllipse"===t.state.shapeMode?2*o:s+2*o).attr("fill","none"),"fillEllipse"===t.state.shapeMode?l=i.append("ellipse").classed("shape",1).attr("cx",e).attr("cy",a).attr("rx",r).attr("ry",c).attr("stroke",n).attr("stroke-width",.5).attr("fill",n).attr("fill-opacity",.2):(l=i.append("ellipse").classed("shape",1).attr("cx",e).attr("cy",a).attr("rx",r).attr("ry",c).attr("stroke",n).attr("stroke-width",s).attr("fill","none"),t.state.tempShape.attr("stroke-dasharray")&&l.attr("stroke-dasharray",t.state.tempShape.attr("stroke-dasharray"))),i.append("ellipse").classed("outline",1).attr("cx",e).attr("cy",a).attr("rx",r+o).attr("ry",c+o).attr("stroke","rgb(74,144,226)").attr("stroke-width",1).attr("fill","none").attr("pointer-events","none").attr("visibility","hidden")}e(i),setTimeout((()=>t.features.activateShape(i)),0),t.state.tempShape=null}d3.selectAll('input[name="shape"]').property("checked",!1),t.state.shapeMode="none"}))},t.ui.refs.addTextBtn.on("click",(function(){a(0)})),t.ui.refs.addTextVBtn.on("click",(function(){a(-90)})),d3.selectAll('input[name="shape"]').on("change",(function(){t.ui.disableAreaCal(),t.state.shapeMode=this.value,t.utils.clearActive()})),t.features.makeShapeInteractive=e}(window.GraphPlotter),function(t){"use strict";$("#zoomBtn").click((function(){const e=$(this);if(e.hasClass("active"))return d3.select(".zoom-brush").remove(),void e.removeClass("active");e.addClass("active");const a=document.getElementById("enableAreaCalc");a.checked&&(a.checked=!1,a.dispatchEvent(new Event("change")));const r=d3.select("#chart svg");r.empty()||r.append("g").attr("class","zoom-brush").style("cursor","crosshair").call(d3.brush().extent([[t.config.DIM.ML,t.config.DIM.MT],[t.config.DIM.W-t.config.DIM.MR,t.config.DIM.H-t.config.DIM.MB]]).on("end",(({selection:a})=>{if(r.select(".zoom-brush").remove(),e.removeClass("active"),!a)return;const[[n,s],[i,o]]=a,c=t.state.lastXScale.invert(n),l=t.state.lastXScale.invert(i),d=t.state.lastXScale.domain(),u=d[0]>d[1]?[Math.max(c,l),Math.min(c,l)]:[Math.min(c,l),Math.max(c,l)],m=[t.state.lastYScale.invert(s),t.state.lastYScale.invert(o)].sort(((t,e)=>t-e));t.state.overrideX=u,t.state.overrideMultiY=t.state.overrideMultiY||{},t.state.overrideMultiY[0]=m,document.getElementById("scalemin").value=u[0].toFixed(2),document.getElementById("scalemax").value=u[1].toFixed(2),t.renderChart()})))})),d3.select("#chart").on("contextmenu",(e=>{e.preventDefault(),t.axis.resetScales(!0),t.renderChart(),t.matchXRD?.render()}))}(window.GraphPlotter),function(t){"use strict";function e(t,e){const a=Math.floor(e/2),r=[];for(let e=0;e<t.length;e++){let n=0,s=0;for(let r=e-a;r<=e+a;r++)r>=0&&r<t.length&&isFinite(t[r])&&(n+=t[r],s++);r[e]=s?n/s:NaN}return r}function a(t,e){const a=Math.floor(e/2),r=[],n=[];for(let e=0;e<t.length;e++){let n=1/0;for(let r=e-a;r<=e+a;r++)r>=0&&r<t.length&&isFinite(t[r])&&(n=Math.min(n,t[r]));r[e]=n===1/0?NaN:n}for(let t=0;t<r.length;t++){let e=-1/0;for(let n=t-a;n<=t+a;n++)n>=0&&n<r.length&&isFinite(r[n])&&(e=Math.max(e,r[n]));n[t]=e===-1/0?NaN:e}return n}function r(e,a,r){const n=t.state.hot.getData(),s=n[0],i=n.slice(3),o=n[2].slice();s.forEach(((c,l)=>{if("Y-axis"===c&&t.state.colEnabled[l]){if("corrected"===e&&o[l].includes("(baseline)"))return;const c=i.map((t=>parseFloat(t[l])||NaN)),d=a(c,r),u=n[1].length;s.push("Y-axis"),n[1].push(t.config.COLORS[u%t.config.COLORS.length]),n[2].push(`${o[l]} (${e})`),i.forEach(((t,e)=>t.push(d[e])))}})),t.state.hot.loadData(n),t.axis.resetScales(!0),t.renderChart()}document.getElementById("applysmoothing").onclick=()=>{const t=+document.getElementById("smoothingslider").value;t>0&&(r("smoothed",e,t),document.getElementById("smoothingslider").value=0)},document.getElementById("applybaseline").onclick=()=>{const e=+document.getElementById("baselineslider").value;if(e<=0)return;"ftir"===t.getSettings().mode?(r("baseline",((t,e)=>a(t.map((t=>-t)),e).map((t=>-t))),e),r("corrected",((t,e)=>{const r=a(t.map((t=>-t)),e).map((t=>-t));return t.map(((t,e)=>isFinite(t)&&isFinite(r[e])?t/r[e]*100:NaN))}),e)):(r("baseline",a,e),r("corrected",((t,e)=>{const r=a(t,e);return t.map(((t,e)=>isFinite(t)&&isFinite(r[e])?t-r[e]:NaN))}),e)),document.getElementById("baselineslider").value=0},["smoothing","baseline"].forEach((r=>document.getElementById(r+"slider").addEventListener("input",(n=>{"smoothing"===r&&t.renderChart(),function(e,r,n){const s=d3.select("#chart svg");if(s.selectAll(`g.${n}`).remove(),r<=0)return;const i=t.getSettings(),o="ftir"===i.mode&&"baseline-preview"===n,c=t.getSeries().map((t=>{let n;return n=o?a(t.y.map((t=>-t)),r).map((t=>-t)):e(t.y,r),{rawX:t.rawX,x:t.x,y:n,color:t.color}})),l=t.ChartRegistry.get(i.type),d=s.append("g").classed(n,!0).attr("clip-path","url(#clip)");l.draw(d,c,{x:t.state.lastXScale,y:t.state.lastYScale},i),d.selectAll("path").attr("stroke","gray").attr("stroke-width",i.linewidth)}("smoothing"===r?e:a,+n.target.value,`${r}-preview`)}))))}(window.GraphPlotter),function(t){"use strict";function e(t,e){const a=[],r=[];for(let n=0;n<t.length;n++){const s=+t[n],i=+e[n];Number.isFinite(s)&&Number.isFinite(i)&&(a.push(s),r.push(i))}const n=a.length;if(n<2)return null;let s=0,i=0,o=0,c=0,l=0;for(let t=0;t<n;t++){const e=a[t],n=r[t];s+=e,i+=n,o+=e*e,c+=e*n,l+=n*n}const d=n*o-s*s;if(0===d)return null;const u=(n*c-s*i)/d,m=(i-u*s)/n,p=i/n;let h=0,f=0;for(let t=0;t<n;t++){const e=r[t],n=u*a[t]+m;h+=(e-p)*(e-p),f+=(e-n)*(e-n)}return{m:u,b:m,r2:h>0?1-f/h:1}}function a(t,e){let a=0,r=0,n=0,s=0,i=0,o=0,c=0,l=0,d=0;for(let u=0;u<t.length;u++){const m=+t[u],p=+e[u];if(Number.isFinite(m)&&Number.isFinite(p)){const t=m*m,e=t*m;a+=1,r+=m,n+=t,s+=e,i+=e*m,o+=p,c+=m*p,l+=t*p,d++}}if(d<3)return null;const u=function(t,e){let a=t.map((t=>t.slice())),r=e.slice();for(let t=0;t<3;t++){let e=t;for(let r=t+1;r<3;r++)Math.abs(a[r][t])>Math.abs(a[e][t])&&(e=r);[a[t],a[e]]=[a[e],a[t]],[r[t],r[e]]=[r[e],r[t]];const n=a[t][t];if(0===n)return null;for(let e=t;e<3;e++)a[t][e]/=n;r[t]/=n;for(let e=0;e<3;e++)if(e!==t){const n=a[e][t];for(let r=t;r<3;r++)a[e][r]-=n*a[t][r];r[e]-=n*r[t]}}return r}([[i,s,n],[s,n,r],[n,r,a]],[l,c,o]);if(!u)return null;const[m,p,h]=u;let f=o/a,g=0,y=0;for(let a=0;a<t.length;a++){const r=+t[a],n=+e[a];if(Number.isFinite(r)&&Number.isFinite(n)){const t=m*r*r+p*r+h;g+=(n-f)*(n-f),y+=(n-t)*(n-t)}}return{a:m,b:p,c:h,r2:g>0?1-y/g:1}}document.getElementById("applyfit").onclick=function(){const r=d3.select(this);if(r.classed("active"))return d3.select(".fit-brush").remove(),void r.classed("active",!1).style("background",null);const n=t.state.hot.getData(),s=n[0],i=n[1],o=n[2],c=n.slice(3),l=[];for(let e=0;e<s.length;e++)"Y-axis"===s[e]&&t.state.colEnabled[e]&&l.push(e);if(!l.length)return void alert("No enabled Y series.");const d=s.map(((e,a)=>"X-axis"===e&&t.state.colEnabled[a]?a:-1)).filter((t=>t>=0));if(!d.length)return void alert("Missing X-axis.");r.classed("active",!0).style("background","#c6c6c6");const u=d3.select("#chart svg");u.empty()||u.append("g").attr("class","fit-brush").style("cursor","crosshair").call(d3.brushX().extent([[t.config.DIM.ML,t.config.DIM.MT],[t.config.DIM.W-t.config.DIM.MR,t.config.DIM.H-t.config.DIM.MB]]).on("end",(({selection:n})=>{if(u.select(".fit-brush").remove(),r.classed("active",!1).style("background",null),!n)return;const[m,p]=n.map(t.state.lastXScale.invert),h=Math.min(m,p),f=Math.max(m,p),g=(document.querySelector('input[name="fit"]:checked')||{value:"linear"}).value,y=[];for(const r of l){let n=-1;for(let t=0;t<d.length;t++){const e=d[t],a=d[t+1]??s.length;if(r>e&&r<a){n=e;break}}if(n<0)continue;const l=o[r],u=[],m=[];if(c.forEach((t=>{const e=parseFloat(t[n]),a=parseFloat(t[r]);Number.isFinite(e)&&Number.isFinite(a)&&e>=h&&e<=f&&(u.push(e),m.push(a))})),!(u.length<2))if("linear"===g){const a=e(u,m);if(!a)continue;const r=c.map((t=>{const e=parseFloat(t[n]);return Number.isFinite(e)&&e>=h&&e<=f?(r=a.m,s=a.b,r*e+s):"";var r,s}));s.push("Y-axis"),i.push(t.config.COLORS[i.length%t.config.COLORS.length]),o.push(l+" (fit)"),c.forEach(((t,e)=>t.push(r[e]))),y.push(`${l}: m=${a.m.toFixed(6)}, b=${a.b.toFixed(6)}, R²=${a.r2.toFixed(5)}`)}else{if(u.length<3)continue;const e=a(u,m);if(!e)continue;const r=c.map((t=>{const a=parseFloat(t[n]);return Number.isFinite(a)&&a>=h&&a<=f?(r=e.a,s=e.b,i=e.c,r*(o=a)*o+s*o+i):"";var r,s,i,o}));s.push("Y-axis"),i.push(t.config.COLORS[i.length%t.config.COLORS.length]),o.push(l+" (fit)"),c.forEach(((t,e)=>t.push(r[e]))),y.push(`${l}: a=${e.a.toExponential(3)}, b=${e.b.toExponential(3)}, c=${e.c.toExponential(3)}, R²=${e.r2.toFixed(5)}`)}}t.state.hot.loadData([s,i,o,...c]);for(let e=0;e<s.length;e++)void 0===t.state.colEnabled[e]&&(t.state.colEnabled[e]=!0);t.state.hot.render(),t.axis.resetScales(!1),t.renderChart();const v=t.config.DIM.ML+6,x=t.config.DIM.MT+12,k=d3.select("#chart svg"),b=k.selectAll("foreignObject.user-text").size();y.forEach(((e,a)=>{const r=t.utils.editableText(k,{x:v,y:x+16*(b+a),text:e,rotation:0});r.div.text(e),r.fo.attr("width",r.div.node().scrollWidth+r.pad).attr("height",r.div.node().scrollHeight+r.pad),r.fo.classed("user-text",!0).call(t.utils.applyDrag)}))})))}}(window.GraphPlotter),function(t){"use strict";document.getElementById("generateTauc").addEventListener("click",(()=>{const e=parseFloat(document.querySelector('input[name="tauc"]:checked').value),a=t.state.hot.getData().map((t=>t.slice())),r=a[0],n=a[1],s=a[2],i=r.length,o=r.indexOf("X-axis"),c=r.indexOf("Y-axis",o+1);if(o<0||c<0)return alert("Missing X-axis or Y-axis");a.forEach((t=>t.splice(i))),r.splice(i),n.splice(i),s.splice(i);const l=[];for(let t=3;t<a.length;t++)l[t]=1240/parseFloat(a[t][o]);r.push("X-axis"),n.push(n[o]),s.push(s[o]),r.push("Y-axis"),n.push(n[c]),s.push(s[c]+` (Tauc n=${e})`);for(let t=3;t<a.length;t++)a[t].push(l[t],Math.pow(2.303*l[t]*parseFloat(a[t][c]),e));t.state.hot.loadData(a),t.state.colEnabled={};const d=r.length;for(let e=0;e<d;e++)t.state.colEnabled[e]=e>=i;document.getElementById("axis-tauc").checked=!0,t.state.hot.render(),t.axis.resetScales(!0),t.renderChart()}))}(window.GraphPlotter),function(){"use strict";const t={xrd:{paid:"product/xrd-data-matching-online/",msg:["Plotting XRD data? Get expert phase matching against verified reference databases.","XRD peaks plotted! Need accurate compound identification for your materials?","Beautiful XRD graph! Reviewers often ask for proper phase matching with reference cards.","Need more than a plot? Get professional phase identification and peak assignment.","XRD data ready! Our experts can match your peaks to thousands of known compounds."]},ftir:{paid:"product/ftir-data-matching-online/",msg:["FTIR spectrum looks great! Need automated compound identification?","Plotting FTIR? Get your peaks matched against 10,000+ reference materials.","Beautiful transmittance plot! Want to identify functional groups automatically?","FTIR graph ready! Our experts can match your peaks to known compounds.","Nice FTIR spectrum! Reviewers love seeing compound matches with similarity scores."]},xps:{paid:"product/xps-analysis-online/",msg:["Plotting XPS data? Get professional peak deconvolution and fitting.","XPS spectrum ready! Need atomic percentages and oxidation state analysis?","Great binding energy plot! Our experts can deconvolute overlapping peaks.","XPS graph looks good! Want publication-ready peak assignments?","Need more than a plot? Get full XPS analysis with chemical state identification."]},raman:{paid:"product/raman-crystallite-size-calculator/",msg:["Raman spectrum plotted! Need ID/IG ratio and crystallite size analysis?","Working with carbon materials? Get expert D and G band deconvolution.","Nice Raman plot! Reviewers often ask for proper peak fitting.","Raman data ready! Our experts can calculate defect density and crystallite size.","Beautiful Raman spectrum! Want Tuinstra-Koenig analysis for your publication?"]},uvvis:{paid:"product/band-gap-calculation-from-tauc-plot/",msg:["UV-Vis spectrum ready! Need accurate band gap from Tauc plot?","Plotting absorbance data? Get publication-ready Tauc plot analysis.","Nice UV-Vis spectrum! Reviewers expect proper band gap determination.","UV-Vis data plotted! Our experts can calculate direct/indirect band gaps.","Absorbance graph looks good! Want professional Tauc plot fitting?"]},tauc:{paid:"product/band-gap-calculation-from-tauc-plot/",msg:["Generating Tauc plot? Let our experts ensure accurate band gap values.","Tauc analysis started! Get professionally fitted linear region extraction.","Band gap calculation in progress! Reviewers appreciate expert Tauc analysis.","Need reviewer-ready band gap values? Our experts ensure proper fitting.","Tauc plot ready! Get verified band gap calculation for your publication."]},nmr:{paid:"product/nmr-data-analysis/",msg:["Plotting NMR spectrum? Get full structural elucidation from your data.","NMR data loaded! Need peak assignments and purity assessment?","Nice NMR plot! Our experts can provide complete spectral interpretation.","Chemical shifts visible! Want professional structure confirmation?","NMR spectrum ready! Get publication-quality peak assignments."]},pl:{paid:"product/custom-analysis/",msg:["Plotting PL data? Need quantum yield or peak fitting analysis?","Photoluminescence spectrum ready! Get expert emission peak analysis.","Nice PL plot! Our analysis team can extract valuable optical properties.","PL data loaded! Want professional peak deconvolution?","Beautiful emission spectrum! Get expert analysis for your publication."]},dsc:{paid:"product/dsc-percent-crystallinity-calculation-by-our-expert-team/",msg:["DSC thermogram plotted! Need accurate crystallinity calculation?","Plotting DSC data? Get professional enthalpy of fusion analysis.","DSC curve ready! Our experts can calculate percent crystallinity.","Nice thermal data! Reviewers expect proper baseline integration.","DSC plot looks good! Get publication-ready crystallinity values."]},tga:{paid:"product/custom-analysis/",msg:["Plotting TGA data? Need thermal stability analysis?","TGA curve ready! Our experts can analyze decomposition profiles.","Nice weight loss curve! Get detailed thermal analysis.","TGA data loaded! Want professional derivative thermogravimetric analysis?","Thermal data plotted! Get expert interpretation for your manuscript."]},bet:{paid:"product/bet-analsysis-online/",msg:["Plotting BET isotherm? Get surface area and pore analysis.","BET data loaded! Our experts calculate surface area and pore distribution.","Nice adsorption plot! Want complete BET analysis with pore shape?","BET curve ready! Get publication-ready surface area values.","Isotherm plotted! Need BJH pore size distribution analysis."]},saxs:{paid:"product/custom-analysis/",msg:["Plotting SAXS data? Need particle size distribution analysis?","SAXS pattern ready! Our experts can extract structural parameters.","Nice scattering plot! Want professional data fitting?"]},tensile:{paid:"product/custom-analysis/",msg:["Plotting stress-strain curve? Need mechanical property calculations?","Tensile data ready! Our experts can analyze modulus and yield strength."]},default:{paid:"product/scientific-graph-plotting/",msg:["Great graph! Need publication-quality formatting for journals?","Nice plot! Our experts create journal-ready 2D/3D scientific figures.","Data plotted! Want professionally formatted graphs for your paper?","Graph looks good! We also offer complete data analysis services.","Beautiful visualization! Need more analysis? Check our expert services."]}};function e(){const e=document.querySelector('input[name="axistitles"]:checked'),a=e?e.value:"default",r=t[a]||t.default,n=r.msg[Math.floor(Math.random()*r.msg.length)],s={axis:a,paid:r.paid,message:n,timestamp:Date.now()};sessionStorage.removeItem("instanano_graph_upsell_shown"),sessionStorage.setItem("instanano_graph_upsell",JSON.stringify(s))}document.addEventListener("click",(function(t){t.target&&("download"===t.target.id||t.target.closest("#download"))&&e(),t.target&&("save"===t.target.id||t.target.closest("#save"))&&e()}))}(window.GraphPlotter),function(t){"use strict";t.parsers.parseText=function(t){const e=String(t||"").trim().split(/\r?\n/).filter(Boolean).map((t=>{const e=t.trim();return e.includes(",")?e.split(",").map((t=>t.trim())):e.includes("\t")?e.split("\t").map((t=>t.trim())):e.split(/\s+/)}));return e.length?e:[[""]]},t.parsers.parseXLSX=function(t){const e=XLSX.read(new Uint8Array(t),{type:"array"});return XLSX.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{header:1})}}(window.GraphPlotter),function(t){"use strict";t.parsers.parseXRDASCII=function(e){const a=[];return String(e||"").split(/\r?\n/).forEach((t=>{const e=t.trim();if(!e||e.startsWith("#")||e.startsWith(";")||/^[_A-Za-z]+\s*=/.test(e))return;const r=e.match(/[-+]?(?:\d+\.?\d*|\.\d+)(?:[eE][-+]?\d+)?/g);if(!r||r.length<2)return;const n=Number(r[0]),s=Number(r[1]);Number.isFinite(n)&&Number.isFinite(s)&&a.push([n,s])})),a.length?a:t.parsers.parseText(e)};const e=[{id:"rigaku-ultima",parse:function(t){if(!(t instanceof ArrayBuffer)||t.byteLength<3162)return null;const e=new Uint8Array(t);if(70!==e[0]||73!==e[1]||!function(t,e){for(let a=0,r=t.length-e.length;a<=r;a++){let r=!0;for(let n=0;n<e.length;n++)if(t[a+n]!==e.charCodeAt(n)){r=!1;break}if(r)return!0}return!1}(e,"Ultima IV"))return null;const a=new DataView(t),r=a.getUint16(3154,!0);if(r<2||3158+4*r>t.byteLength)return null;const n=a.getFloat32(2962,!0),s=a.getFloat32(2966,!0),i=a.getFloat32(2970,!0),o=Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(i)&&i>0;if(o){const t=Math.round((s-n)/i)+1;if(Math.abs(t-r)>3)return null}const c=Number.isFinite(n)?n:0,l=o?i:Number.isFinite(n)&&Number.isFinite(s)?(s-n)/(r-1):1;if(!(Number.isFinite(l)&&l>0))return null;const d=new Array(r);for(let t=0;t<r;t++){const e=a.getFloat32(3158+4*t,!0);if(!Number.isFinite(e))return null;d[t]=[c+t*l,e]}return d}}];t.parsers.parseRAW=function(t){for(const a of e){const e=a.parse(t);if(e&&e.length)return e}return[]},t.parsers.parseXRDML=function(t){const e=(new DOMParser).parseFromString(t,"application/xml"),a=e.getElementsByTagName("scan")[0]||e.getElementsByTagNameNS("*","scan")[0];if(!a)return[];let r=a.getElementsByTagName("positions");if(!r.length){const t=a.getElementsByTagName("dataPoints")[0];r=t?t.getElementsByTagName("positions"):r}const n=Array.from(r).find((t=>(t.getAttribute("axis")||"").toLowerCase().includes("2theta")));if(!n)return[];const s=parseFloat((n.getElementsByTagName("startPosition")[0]||n.getElementsByTagNameNS("*","startPosition")[0]).textContent),i=parseFloat((n.getElementsByTagName("endPosition")[0]||n.getElementsByTagNameNS("*","endPosition")[0]).textContent);let o=a.getElementsByTagName("counts");if(!o.length&&(o=a.getElementsByTagName("intensities"),!o.length)){const t=a.getElementsByTagName("dataPoints")[0];o=t?t.getElementsByTagName("intensities"):o}if(!(o.length&&o[0]&&Number.isFinite(s)&&Number.isFinite(i)))return[];const c=o[0].textContent.trim().split(/\s+/).map(Number).filter(Number.isFinite),l=c.length;if(l<2)return[];const d=(i-s)/(l-1);return Array.from({length:l},((t,e)=>[s+d*e,c[e]]))}}(window.GraphPlotter),function(t){"use strict";t.parsers.parseNMR=async function(e){const a=t=>(t.webkitRelativePath||t.relativePath||t.name).replace(/\\/g,"/");if(!e||!e.length)return!1;const r=new Map(e.map((t=>[a(t),t]))),n=e.filter((t=>/\/fid$/i.test(a(t))));if(!n.length)return!1;const s=[];for(const t of n){const e=a(t).replace(/\/fid$/i,""),n=r.get(e+"/acqus")||r.get(e+"/ACQUS");if(!n)continue;const i=((await n.text()).match(/^\#\#\$(\w+)=([\s\S]*?)(?=\n\#\#|\s*$)/gm)||[]).reduce(((t,e)=>{const a=/^\#\#\$(\w+)=([\s\S]*)$/m.exec(e);if(!a)return t;const r=a[2].replace(/[()]/g," ").trim().split(/\s+/)[0];return t[a[1]]=isNaN(+r)?r:+r,t}),{}),o=+i.SFO1,c=+i.SW_h;if(!isFinite(o)||!isFinite(c))continue;const l=isFinite(+i.O1P)?+i.O1P:isFinite(+i.O1)?+i.O1/o:0,d=+i.BYTORDA||0,u=+i.DTYPA||0,m=+i.NC||0,p=Math.max(0,Math.round(+i.GRPDLY||0)),h=await t.arrayBuffer(),f=new DataView(h),g=0===d;let y,v=4;2===u?(v=2,y=t=>f.getInt16(2*t,g)):3===u?(v=4,y=t=>f.getFloat32(4*t,g)):5===u?(v=8,y=t=>f.getFloat64(8*t,g)):(v=4,y=t=>f.getInt32(4*t,g));const x=(h.byteLength/v|0)/2|0,k=Math.pow(2,m),b=new Float64Array(x),w=new Float64Array(x);for(let t=0;t<x;t++)b[t]=y(2*t)*k,w[t]=y(2*t+1)*k;const S=Math.min(p,x-1),T=b.subarray(S),M=w.subarray(S);let C=1;for(;C<T.length;)C<<=1;const E=new Float64Array(C),D=new Float64Array(C);E.set(T),D.set(M);for(let t=1,e=0;t<C;t++){let a=C>>1;for(;e&a;a>>=1)e^=a;e^=a,t<e&&([E[t],E[e]]=[E[e],E[t]],[D[t],D[e]]=[D[e],D[t]])}for(let t=2;t<=C;t<<=1){const e=-2*Math.PI/t,a=Math.cos(e),r=Math.sin(e);for(let e=0;e<C;e+=t){let n=1,s=0;for(let i=0;i<t/2;i++){const o=e+i,c=o+t/2,l=n*E[c]-s*D[c],d=n*D[c]+s*E[c];E[c]=E[o]-l,D[c]=D[o]-d,E[o]+=l,D[o]+=d;const u=n;n=u*a-s*r,s=u*r+s*a}}}const I=C>>1,A=new Float64Array(C);for(let t=0;t<C;t++)A[t]=Math.hypot(E[t],D[t]);const L=new Float64Array(C);L.set(A.subarray(I)),L.set(A.subarray(0,I),C-I);const R=c/C,B=-c/2,N=new Float64Array(C);for(let t=0;t<C;t++)N[t]=l+(B+t*R)/o;s.push({name:e.split("/").pop(),x:Array.from(N).reverse(),y:Array.from(L).reverse()})}if(!s.length)return!1;const i=2*s.length,o=Array.from({length:i},((t,e)=>e%2?"Y-axis":"X-axis")),c=Array.from({length:i},((e,a)=>t.config.COLORS[a%t.config.COLORS.length])),l=[];s.forEach((t=>{l.push("ppm"),l.push(t.name)}));const d=Math.max(...s.map((t=>t.x.length))),u=Array.from({length:d},((t,e)=>s.flatMap((t=>[t.x[e]??"",t.y[e]??""]))));return t.state.hot.loadData([o,c,l,...u]),document.getElementById("axis-nmr").checked=!0,t.axis.resetScales(!0),t.renderChart(),!0}}(window.GraphPlotter),function(t){"use strict";t.io=t.io||{};let e=!1;t.io.initFileLoader=function({detectModeFromData:a,openPanelForMode:r}={}){if(e)return;e=!0;const n={instanano:null,csv:t.parsers.parseText,txt:t.parsers.parseText,xls:t.parsers.parseXLSX,xlsx:t.parsers.parseXLSX,xrdml:t.parsers.parseXRDML,raw:t.parsers.parseRAW,xy:t.parsers.parseXRDASCII,xye:t.parsers.parseXRDASCII,asc:t.parsers.parseXRDASCII,dat:t.parsers.parseXRDASCII,uxd:t.parsers.parseXRDASCII},s={xrdml:"xrd",xy:"xrd",xye:"xrd",asc:"xrd",dat:"xrd",uxd:"xrd",raw:"xrd",spc:"uvvis"},i=document.getElementById("fileinput"),o=document.getElementById("dropzone");if(!i||!o)return;i.accept=Object.keys(n).map((t=>"."+t)).join(",");const c=t=>{if(!t)return;const e=document.querySelector(`input[name="axistitles"][value="${t}"]`);e&&(e.checked=!0),r?.(t)};async function l(e){const r=e&&e.items,i=r&&r.length?await(async()=>{const t=[],e=async(a,r="")=>{return a.isFile?await new Promise((e=>a.file((a=>{a.relativePath=r+a.name,t.push(a),e()})))):await Promise.all((await(n=a.createReader(),new Promise((t=>{const e=[];!function a(){n.readEntries((r=>{r.length?(e.push(...r),a()):t(e)}))}()})))).map((t=>e(t,r+a.name+"/"))));var n};for(const t of r){const a=t.webkitGetAsEntry&&t.webkitGetAsEntry();a&&await e(a)}return t})():[...e?.files||e||[]];if(!i.length)return;if(await t.parsers.parseNMR(i))return;const o=i[0],l=o.name.split(".").pop().toLowerCase();if("instanano"===l){const e=await o.text();try{t.importState(JSON.parse(e))}catch(t){alert("Invalid .instanano file")}return}const d=n[l];if(!d)return alert("Unsupported file type: ."+l);let u;if(s[l]&&c(s[l]),"xls"===l||"xlsx"===l||"raw"===l){u=d(await o.arrayBuffer())}else{u=d(await o.text())}const m=Math.max(...u.map((t=>t.length))),p=Array(m).fill().map(((t,e)=>0===e?"X-axis":"Y-axis")),h=Array(m).fill().map(((e,a)=>t.config.COLORS[a%t.config.COLORS.length])),f=Array(m).fill("Sample");t.state.hot.loadData([p,h,f,...u]),t.state.colEnabled={},t.state.hot.getData()[0].forEach(((e,a)=>{t.state.colEnabled[a]=!0})),t.state.hot.render(),c(a?.()),d3.select("#chart").selectAll("g.axis-title, g.legend-group, g.shape-group, defs, foreignObject.user-text").remove(),t.ui.disableAreaCal(),t.state.tickLabelStyles={x:{fontSize:null,color:null},y:{fontSize:null,color:null}},t.axis.resetScales(!0),t.renderChart()}["dragenter","dragover"].forEach((t=>o.addEventListener(t,(t=>{t.preventDefault(),o.classList.add("hover")})))),["dragleave","drop"].forEach((t=>o.addEventListener(t,(t=>{t.preventDefault(),o.classList.remove("hover")})))),o.addEventListener("drop",(async t=>{t.preventDefault(),o.classList.remove("hover"),await l(t.dataTransfer)})),i.addEventListener("change",(async()=>{await l(i.files)})),o.addEventListener("click",(()=>i.click()))}}(window.GraphPlotter),function(t){"use strict";const e="Please click any peak to add.",a="Please click any peak.",r=d3.select("#xrd-matchedData"),n=d3.select("#standard-matchedData"),s=document.getElementById("icon5"),i=document.getElementById("icon6"),o=document.getElementById("xrd-filter-section"),c=document.getElementById("xrd-elements"),l=document.getElementById("xrd-unlock-btn"),d=document.getElementById("xrd-unlock-section"),u=document.getElementById("xrd-credit-plans");function m(e,a){if(d&&(d.style.display=e?"":"none"),!e&&u&&(u.style.display="none"),!l)return;if(l.style.display=e?"":"none",!e)return;const r=a||t.matchXRD?.getSampleCount?.()||1;l.textContent=`Unlock Full XRD Match (${r} Credit${r>1?"s":""})`}function p(){return!!u&&(u.style.display="",u.scrollIntoView({behavior:"smooth",block:"start"}),!0)}function h(t,e){const a=t?.node();if(!a)return;const r=document.createElement("p");r.textContent=e,a.replaceChildren(r)}function f(e,a,r,n=[]){const s=e?.node();if(!s)return;if(s.replaceChildren(),!a.length&&!n.length){const t=document.createElement("p");return t.textContent="No matching peaks found.",void s.appendChild(t)}const i=document.createDocumentFragment(),o=n.length?"limited":"";a.map((t=>[t,o])).concat(n.map((t=>[t,"locked"]))).forEach((([e,a])=>{const n=e.row||e,s=document.createElement("div");if(s.className="matchedrow",a&&(s.dataset.tag=a),e.refId&&(s.dataset.refid=e.refId),"locked"!==a){const t=e.fullData?.data,a=t?.Peaks?t.Peaks.map((t=>t.T)):e.peaks,r=t?.Peaks?t.Peaks.map((t=>t.I)):e.intensities;a&&(s.dataset.peaks=JSON.stringify(a)),r&&(s.dataset.ints=JSON.stringify(r)),t&&(s.dataset.fulldata=JSON.stringify(t))}if("locked"!==a&&e.refId){const a=document.createElement("div"),r=document.createElement("input");r.type="checkbox",r.className="xrd-ref-toggle",r.dataset.refid=e.refId,r.checked=!!t.matchXRD?.isReferenceSelected?.(e.refId),a.append(r,document.createTextNode(" Add to graph")),s.appendChild(a)}if(n.forEach(((t,e)=>{const a=document.createElement("div"),n=document.createElement("b");n.textContent=`${r[e]}:`,a.append(n,document.createTextNode(` ${t}`)),s.appendChild(a)})),"locked"!==a&&e.fullData?.mineral){const t=document.createElement("div");t.className="xrd-row-mineral",t.textContent=`Mineral: ${e.fullData.mineral}`,s.appendChild(t)}i.appendChild(s)})),s.appendChild(i)}function g(t,e){if(!t)return e;try{return JSON.parse(t)}catch(t){return e}}async function y(e){let a=g(e.dataset.peaks,[]),r=g(e.dataset.ints,[]),n=g(e.dataset.fulldata,null);if(!n&&!t.matchXRD.isLocked()&&e.dataset.refid)try{const a=await t.matchXRD.fetchRef(e.dataset.refid);a?.data&&(n=a.data,e.dataset.fulldata=JSON.stringify(n))}catch(t){}return n?.Peaks?.length&&(a=n.Peaks.map((t=>t.T)),r=n.Peaks.map((t=>t.I)),e.dataset.peaks=JSON.stringify(a),e.dataset.ints=JSON.stringify(r)),{peaks:a,ints:r,fulldata:n}}document.querySelectorAll('input[name="matchinstrument"]').forEach((t=>t.addEventListener("change",(()=>h(n,a))))),["icon1","icon2","icon3","icon4"].forEach((e=>document.getElementById(e)?.addEventListener("change",(()=>{t.matchXRD?.render()})))),s?.addEventListener("change",(async()=>{s.checked&&(await(t.matchXRD?.verifyImportedLockIfNeeded?.()),t.matchXRD?.hasResultsOnPanel?.()||h(r,e),t.matchXRD?.render())})),i?.addEventListener("change",(()=>{t.matchXRD?.render(),h(n,a)})),["click","mousedown","pointerdown","focusin","input","keydown","keyup"].forEach((e=>o?.addEventListener(e,(e=>{e.stopPropagation(),setTimeout((()=>t.matchXRD?.render()),10)})))),c?.addEventListener("input",(()=>{if(!t.matchXRD)return;const e=t.matchXRD.validate(c.value);c.style.outline=e.valid?"":"2px solid red",c.title=e.valid?"":"Invalid: "+e.invalid.join(", ")})),d3.select("#chart").on("click.match",(async function(e){if(!s?.checked&&!i?.checked)return;const a=d3.select("#chart svg").node(),[r,o]=d3.pointer(e,a);if(r<t.config.DIM.ML||r>t.config.DIM.W-t.config.DIM.MR||o<t.config.DIM.MT||o>t.config.DIM.H-t.config.DIM.MB)return;const c=t.state.lastXScale.invert(r);if(s.checked){let e=t.state.lastYScale.invert(o);e<0&&(e=0),t.matchXRD.addPeak(c,e)}else{const e=document.querySelector('input[name="matchinstrument"]:checked')?.id;if(!e||!t.matchStandard?.isStandard(e))return;const{matches:a,cols:r}=await t.matchStandard.search(e,c);f(n,a,r)}})),document.getElementById("xrd-search-btn")?.addEventListener("click",(async function(){const e=c,a=document.getElementById("xrd-logic-mode"),n=document.getElementById("xrd-element-count");if(!t.matchXRD)return;const s=e?.value||"",i=t.matchXRD.validate(s);if(!i.valid)return e.style.outline="2px solid red",void(e.title="Invalid: "+i.invalid.join(", "));t.matchXRD.setFilter(s.split(",").filter((t=>t.trim())),a?.value,parseInt(n?.value)||0),m(!1);const o=await t.matchXRD.search();f(r,o.matches,o.cols,o.lockedMatches||[]),(o.matches.length||(o.lockedMatches||[]).length)&&o.locked&&m(!0,t.matchXRD.getSampleCount())})),l?.addEventListener("click",(async function(){if("undefined"!=typeof instananoCredits){l.style.pointerEvents="none";try{const e=await t.matchXRD.unlock();if(!e.ok)return e.message&&alert(e.message),void("no_account"!==e.code&&"no_credits"!==e.code||p());m(!1),f(r,e.matches,["Reference ID","Empirical Formula","Match Score (%)"]),r.node()?.querySelectorAll("input.xrd-ref-toggle:checked").forEach((t=>{t.click(),t.click()}))}finally{l.style.pointerEvents=""}}else p()})),document.getElementById("xrd-clear-peaks")?.addEventListener("click",(function(){t.matchXRD?.clear(),m(!1),h(r,e)})),r.on("click",(async function(e){const a=e.target.closest("input.xrd-ref-toggle");if(a){const e=a.closest(".matchedrow");if(!e||"locked"===e.dataset.tag||!e.dataset.refid)return;const{peaks:r,ints:n}=await y(e);return!a.checked||Array.isArray(r)&&r.length?void t.matchXRD?.setReference?.(e.dataset.refid,r,n,a.checked):void(a.checked=!1)}const n=e.target.closest(".matchedrow");if(!n)return;if("locked"===n.dataset.tag)return;const s=r.node();if(n.classList.contains("xrd-preview-active")){n.classList.remove("xrd-preview-active"),n.style.background="";const e=n.querySelector(".xrd-ref-detail");e&&e.remove();try{t.matchXRD.showRef([],[],"")}catch(t){}return}s?.querySelectorAll(".matchedrow").forEach((t=>{if(t!==n){t.classList.remove("xrd-preview-active"),t.style.background="";const e=t.querySelector(".xrd-ref-detail");e&&e.remove()}})),n.classList.add("xrd-preview-active"),n.style.background="#f0f8ff";const{peaks:i,ints:o,fulldata:c}=await y(n);if(!n.classList.contains("xrd-preview-active"))return;try{t.matchXRD.showRef(i,o,n.dataset.refid||"")}catch(t){}if(!c)return;let l=n.querySelector(".xrd-ref-detail");if(l)l.remove();else try{l=document.createElement("div"),l.className="xrd-ref-detail",l.style.cssText="font-size:11px;color:#444;margin-top:6px;border-top:1px solid #eee;padding-top:4px;max-height:200px;overflow-y:auto;line-height:1.5";const e=t.utils?.escapeHTML||(t=>String(null==t?"":t)),a=[],r=c;r.CS&&a.push(`<b>Crystal:</b> ${e(r.CS)}`),r.SG&&a.push(`<b>SG:</b> ${e(r.SG)}`),r.A&&a.push(`<b>a=</b>${e(r.A)}`),r.B&&a.push(`<b>b=</b>${e(r.B)}`),r.C&&a.push(`<b>c=</b>${e(r.C)}`),r.Al&&a.push(`<b>α=</b>${e(r.Al)}°`),r.Be&&a.push(`<b>β=</b>${e(r.Be)}°`),r.Ga&&a.push(`<b>γ=</b>${e(r.Ga)}°`),r.MW&&a.push(`<b>MW:</b> ${e(r.MW)}`);let s='<div style="word-break:break-word">'+a.join(" | ")+"</div>";r.Peaks?.length&&(s+='<table style="width:100%;border-collapse:collapse;margin-top:4px;font-size:10px;text-align:center"><tr style="background:#f5f5f5;font-weight:600"><td>2θ</td><td>d(Å)</td><td>I</td><td>hkl</td></tr>',r.Peaks.forEach((t=>{s+=`<tr style="border-bottom:1px solid #f0f0f0"><td>${e(t.T)}</td><td>${e(t.D)}</td><td>${e(t.I)}</td><td>(${e(t.H)},${e(t.K)},${e(t.L)})</td></tr>`})),s+="</table>"),l.innerHTML=s,n.appendChild(l)}catch(t){}})),m(!1),h(r,e),h(n,a)}(window.GraphPlotter),function(t){"use strict";const e={},a={ftirmatch:{buf:{range:20,single:50},cols:["Peak Position","Group","Class","Intensity"]},xpsmatch:{buf:{range:1,single:.5},cols:["Peak Position","Group","Material","Notes"]},ramanmatch:{buf:{range:10,single:30},cols:["Raman Shift (cm⁻¹)","Material","Mode","Notes"]},uvvismatch:{buf:{range:20,single:40},cols:["λmax (nm)","Material","Characteristic","Description"]},hnmrmatch:{buf:{range:.2,single:.5},cols:["Chemical Shift (ppm)","Type","Assignment","Description"]},cnmrmatch:{buf:{range:10,single:20},cols:["Chemical Shift (ppm)","Type","Assignment","Description"]}};t.matchStandard={isStandard:t=>!!a[t],search:async(t,r)=>{let n;try{n=await async function(t){if(e[t])return e[t];const a=t.replace("match",""),r=await fetch(`https://cdn.jsdelivr.net/gh/instanano/graph-data@latest/ref/${a}/match.json`);if(!r.ok)throw new Error(`Failed to load ${t} match data`);const n=await r.json();return e[t]=Array.isArray(n)?n:[],e[t]}(t)}catch(e){return{matches:[],cols:a[t]?.cols||[]}}const{buf:s,cols:i}=a[t];return{matches:n.filter((t=>{const e=t[0].split("-").map(Number);return e.length>1?r>=e[0]-s.range&&r<=e[1]+s.range:Math.abs(r-e[0])<=s.single})).map((t=>({row:t}))),cols:i}}}}(window.GraphPlotter),function(t){"use strict";const e="https://cdn.jsdelivr.net/gh/instanano/graph-data@latest/ref/xrd/";let a=[],r=null,n=null,s=null,i={elements:[],mode:"and",count:0};const o=new Map,c=new Map,l=new Map,d=new Map,u={H:1,He:2,Li:3,Be:4,B:5,C:6,N:7,O:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,S:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Nh:113,Fl:114,Mc:115,Lv:116,Ts:117,Og:118},m=t=>{const e=document.getElementById("xrd-search-btn");e&&("done"===t?e.classList.add("progress-done"):(e.classList.contains("progress-done")&&(e.classList.add("no-anim"),e.offsetHeight),e.classList.remove("progress-done","no-anim"),e.style.setProperty("--progress",t+"%")))},p=t=>{const e=document.getElementById("xrd-matchedData");if(!e)return;const a=document.createElement("p");a.textContent=t,e.replaceChildren(a)};async function h(t,e,a){if(!t.length)return[];const r=new Array(t.length);let n=0;return await Promise.all(Array.from({length:Math.min(e,t.length)},(async function(){for(;n<t.length;){const e=n++;r[e]=await a(t[e],e)}}))),r}async function f(t,e){if(t.has(e))return t.get(e);const a=fetch(e).then((t=>t.ok?t.json():null)).catch((()=>null)).then((a=>(null==a&&t.delete(e),a)));return t.set(e,a),a}const g=t=>{if(!s)return!0;const e=s[t];if(!e)return!0;const{elements:a,mode:r,count:n}=i;if(n>0&&e.length!==n)return!1;if(!a.length)return!0;const o=new Set(e);if("and"===r){for(const t of a)if(!o.has(t))return!1;return!0}if("or"===r){for(const t of a)if(o.has(t))return!0;return!1}if("only"===r){if(e.length!==a.length)return!1;for(const t of a)if(!o.has(t))return!1;return!0}return!0},y=t=>{if(!t.length)return;const e=t.map((t=>Number(t.intensity)||0)).filter((t=>t>0)).sort(((t,e)=>e-t));if(!e.length)return t.forEach((t=>t.normInt=0));const a=e[Math.min(2,e.length-1)]||e[0];t.forEach((t=>t.normInt=a>0?Math.max(0,Math.min(100,(Number(t.intensity)||0)/a*100)):0))},v=t=>Math.max(.25,Math.min(.5,.18+.0065*(Number(t)||0)));function x(e){return{table:t.state.hot?.getData?.()||[],col:t.state.colEnabled||{},peaks:(Array.isArray(e)?e:[]).map((t=>({x:t.x,intensity:t.intensity})))}}function k(){t.matchXRD.lockActive=!1,t.matchXRD.lockedPeaks=[],t.matchXRD.lockInfo=null}async function b(t,e={}){if("undefined"==typeof instananoCredits)return null;const a=new FormData;a.append("action",t),a.append("nonce",instananoCredits.nonce);for(const[t,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>a.append(t+"[]",e))):a.append(t,r);return(await fetch(instananoCredits.ajaxUrl,{method:"POST",body:a})).json()}function w(){const e=(t.config.COLORS||[]).slice(1);if(!e.length)return"#0000FF";const a=new Set(Array.from(o.values()).map((t=>t.color)));for(const t of e)if(!a.has(t))return t;return e[o.size%e.length]}function S(t,e){document.querySelectorAll("#xrd-matchedData input.xrd-ref-toggle").forEach((a=>{a.dataset.refid===String(t)&&(a.checked=!!e)}))}function T(e){return`translate(${t.config.DIM.W-t.config.DIM.MR-100},${t.config.DIM.MT+25+20*(function(){const e=t.state.hot?.getData?.();return e?.[0]?e[0].filter(((e,a)=>"Y-axis"===e&&!1!==t.state.colEnabled[a])).length:0}()+e)})`}function M(t,e){t.selectAll(".legend-marker").remove(),t.append("line").classed("legend-marker",!0).attr("x2",20).attr("stroke",e).attr("stroke-width",1.5).attr("stroke-dasharray","4,2")}function C(e,a,r,n,s,i="4,2",o=1){const c=t.config.DIM.ML,l=t.config.DIM.W-t.config.DIM.MR;for(let d=0;d<a.length;d++){const u=t.state.lastXScale(a[d]);if(u<c||u>l)continue;const m=5+(r?.[d]??100)/100*35;e.append("line").attr("class",n).attr("x1",u).attr("x2",u).attr("y1",t.config.DIM.H-t.config.DIM.MB).attr("y2",t.config.DIM.H-t.config.DIM.MB-m).attr("stroke",s).attr("stroke-width",o).attr("stroke-dasharray",i).style("pointer-events","none")}}t.matchXRD={lockActive:!1,lockInfo:null,lockedPeaks:[],invalidateLock:()=>{n=null,k(),t.matchXRD.render()},setImportedLockCandidate:t=>{if(n=null,!(t&&t.lock_hash&&t.signature&&t.account_id&&Array.isArray(t.peaks)&&t.peaks.length))return!1;const e=t.peaks.map((t=>({x:Number(t.x),intensity:Number(t.intensity??0),normInt:0})));return y(e),n={lock_hash:String(t.lock_hash||""),signature:String(t.signature||""),lock_version:t.lock_version??null,account_id:Number(t.account_id||0),peaks:e},!0},verifyImportedLockIfNeeded:async()=>{const e=n;if(!e||"undefined"==typeof instananoCredits)return!1;n=null;const a=await b("instanano_verify_lock",{lock_hash:e.lock_hash,signature:e.signature,lock_version:e.lock_version,account_id:e.account_id,lock_payload:JSON.stringify(x(e.peaks))});return a?.success&&a?.data?.valid?(t.matchXRD.lockActive=!0,t.matchXRD.lockedPeaks=e.peaks.map((t=>({x:t.x,intensity:t.intensity,normInt:t.normInt}))),t.matchXRD.lockInfo={lock_hash:e.lock_hash,signature:e.signature,lock_version:e.lock_version,account_id:Number(a.data.account_id||e.account_id||0),fetch_token:a.data.fetch_token||"",fetch_token_expires:Number(a.data.fetch_token_expires||0),formula_map:a.data.formula_map&&"object"==typeof a.data.formula_map?a.data.formula_map:{},verified:!0},t.matchXRD.render(),!0):(k(),t.matchXRD.render(),!1)},addPeak:(e,r)=>{t.matchXRD.lockActive||(a.push({x:e,intensity:r,normInt:0}),y(a),t.matchXRD.render())},render:()=>{const e=d3.select("#chart svg");if(e.empty()||!t.state.lastXScale)return;const n=document.getElementById("icon5"),s=!n||!!n.checked;if(e.selectAll(".xrd-ref-peak,.xrd-ref-preview-peak").remove(),o.forEach((t=>C(e,t.peaks,t.intensities,"xrd-ref-peak",t.color))),s&&r?.peaks?.length&&!o.has(r.refId)&&C(e,r.peaks,r.intensities,"xrd-ref-preview-peak","#1f77b4","4,2",1),function(e){const a=Array.from(o.values()),r=e.selectAll("g.xrd-ref-legend").data(a,(t=>t.refId));r.exit().remove(),r.attr("data-refid",(t=>t.refId)).attr("transform",(function(t,e){return this.dataset.savedTransform||T(e)})),r.enter().append("g").classed("legend-group",1).classed("xrd-ref-legend",1).attr("data-refid",(t=>t.refId)).attr("transform",((t,e)=>T(e))).call(t.utils.applyDrag).each((function(e){const a=d3.select(this);M(a,e.color);const r=t.utils.editableText(a,{x:25,y:-10,text:e.label||e.refId});r.fo.attr("width",r.div.node().scrollWidth+r.pad);const n=r.div.node();n.addEventListener("click",(t=>{t.stopPropagation(),n.focus()})),n.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),n.blur())})),n.addEventListener("blur",(()=>{const t=o.get(e.refId);if(!t)return;const a=n.textContent.trim()||e.refId;t.label=a,n.textContent=a,d3.select(n).attr("contenteditable",!1).style("outline","none").style("cursor","move")}))})),r.select("foreignObject div").text((t=>t.label||t.refId)),r.each((function(t){M(d3.select(this),t.color)}))}(e),e.selectAll(".xrd-user-peak").remove(),!s)return;const i=t.matchXRD.lockActive?t.matchXRD.lockedPeaks:a,c=t.config.DIM.ML,l=t.config.DIM.W-t.config.DIM.MR;i.forEach(((r,n)=>{const s=t.state.lastXScale(r.x);if(s<c||s>l)return;const i=e.insert("line",".xrd-ref-peak,.xrd-ref-preview-peak").attr("class","xrd-user-peak").attr("x1",s).attr("x2",s).attr("y1",t.config.DIM.H-t.config.DIM.MB).attr("y2",t.config.DIM.H-t.config.DIM.MB-7).attr("stroke","red").attr("stroke-width",3);t.matchXRD.lockActive?i.style("cursor","default"):i.style("cursor","pointer").on("click",(e=>{e.stopPropagation(),a.splice(n,1),y(a),t.matchXRD.render()}))}))},showRef:(e,a,n="")=>{r={refId:String(n||""),peaks:Array.isArray(e)?e.slice():[],intensities:Array.isArray(a)?a.slice():[]},t.matchXRD.render()},setReference:(e,a,r,n=!0)=>{const s=String(e||"").trim();if(!s)return!1;if(!n)return t.matchXRD.removeReference(s),!1;const i=o.get(s);return i?(Array.isArray(a)&&a.length&&(i.peaks=a.slice()),Array.isArray(r)&&(i.intensities=r.slice()),S(s,!0),t.matchXRD.render(),!0):(o.set(s,{refId:s,peaks:Array.isArray(a)?a.slice():[],intensities:Array.isArray(r)?r.slice():[],color:w(),label:s}),S(s,!0),t.matchXRD.render(),!0)},removeReference:e=>{const a=String(e||"").trim();if(!a)return!1;const n=o.delete(a);return r?.refId===a&&(r=null),S(a,!1),t.matchXRD.render(),n},isReferenceSelected:t=>o.has(String(t||"").trim()),hasResultsOnPanel:()=>{const t=document.getElementById("xrd-matchedData");return!!t&&t.childElementCount>0},clear:()=>{n=null,a=[],r=null,o.clear(),d3.selectAll(".xrd-user-peak,.xrd-ref-peak,.xrd-ref-preview-peak,g.xrd-ref-legend").remove(),document.querySelectorAll("#xrd-matchedData input.xrd-ref-toggle").forEach((t=>{t.checked=!1})),t.matchXRD.lockActive&&t.matchXRD.render()},validate:t=>{if(!t.trim())return{valid:!0,invalid:[]};const e=t.split(",").map((t=>t.trim())).filter((t=>t)).filter((t=>!u[t]));return{valid:0===e.length,invalid:e}},setFilter:(t,e,a)=>{const r=[];for(const e of t){const t=e.trim();u[t]&&r.push(u[t])}i={elements:r,mode:e||"and",count:a||0}},clearFilter:()=>{i={elements:[],mode:"and",count:0}},search:async()=>{const r=t.matchXRD.lockActive?t.matchXRD.lockedPeaks:a;if(!r.length)return{matches:[],cols:[]};if(y(r),m(0),p("Searching and matching from ~1 million references..."),!s&&(s=await f(c,`${e}info/compositions.json`),!s))return m(0),p("Error loading."),{matches:[],cols:[]};m(10);const n=new Map,i=new Set;for(const t of r)i.add(Math.floor(t.x/.5));const o=[...i];let u=0;const x=await h(o,8,(async t=>{const a=await f(l,`${e}search/${t}.json`);return u++,m(10+u/Math.max(1,o.length)*40),a})),k={};o.forEach(((t,e)=>{x[e]&&(k[t]=x[e])}));for(const t of r){const e=Math.floor(t.x/.5),a=k[e];if(a)for(let r=0;r<a.d.length;r++){const s=a.d[r],i=a.c[r];if(!g(i))continue;const o=s>>8,c=.5*e+(255&s)/100,l=Math.abs(t.x-c);l<=v(.5*(t.x+c))&&(n.has(o)||n.set(o,[]),n.get(o).push({rp:c,diff:l,userInt:t.normInt}))}}const w=[...n.entries()].sort(((t,e)=>e[1].length-t[1].length)).slice(0,25);if(!w.length)return m(0),{matches:[],cols:[]};const S={},T=[...new Set(w.map((([t])=>Math.floor(t/1e3))))];let M=0;await h(T,8,(async t=>{S[t]=await f(d,`${e}records/${t}.json`),M++,m(50+M/Math.max(1,T.length)*40)})),m(95);const C=[];for(const[t]of w){const e=S[Math.floor(t/1e3)],a=e?.[t%1e3];if(!a)continue;const n=a[2].map((t=>t/100)),s=a[3]||[],i=n.length;let o=0,c=0,l=0,d=0;const u=new Set;for(let t=0;t<i;t++){const e=n[t],a=s[t]||50;let i=null,m=-1;for(let t=0;t<r.length;t++){if(u.has(t))continue;const a=Math.abs(r[t].x-e),n=v(.5*(r[t].x+e));a<=n&&(!i||a/n<i.diff/i.tol)&&(i={diff:a,tol:n,userInt:r[t].normInt},m=t)}i&&m>=0?(u.add(m),l++,d+=3.5,o+=i.diff/i.tol*8,c+=Math.abs(i.userInt-a)/100*2):(o+=6,c+=1)}const m=l?Math.max(0,Math.min(100,(100-o-c+d)/(100+3.5*i)*100)):0;C.push({row:[a[0],a[1],m.toFixed(1)],refId:a[0],peaks:n,intensities:s,score:m})}C.sort(((t,e)=>e.score-t.score)),m("done");if(!t.matchXRD.lockActive){return{matches:C.slice(0,3).map((t=>({...t,peaks:t.peaks.slice(0,3),intensities:t.intensities.slice(0,3)}))),lockedMatches:C.slice(3).map((({row:t,refId:e})=>({row:t,refId:e}))),cols:["Reference ID","Empirical Formula","Match Score (%)"],locked:!0}}const E=t.matchXRD.lockInfo;if(E){const t=E.formula_map&&"object"==typeof E.formula_map?E.formula_map:{};E.formula_map=t;const e=C.map((t=>String(t.refId||""))).filter((e=>e&&!t[e])).slice(0,25);if(e.length&&E.signature&&E.lock_hash&&E.account_id){const a=await b("instanano_verify_lock",{lock_hash:E.lock_hash,signature:E.signature,lock_version:E.lock_version,account_id:E.account_id,ref_ids:e});a?.success&&a?.data?.valid&&(E.fetch_token=a.data.fetch_token||E.fetch_token,E.fetch_token_expires=Number(a.data.fetch_token_expires||E.fetch_token_expires||0),a.data.formula_map&&"object"==typeof a.data.formula_map&&Object.assign(t,a.data.formula_map))}C.forEach((e=>{const a=String(e.refId||"");a&&t[a]&&Array.isArray(e.row)&&e.row.length>1&&(e.row[1]=t[a])}))}return{matches:C,cols:["Reference ID","Empirical Formula","Match Score (%)"],locked:!1}},getSampleCount:function(){return t.state.hot.getData()[0].filter(((e,a)=>"Y-axis"===e&&!1!==t.state.colEnabled[a])).length||1},unlock:async()=>{if(!a.length)return{ok:!1,message:"No peaks selected."};n=null;const e=Array.from(document.querySelectorAll("#xrd-matchedData .matchedrow[data-refid]")).map((t=>String(t.dataset.refid||"").trim())).filter(Boolean).slice(0,25),r=await b("instanano_use_credit",{lock_payload:JSON.stringify(x(a)),ref_ids:e});if(!r?.success||!r?.data?.signature||!r?.data?.lock_hash)return{ok:!1,message:r?.data?.message||"Failed.",code:r?.data?.code||""};const s=Number(r.data.account_id||0),i=String(r.data.lock_hash||"");t.matchXRD.lockActive=!0,t.matchXRD.lockedPeaks=a.map((t=>({x:t.x,intensity:t.intensity,normInt:t.normInt}))),t.matchXRD.lockInfo={lock_hash:i,signature:r.data.signature,lock_version:Number(r.data.lock_version||1),account_id:s,fetch_token:r.data.fetch_token||"",fetch_token_expires:Number(r.data.fetch_token_expires||0),formula_map:r.data.formula_map&&"object"==typeof r.data.formula_map?r.data.formula_map:{},verified:!0};return{ok:!0,matches:(await t.matchXRD.search()).matches||[]}},refreshFetchToken:async()=>{const e=t.matchXRD.lockInfo;if(!(t.matchXRD.lockActive&&e?.signature&&e?.lock_hash&&e?.account_id))return!1;const a=await b("instanano_verify_lock",{lock_hash:e.lock_hash,signature:e.signature,lock_version:e.lock_version,account_id:e.account_id});return!!(a?.success&&a?.data?.valid&&a?.data?.fetch_token)&&(e.fetch_token=a.data.fetch_token,e.fetch_token_expires=Number(a.data.fetch_token_expires||0),!0)},fetchRef:async e=>{const a=t.matchXRD.lockInfo;if(!t.matchXRD.lockActive||!a?.signature||!a?.account_id)return null;const r=Math.floor(Date.now()/1e3);if(!a.fetch_token||!a.fetch_token_expires||r>=a.fetch_token_expires-5){if(!await t.matchXRD.refreshFetchToken())return null}let n=await b("instanano_xrd_fetch_refs",{ref_ids:[e],lock_hash:a.lock_hash,fetch_token:a.fetch_token,account_id:a.account_id});if(!n?.success&&"fetch_token_expired"===n?.data?.code){if(!await t.matchXRD.refreshFetchToken())return null;n=await b("instanano_xrd_fetch_refs",{ref_ids:[e],lock_hash:a.lock_hash,fetch_token:a.fetch_token,account_id:a.account_id})}return n?.success?n.data[e]:null},isLocked:()=>!t.matchXRD.lockActive}}(window.GraphPlotter),function(t){"use strict";async function e(t,e){return new Promise((a=>{$("#html-prompt-message").text(t),$("#html-prompt-input").val(e),$("#popup-prompt-overlay").css("display","flex").fadeIn(150),$("#html-prompt-input").focus().off("keydown").on("keydown",(t=>{"Enter"===t.key&&$("#html-prompt-ok").click()})),$("#html-prompt-ok").off("click").on("click",(()=>{$("#popup-prompt-overlay").fadeOut(150),a($("#html-prompt-input").val())})),$("#html-prompt-cancel").off("click").on("click",(()=>{$("#popup-prompt-overlay").fadeOut(150),a(null)}))}))}function a(t){if("string"!=typeof t)return"";if(t.length>2e6)return"";const e=document.createElement("template");e.innerHTML=t;const a=new Set(["SCRIPT","IFRAME","OBJECT","EMBED","META","LINK","STYLE"]),r=document.createTreeWalker(e.content,NodeFilter.SHOW_ELEMENT),n=[];let s=r.nextNode();for(;s;)a.has(s.tagName)?(n.push(s),s=r.nextNode()):(Array.from(s.attributes).forEach((t=>{const e=t.name.toLowerCase(),a=String(t.value||"").toLowerCase();(e.startsWith("on")||a.includes("javascript:"))&&s.removeAttribute(t.name)})),s=r.nextNode());return n.forEach((t=>t.remove())),e.innerHTML}$("#download").click((async function(t){if(t.preventDefault(),!myUserVars.isLoggedIn)return t.stopPropagation(),void $("#ajax-login-modal").show();$("#transparent-option").show();const a=await e("Enter DPI  (e.g. 150, 300, or 600 etc.)","600");if(null===a)return;const r=parseFloat(a);if(isNaN(r)||r<=0)return alert("Invalid DPI");const n=document.getElementById("html-prompt-transparent").checked,s=r/96,i=document.querySelector("#chart svg");if(!i)return;const o=i.cloneNode(!0);o.querySelectorAll(".xrd-user-peak").forEach((t=>t.remove())),o.querySelectorAll("foreignObject div[contenteditable]").forEach((t=>t.style.border="none")),o.querySelectorAll(".outline[visibility='visible']").forEach((t=>t.setAttribute("visibility","hidden"))),o.querySelectorAll("text[contenteditable='true']").forEach((t=>{t.removeAttribute("contenteditable"),t.style.outline="none"})),o.setAttribute("style",`background:${n?"transparent":"#fff"};font-family:Arial,sans-serif;`);const c="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(o)),l=new Image;l.onload=()=>{const t=document.createElement("canvas");t.width=l.width*s,t.height=l.height*s;const e=t.getContext("2d");n||(e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height)),e.drawImage(l,0,0,t.width,t.height),t.toBlob((t=>{if(!t)return;const e=document.createElement("a"),a=URL.createObjectURL(t);e.href=a,e.download=`chart@${r}dpi${n?"_transparent":""}.png`,e.click(),setTimeout((()=>URL.revokeObjectURL(a)),1e3)}),"image/png")},l.src=c})),$("#save").click((async function(r){if(r.preventDefault(),!myUserVars.isLoggedIn)return r.stopPropagation(),void $("#ajax-login-modal").show();$("#transparent-option").hide(),t.utils.clearActive();const n=new Date,s=t=>("0"+t).slice(-2),i=[s(n.getDate()),s(n.getMonth()+1),n.getFullYear()].join("-")+"_"+[s(n.getHours()),s(n.getMinutes()),s(n.getSeconds())].join("-"),o=d3.select("#chart").html(),c=document.createElement("template");c.innerHTML=o,c.content.querySelectorAll(".xrd-user-peak,.xrd-ref-peak,.xrd-ref-preview-peak,g.xrd-ref-legend").forEach((t=>t.remove()));const l=a(c.innerHTML),d={v:"v1.0",ts:i,table:t.state.hot.getData(),settings:t.getSettings(),col:t.state.colEnabled,html:l,overrideX:t.state.overrideX||null,overrideMultiY:t.state.overrideMultiY||{},overrideXTicks:t.state.overrideXTicks||null,overrideYTicks:t.state.overrideYTicks||{},overrideTernaryTicks:t.state.overrideTernaryTicks||{},overrideScaleformatX:t.state.overrideScaleformatX||null,overrideScaleformatY:t.state.overrideScaleformatY||{},overrideCustomTicksX:t.state.overrideCustomTicksX||null,overrideCustomTicksY:t.state.overrideCustomTicksY||{},overrideCustomTicksTernary:t.state.overrideCustomTicksTernary||{},overrideTernary:t.state.overrideTernary||{},minorTickOn:t.state.minorTickOn||{},useCustomTicksOn:t.state.useCustomTicksOn||{}},u=t.matchXRD?.lockInfo,m=t.matchXRD?.lockedPeaks;u?.verified&&Array.isArray(m)&&m.length&&(d.xrd_lock_version=u.lock_version??null,d.xrd_account_id=Number(u.account_id||0),d.xrd_lock_hash=u.lock_hash||"",d.xrd_signature=u.signature||"",d.xrd_peaks=m.map((t=>({x:t.x,intensity:t.intensity}))));const p=URL.createObjectURL(new Blob([JSON.stringify(d)])),h=document.createElement("a"),f=await e("Enter file name",`Project_${i}`);f&&(h.href=p,h.download=`${f}.instanano`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(p))})),t.importState=function(e){const r=function(t){if(!t||"object"!=typeof t)return null;const e=t.table;return Array.isArray(e)&&!(e.length<3)&&Array.isArray(e[0])&&Array.isArray(e[1])&&Array.isArray(e[2])?{table:e,col:t.col&&"object"==typeof t.col?t.col:{},settings:t.settings&&"object"==typeof t.settings?t.settings:{},html:a(t.html||""),xrd_lock_version:t.xrd_lock_version??null,xrd_account_id:Number(t.xrd_account_id||0),xrd_lock_hash:"string"==typeof t.xrd_lock_hash?t.xrd_lock_hash:"",xrd_signature:"string"==typeof t.xrd_signature?t.xrd_signature:"",xrd_peaks:Array.isArray(t.xrd_peaks)?t.xrd_peaks:null,overrideX:t.overrideX||null,overrideMultiY:t.overrideMultiY&&"object"==typeof t.overrideMultiY?t.overrideMultiY:{},overrideXTicks:t.overrideXTicks??null,overrideYTicks:t.overrideYTicks&&"object"==typeof t.overrideYTicks?t.overrideYTicks:{},overrideTernaryTicks:t.overrideTernaryTicks&&"object"==typeof t.overrideTernaryTicks?t.overrideTernaryTicks:{},overrideScaleformatX:t.overrideScaleformatX??null,overrideScaleformatY:t.overrideScaleformatY&&"object"==typeof t.overrideScaleformatY?t.overrideScaleformatY:{},overrideCustomTicksX:t.overrideCustomTicksX??null,overrideCustomTicksY:t.overrideCustomTicksY&&"object"==typeof t.overrideCustomTicksY?t.overrideCustomTicksY:{},overrideCustomTicksTernary:t.overrideCustomTicksTernary&&"object"==typeof t.overrideCustomTicksTernary?t.overrideCustomTicksTernary:{},overrideTernary:t.overrideTernary&&"object"==typeof t.overrideTernary?t.overrideTernary:{},minorTickOn:t.minorTickOn&&"object"==typeof t.minorTickOn?t.minorTickOn:{},useCustomTicksOn:t.useCustomTicksOn&&"object"==typeof t.useCustomTicksOn?t.useCustomTicksOn:{}}:null}(e);if(!r)return void alert("Invalid .instanano file.");t.state.hot.loadData(r.table),t.state.colEnabled=r.col,t.state.overrideX=r.overrideX,t.state.overrideMultiY=r.overrideMultiY,t.state.overrideXTicks=r.overrideXTicks,t.state.overrideYTicks=r.overrideYTicks,t.state.overrideTernaryTicks=r.overrideTernaryTicks,t.state.overrideScaleformatX=r.overrideScaleformatX,t.state.overrideScaleformatY=r.overrideScaleformatY,t.state.overrideCustomTicksX=r.overrideCustomTicksX,t.state.overrideCustomTicksY=r.overrideCustomTicksY,t.state.overrideCustomTicksTernary=r.overrideCustomTicksTernary,t.state.overrideTernary=r.overrideTernary,t.state.minorTickOn=r.minorTickOn||{},t.state.useCustomTicksOn=r.useCustomTicksOn||{},d3.selectAll('input[type="checkbox"][data-col]').each((function(){this.checked=t.state.colEnabled[this.dataset.col]}));const n=r.settings.type?document.getElementById(r.settings.type):null;if(n&&(n.checked=!0),r.settings.mode){const t=document.querySelector(`input[name="axistitles"][value="${r.settings.mode}"]`);t&&(t.checked=!0)}t.state.hot.render(),t.axis.resetScales(!1),t.renderChart();const s=r.settings.ratio?document.querySelector(`[name="aspectratio"][value="${r.settings.ratio}"]`):null;s&&(s.checked=!0);const i=r.settings.mode?document.querySelector(`[name="axistitles"][value="${r.settings.mode}"]`):null;if(i&&(i.checked=!0),Object.entries(r.settings).forEach((([t,e])=>{if(/^(type|ratio|mode)$/.test(t)||null==e)return;const a=document.getElementById(t);a&&(a.value=e)})),d3.select("#chart").html(r.html),d3.selectAll(".xrd-user-peak,.xrd-ref-peak,.xrd-ref-preview-peak,g.xrd-ref-legend").remove(),t.features.prepareShapeLayer(),d3.selectAll(".shape-group").each((function(){t.features.makeShapeInteractive(d3.select(this))})),d3.selectAll("foreignObject.user-text,g.legend-group,g.axis-title").call(t.utils.applyDrag),t.axis.tickEditing(d3.select("#chart svg")),t.matchXRD&&(t.matchXRD.lockActive=!1,t.matchXRD.lockedPeaks=[],t.matchXRD.lockInfo=null,t.matchXRD.setImportedLockCandidate?.(null)),r.xrd_lock_hash&&r.xrd_signature&&Array.isArray(r.xrd_peaks)&&r.xrd_account_id>0){const e=r.xrd_peaks.map((t=>({x:Number(t.x),intensity:Number(t.intensity??0),normInt:0}))),a=e.length?Math.max(...e.map((t=>t.intensity))):0;a>0&&e.forEach((t=>t.normInt=t.intensity/a*100)),t.matchXRD?.setImportedLockCandidate?.({lock_hash:r.xrd_lock_hash,signature:r.xrd_signature,lock_version:r.xrd_lock_version??null,account_id:Number(r.xrd_account_id||0),peaks:e})}}}(window.GraphPlotter),function(t){"use strict";function e(){const e=t.getSeries();if(!e||0===e.length)return null;const a=e[0].x.filter((t=>Number.isFinite(t)));if(0===a.length)return null;const r=Math.min(...a),n=Math.max(...a);return r>=180&&r<=200&&800===n?"uvvis":r>=398&&r<=400&&4e3===n?"ftir":r>=0&&r<=10&&n>=80&&n<=90?"xrd":null}function a(e){const a={xrd:"icon5"}[e];a&&t.ui.openSidebarPanel?.(a)}let r=!1;function n(){r||(r=!0,requestAnimationFrame((()=>{r=!1,t.renderChart()})))}const s=document.querySelectorAll("input[id]"),i=document.querySelectorAll("[data-show]");document.querySelectorAll('input[name="charttype"]').forEach((e=>e.addEventListener("change",(()=>{if(!t.state.hot||"function"!=typeof t.renderChart)return;s.forEach((t=>{t.value=e.dataset[t.id]??t.dataset.defaultValue??t.defaultValue,t.dispatchEvent(new Event("input"))})),i.forEach((t=>{t.style.display=t.dataset.show.split(/\s+/).includes(e.id)?"":"none"}));const a=e.dataset.axis?.split(/\s*,\s*/).map((t=>t.trim()));if(a){const e=t.state.hot.getData();for(;e[0].length<a.length;)e.forEach(((e,r)=>e.push(0===r?a[e.length].replace("*",""):1===r?t.config.COLORS[e.length%t.config.COLORS.length]:2===r?"Sample":"")));t.state.hot.loadData(e)}if(a){let e=a.findIndex((t=>t.endsWith("*")));e<0&&(e=a.length);const r=a.map((t=>t.replace(/\*$/,""))),n=r.slice(e);t.state.hot.getData()[0].forEach(((a,s)=>{const i=s<e?r[s]:n.length?n[(s-e)%n.length]:a;t.state.hot.setDataAtCell(0,s,i),t.state.colEnabled[s]=!1!==t.state.colEnabled[s]&&r.includes(i)})),t.state.hot.render()}t.axis.resetScales(!1),n()})))),["smoothingslider","baselineslider","multiyaxis"].forEach((t=>{const e=document.getElementById(t);function a(){e.classList.toggle("zero","0"===e.value)}e.addEventListener("input",a),a()})),document.querySelectorAll("span[data-current-value]").forEach((t=>{const e=document.getElementById(t.dataset.currentValue);e&&"range"===e.type&&(t.textContent=e.value,e.oninput=()=>{t.textContent=e.value})})),t.getSeries=function(){const e=t.getSettings(),a=t.state.hot.getData(),r=a[0],n=a.slice(3),s=t.state.colEnabled,i=[];if("ternary"===e.type||"ternaryline"===e.type||"ternaryarea"===e.type){const e=t.state.hot.getData()[0],a=t.state.hot.getData().slice(3),r=e.indexOf("X-axis"),n=e.indexOf("Y-axis"),s=e.indexOf("Z-axis");return[{rawX:a.map((t=>+t[r])),y:a.map((t=>+t[n])),z:a.map((t=>+t[s])),color:t.state.hot.getData()[1][n]}]}if("histogram"===e.type)return r.forEach(((t,e)=>{if("Y-axis"===t&&s[e]){const t=n.map((t=>parseFloat(t[e]))).filter((t=>Number.isFinite(t)));i.push({y:t,color:a[1][e],label:a[2][e]})}})),i;const o=r.map(((t,e)=>"X-axis"===t&&s[e]?e:-1)).filter((t=>t>=0));return o.forEach(((t,c)=>{const l=null!=o[c+1]?o[c+1]:r.length;for(let o=t+1;o<l;o++)if("Y-axis"===r[o]&&s[o]){const c=n.map((a=>"bar"===e.type?a[t]:parseFloat(a[t]))),l=n.map((t=>parseFloat(t[o]))),d="Y-error"===r[o+1]&&s[o+1]?o+1:-1,u=d>=0?n.map((t=>parseFloat(t[d])||NaN)):null,m=d>=0?a[1][d]:null;i.push({rawX:c,x:c,y:l,color:a[1][o],label:a[2][o],error:u,errorColor:m})}})),i},t.getSettings=function(){const e=document.querySelector('input[name="aspectratio"]:checked').value,a=t.config.ratioPresets[e],r={type:document.querySelector('input[name="charttype"]:checked').id,symbolsize:+document.getElementById("symbolsize").value,xticks:a.xticks,yticks:a.yticks,scaleformat:+document.getElementById("scaleformat").value,bins:+document.getElementById("bins").value,multiygap:+document.getElementById("multiygap").value,scalewidth:+document.getElementById("scalewidth").value,linewidth:+document.getElementById("linewidth").value,multiyaxis:+document.getElementById("multiyaxis").value,opacity:+document.getElementById("opacity").value,mode:document.querySelector('input[name="axistitles"]:checked').value,scaleFs:a.scaleFs,axisTitleFs:a.axisTitleFs,legendFs:a.legendFs,ratio:document.querySelector('input[name="aspectratio"]:checked').value},n=document.querySelector('input[name="charttype"]:checked').dataset;return Object.entries(n).forEach((([t,e])=>{/^-?\d+(\.\d+)?$/.test(e)?r[t]=+e:e.includes(",")?r[t]=e.split(",").map((t=>t.trim())):r[t]=e})),r},t.renderChart=function(){const e=d3.select("#chart"),a=e.select("svg").selectAll("g.axis-title, g.legend-group, g.shape-group, foreignObject.user-text").remove();e.html("");const{s:r,series:n,xScale:s,yScale:i,W:o,H:c,MT:l,MB:d,ML:u,MR:m,titles:p}=t.axis.prepareChartContext(),h=function(e,{W:a,H:r,ML:n,MR:s,MT:i,MB:o},c="clip",l={}){const d=e.append("svg").attr("viewBox",`0 0 ${a} ${r}`).on("click",(e=>{e.defaultPrevented||e.target!==d.node()||t.utils.clearActive()})),u=d.append("defs").append("clipPath").attr("id",c);if("ternary"===l.type||"ternaryline"===l.type||"ternaryarea"===l.type){const t=a-n-s,e=r-i-o,c=Math.min(t,2*e/Math.sqrt(3)),l=c*Math.sqrt(3)/2,d=n+(t-c)/2,m=i+(e-l)/2+l,p=d+c,h=d+c/2,f=m-l;u.append("polygon").attr("points",`${d},${m} ${p},${m} ${h},${f}`)}else u.append("rect").attr("x",n).attr("y",i).attr("width",a-n-s).attr("height",r-i-o);return d}(e,{W:o,H:c,ML:u,MR:m,MT:l,MB:d},"clip",r);t.ui.areacalculation(),a.each((function(){h.node().appendChild(this)}));const f={x:s,y:i};!function(e,a,r){if(1!==a.multiyaxis||r.length<2)return;const n=r.map(((e,a)=>{const[r,n]=d3.extent(e.y),s=.06*(n-r),i=t.state.overrideMultiY?.[a]?t.state.overrideMultiY[a]:[r-s,n+s];return d3.scaleLinear().domain(i).range([t.config.DIM.H-t.config.DIM.MB,t.config.DIM.MT])}));e.y2=n,e.y=n[0],t.state.multiYScales=n}(f,r,n);const g=h.append("g").attr("clip-path","url(#clip)");t.ChartRegistry.get(r.type).draw(g,n,f,r),t.axis.drawAxis(h,f,p,r,n),t.ui.drawLegend(),t.ui.toolTip(h,{xScale:s,yScale:i}),t.features.prepareShapeLayer(),t.axis.tickEditing(d3.select("#chart svg")),t.matchXRD?.render()},t.init=function(){t.ui.bindShellEvents?.(),t.initTable(),t.state.hot.addHook("afterPaste",(()=>{setTimeout((()=>{t.state.colEnabled={},t.state.hot.getData()[0].forEach(((e,a)=>{t.state.colEnabled[a]=!0})),t.state.hot.render();const r=e();if(r){const t=document.querySelector(`input[name="axistitles"][value="${r}"]`);t&&(t.checked=!0),a(r)}t.axis.resetScales(!0);const n=d3.select("#chart svg");n.empty()||(n.selectAll(".shape-group").remove(),n.selectAll("foreignObject.user-text").remove(),t.state.tickLabelStyles={x:{fontSize:null,color:null},y:{fontSize:null,color:null}}),t.renderChart()}),0)})),t.state.hot.addHook("afterChange",((e,a)=>{if(!e)return;let r=!1,s=!1;for(const[t,,a,n]of e)0===t&&a!==n&&(r=!0),t>=3&&a!==n&&(s=!0);s?t.axis.resetScales(!0):r&&t.axis.resetScales(!1),"paste"!==a&&n()})),t.state.hot.addHook("beforeKeyDown",(e=>{const a=t.state.hot.getSelectedLast();a&&0===a[0]&&(e.stopImmediatePropagation(),e.preventDefault())})),document.addEventListener("input",(e=>{"enableAreaCalc"!==e.target.id&&"sidebar"!==e.target.name&&t.ui.disableAreaCal();const a=e.target;a.matches(".control input")&&("axistitles"!==a.name&&"aspectratio"!==a.name||t.axis.resetScales(!1),"aspectratio"===a.name&&t.axis.applyGraphRatio(a.value),n())})),t.io.initFileLoader?.({detectModeFromData:e,openPanelForMode:a}),t.axis.resetScales(!0);const r=document.querySelector('input[name="charttype"]:checked');r?r.dispatchEvent(new Event("change")):t.renderChart()},document.addEventListener("DOMContentLoaded",(()=>{window.GraphPlotter.init()}))}(window.GraphPlotter);